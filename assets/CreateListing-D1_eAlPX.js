import{i as Y,k as _,u as H,t as K,r as n,j as e,D as z,N as J,X as T,K as s,a8 as W}from"./index-BViABN_S.js";import{j as V,u as X,k as Q}from"./marketplaceServiceNew-BDJqS4mt.js";import{C as Z,L as ee,T as re}from"./marketplace-Deg-FW8s.js";import{P as k}from"./plus-BMu3ylQz.js";import{U as te}from"./upload-BOd7P2WQ.js";import{I as ae}from"./image-D3C-igSh.js";function ge(){const{user:h}=Y(),{userprofile:v,avatrUrl:E}=_(),d=H(),{projectId:c}=K(),i=!!c,[t,l]=n.useState({title:"",description:"",category:"web-app",techStack:[],price:0,isFree:!0,images:[],links:{github:"",liveDemo:"",documentation:"",video:""},licenseType:"personal",status:"published"}),[x,w]=n.useState(""),[u,N]=n.useState(""),[D,A]=n.useState(!1),[U,B]=n.useState(!1),[b,P]=n.useState(!1),[C,y]=n.useState(0),f=n.useRef(null);n.useEffect(()=>{(async()=>{if(!(!i||!c)){B(!0);try{const a=await V(c);if(a){if(a.sellerId!==h?.id){s.error("You can only edit your own projects"),d("/dashboard/marketplace/my-listings");return}l({title:a.title,description:a.description,category:a.category,techStack:a.techStack,price:a.price,isFree:a.isFree,images:a.images,links:a.links,licenseType:a.licenseType,status:a.status})}else s.error("Project not found"),d("/dashboard/marketplace/my-listings")}catch(a){console.error("Error loading project:",a),s.error("Failed to load project"),d("/dashboard/marketplace/my-listings")}finally{B(!1)}}})()},[c,i,h,d]);const S=r=>{r&&!t.techStack.includes(r)&&(l({...t,techStack:[...t.techStack,r]}),w(""))},R=r=>{l({...t,techStack:t.techStack.filter(a=>a!==r)})},L=()=>{if(u&&!t.images.includes(u)){if(!/^https?:\/\/.+/.test(u)){s.error("Please enter a valid image URL (must start with http:// or https://)");return}l({...t,images:[...t.images,u]}),N(""),s.success("Image URL added!")}},$=r=>{l({...t,images:t.images.filter(a=>a!==r)})},M=async r=>{const a=r.target.files;if(!a||a.length===0)return;const o=5-t.images.length;if(a.length>o){s.error(`You can only add ${o} more image(s). Maximum is 5 images.`);return}P(!0),y(0);try{const g=[],I=a.length;for(let m=0;m<I;m++){const p=a[m];if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(p.type)){s.error(`${p.name}: Invalid file type. Only JPEG, PNG, GIF, and WebP are allowed.`);continue}if(p.size>5*1024*1024){s.error(`${p.name}: File too large. Maximum size is 5MB.`);continue}const F=new FormData;F.append("image",p);const j=await fetch(`${W}/upload/image`,{method:"POST",body:F});if(!j.ok){const O=await j.json();throw new Error(O.error||"Upload failed")}const q=await j.json();g.push(q.imageUrl),y(Math.round((m+1)/I*100))}g.length>0&&(l(m=>({...m,images:[...m.images,...g]})),s.success(`${g.length} image(s) uploaded successfully!`))}catch(g){console.error("Upload error:",g),s.error(g.message||"Failed to upload image")}finally{P(!1),y(0),f.current&&(f.current.value="")}},G=async r=>{if(r.preventDefault(),!h||!v?.name){s.error("You must be logged in");return}if(!t.title||!t.description){s.error("Please fill in all required fields");return}if(t.techStack.length===0){s.error("Please add at least one technology");return}if(!t.links.github||!t.links.github.trim()){s.error("GitHub repository link is required");return}if(!t.links.liveDemo||!t.links.liveDemo.trim()){s.error("Live Demo link is required");return}const a=/^https?:\/\/.+/;if(!a.test(t.links.github)){s.error("Please enter a valid GitHub URL (must start with http:// or https://)");return}if(!a.test(t.links.liveDemo)){s.error("Please enter a valid Live Demo URL (must start with http:// or https://)");return}A(!0);try{if(i&&c)await X(c,t),s.success("Project updated successfully!"),d(`/dashboard/marketplace/project/${c}`);else{const o={...t,sellerId:h.id,sellerName:v.name,sellerAvatar:E||""};await Q(o),s.success("Project submitted for verification! It will be visible after admin approval.",{duration:5e3,icon:"ðŸ”"}),d("/dashboard/marketplace/my-listings")}}catch(o){console.error(`Error ${i?"updating":"creating"} project:`,o),o?.message?s.error(`Failed to ${i?"update":"create"} listing: ${o.message}`):s.error(`Failed to ${i?"update":"create"} listing. Check browser console for details.`)}finally{A(!1)}};return U?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-t-transparent rounded-full animate-spin mb-4",style:{borderColor:"#00ADB5",borderTopColor:"transparent"}}),e.jsx("p",{className:"text-gray-600 dark:text-white font-medium",children:"Loading project..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>d(i?"/dashboard/marketplace/my-listings":"/dashboard/marketplace"),className:"mb-6 flex items-center gap-2 text-gray-600 dark:text-white transition-colors font-medium",style:{"--hover-color":"#00ADB5"},onMouseEnter:r=>r.currentTarget.style.color="#00ADB5",onMouseLeave:r=>r.currentTarget.style.color="",children:[e.jsx(z,{className:"w-5 h-5"}),i?"Back to My Listings":"Back to Marketplace"]}),e.jsxs(J.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-8 border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"#00ADB5"},children:i?"Edit Your Project":"List Your Project"}),e.jsx("p",{className:"text-gray-600 dark:text-white mb-8",children:i?"Update your project details":"Share your amazing project with the community"}),e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Project Title *"}),e.jsx("input",{type:"text",value:t.title,onChange:r=>l({...t,title:r.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-800 transition-all",placeholder:"e.g., E-commerce Platform with React & Node.js",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Description *"}),e.jsx("textarea",{value:t.description,onChange:r=>l({...t,description:r.target.value}),rows:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-800 transition-all",placeholder:"Describe your project, its features, and what makes it special...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Category *"}),e.jsx("select",{value:t.category,onChange:r=>l({...t,category:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:Object.entries(Z).map(([r,a])=>e.jsx("option",{value:r,children:a},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"License Type *"}),e.jsx("select",{value:t.licenseType,onChange:r=>l({...t,licenseType:r.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:Object.entries(ee).map(([r,a])=>e.jsx("option",{value:r,children:a},r))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Tech Stack *"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:x,onChange:r=>w(r.target.value),onKeyPress:r=>{r.key==="Enter"&&(r.preventDefault(),S(x))},list:"tech-options",className:"flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-800 transition-all",placeholder:"Type or select technology..."}),e.jsx("datalist",{id:"tech-options",children:re.map(r=>e.jsx("option",{value:r},r))}),e.jsxs("button",{type:"button",onClick:()=>S(x),className:"px-4 py-2 text-white rounded-lg transition-colors flex items-center gap-2 hover:opacity-90",style:{backgroundColor:"#00ADB5"},children:[e.jsx(k,{className:"w-5 h-5"}),"Add"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.techStack.map(r=>e.jsxs("span",{className:"px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2",style:{backgroundColor:"rgba(0, 173, 181, 0.15)",color:"#00ADB5"},children:[r,e.jsx("button",{type:"button",onClick:()=>R(r),className:"hover:text-purple-900 transition-colors",children:e.jsx(T,{className:"w-4 h-4"})})]},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Pricing"}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:t.isFree,onChange:()=>l({...t,isFree:!0,price:0}),className:"w-4 h-4 accent-[#00ADB5]"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Free"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:!t.isFree,onChange:()=>l({...t,isFree:!1}),className:"w-4 h-4 accent-[#00ADB5]"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Paid"})]})]}),!t.isFree&&e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-white font-medium",children:"$"}),e.jsx("input",{type:"number",min:"1",value:t.price,onChange:r=>l({...t,price:Number(r.target.value)}),className:"w-full pl-8 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-600 transition-all",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["Project Images ",e.jsx("span",{className:"text-gray-500 text-xs",children:"(max 5 images)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{ref:f,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",multiple:!0,onChange:M,className:"hidden",id:"image-upload",disabled:b||t.images.length>=5}),e.jsx("label",{htmlFor:"image-upload",className:`flex flex-col items-center justify-center w-full p-6 border-2 border-dashed rounded-lg cursor-pointer transition-all ${b||t.images.length>=5?"border-gray-400 bg-gray-200 dark:bg-gray-800 cursor-not-allowed opacity-60":"border-[#00ADB5] bg-gradient-to-br from-[#00ADB5]/5 to-[#00ADB5]/10 hover:from-[#00ADB5]/10 hover:to-[#00ADB5]/20 dark:from-[#00ADB5]/10 dark:to-[#00ADB5]/20"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 border-4 border-[#00ADB5] border-t-transparent rounded-full animate-spin mb-3"}),e.jsxs("span",{className:"text-sm font-medium text-[#00ADB5]",children:["Uploading... ",C,"%"]}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#00ADB5] transition-all duration-300",style:{width:`${C}%`}})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-[#00ADB5]/20 rounded-full mb-3",children:e.jsx(te,{className:"w-8 h-8 text-[#00ADB5]"})}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-white",children:t.images.length>=5?"Maximum images reached":"Click to upload images"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t.images.length>=5?"Remove some images to add more":"JPEG, PNG, GIF, WebP up to 5MB each"}),t.images.length<5&&e.jsxs("span",{className:"text-xs text-[#00ADB5] mt-2 font-medium",children:[5-t.images.length," slot(s) remaining"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-300 dark:bg-gray-600"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:"OR ADD BY URL"}),e.jsx("div",{className:"flex-1 h-px bg-gray-300 dark:bg-gray-600"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"url",value:u,onChange:r=>N(r.target.value),onKeyPress:r=>{r.key==="Enter"&&(r.preventDefault(),L())},disabled:t.images.length>=5,className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-600 transition-all text-sm disabled:opacity-60 disabled:cursor-not-allowed",placeholder:"https://example.com/image.jpg"})]}),e.jsxs("button",{type:"button",onClick:L,disabled:t.images.length>=5||!u,className:"px-4 py-2.5 bg-[#00ADB5] text-white rounded-lg hover:opacity-90 transition-colors flex items-center gap-2 text-sm font-medium disabled:opacity-60 disabled:cursor-not-allowed",children:[e.jsx(k,{className:"w-4 h-4"}),"Add URL"]})]})}),t.images.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:t.images.map((r,a)=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("img",{src:r,alt:`Preview ${a+1}`,className:"w-full h-full object-cover rounded-lg border-2 border-transparent group-hover:border-[#00ADB5] transition-all",onError:o=>{o.target.src="https://via.placeholder.com/150?text=Image+Error"}}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>$(r),className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg",children:e.jsx(T,{className:"w-5 h-5"})})}),e.jsx("span",{className:"absolute bottom-1 left-1 px-1.5 py-0.5 bg-black/60 text-white text-xs rounded",children:a+1})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["GitHub Repository ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",value:t.links.github,onChange:r=>l({...t,links:{...t.links,github:r.target.value}}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",placeholder:"https://github.com/...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["Live Demo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",value:t.links.liveDemo,onChange:r=>l({...t,links:{...t.links,liveDemo:r.target.value}}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",placeholder:"https://demo.example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Documentation"}),e.jsx("input",{type:"url",value:t.links.documentation,onChange:r=>l({...t,links:{...t.links,documentation:r.target.value}}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",placeholder:"https://docs.example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Video Demo (YouTube, etc.)"}),e.jsx("input",{type:"url",value:t.links.video,onChange:r=>l({...t,links:{...t.links,video:r.target.value}}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",placeholder:"https://youtube.com/..."})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>d(i?"/dashboard/marketplace/my-listings":"/dashboard/marketplace"),className:"flex-1 px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:D,className:"flex-1 px-6 py-3 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 hover:opacity-90",style:{background:"linear-gradient(135deg, #00ADB5 0%, #00d4ff 100%)"},children:D?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:i?"Updating...":"Publishing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{children:i?"Update Project":"Publish Project"})]})})]})]})]})]})})}export{ge as default};
