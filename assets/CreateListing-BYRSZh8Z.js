import{l as O,n as Y,u as _,t as H,r as n,j as e,D as z,I as K,X as F,H as s,a7 as J}from"./index-Dxt_G0Ug.js";import{l as W,u as X,n as Q}from"./marketplaceServiceNew-Cp7nnaA0.js";import{C as Z,L as ee,T as re}from"./marketplace-Deg-FW8s.js";import{P as j}from"./plus-BClnITEp.js";import{U as te}from"./upload-3Nm0vsPm.js";import{I as ae}from"./image-ouXtIiEI.js";function ge(){const{user:x}=O(),{userprofile:v,avatrUrl:U}=Y(),d=_(),{projectId:c}=H(),i=!!c,[r,l]=n.useState({title:"",description:"",category:"web-app",techStack:[],price:0,isFree:!0,images:[],links:{github:"",liveDemo:"",documentation:"",video:"",demoVideo:"",explanationVideo:""},licenseType:"personal",status:"published"}),[h,w]=n.useState(""),[u,N]=n.useState(""),[D,A]=n.useState(!1),[T,B]=n.useState(!1),[b,P]=n.useState(!1),[C,y]=n.useState(0),f=n.useRef(null);n.useEffect(()=>{(async()=>{if(!(!i||!c)){B(!0);try{const a=await W(c);if(a){if(a.sellerId!==x?.id){s.error("You can only edit your own projects"),d("/dashboard/marketplace/my-listings");return}l({title:a.title,description:a.description,category:a.category,techStack:a.techStack,price:a.price,isFree:a.isFree,images:a.images,links:a.links,licenseType:a.licenseType,status:a.status})}else s.error("Project not found"),d("/dashboard/marketplace/my-listings")}catch(a){console.error("Error loading project:",a),s.error("Failed to load project"),d("/dashboard/marketplace/my-listings")}finally{B(!1)}}})()},[c,i,x,d]);const S=t=>{t&&!r.techStack.includes(t)&&(l({...r,techStack:[...r.techStack,t]}),w(""))},R=t=>{l({...r,techStack:r.techStack.filter(a=>a!==t)})},I=()=>{if(u&&!r.images.includes(u)){if(!/^https?:\/\/.+/.test(u)){s.error("Please enter a valid image URL (must start with http:// or https://)");return}l({...r,images:[...r.images,u]}),N(""),s.success("Image URL added!")}},V=t=>{l({...r,images:r.images.filter(a=>a!==t)})},q=async t=>{const a=t.target.files;if(!a||a.length===0)return;const o=5-r.images.length;if(a.length>o){s.error(`You can only add ${o} more image(s). Maximum is 5 images.`);return}P(!0),y(0);try{const g=[],L=a.length;for(let m=0;m<L;m++){const p=a[m];if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(p.type)){s.error(`${p.name}: Invalid file type. Only JPEG, PNG, GIF, and WebP are allowed.`);continue}if(p.size>5*1024*1024){s.error(`${p.name}: File too large. Maximum size is 5MB.`);continue}const E=new FormData;E.append("image",p);const k=await fetch(`${J}/upload/image`,{method:"POST",body:E});if(!k.ok){const M=await k.json();throw new Error(M.error||"Upload failed")}const G=await k.json();g.push(G.imageUrl),y(Math.round((m+1)/L*100))}g.length>0&&(l(m=>({...m,images:[...m.images,...g]})),s.success(`${g.length} image(s) uploaded successfully!`))}catch(g){console.error("Upload error:",g),s.error(g.message||"Failed to upload image")}finally{P(!1),y(0),f.current&&(f.current.value="")}},$=async t=>{if(t.preventDefault(),!x||!v?.name){s.error("You must be logged in");return}if(!r.title||!r.description){s.error("Please fill in all required fields");return}if(r.techStack.length===0){s.error("Please add at least one technology");return}if(!r.links.github||!r.links.github.trim()){s.error("GitHub repository link is required");return}if(!r.links.liveDemo||!r.links.liveDemo.trim()){s.error("Live Demo link is required");return}if(!r.links.demoVideo||!r.links.demoVideo.trim()){s.error("Demo Video link is required");return}if(!r.links.explanationVideo||!r.links.explanationVideo.trim()){s.error("Explanation Video link is required");return}const a=/^https?:\/\/.+/;if(!a.test(r.links.github)){s.error("Please enter a valid GitHub URL (must start with http:// or https://)");return}if(!a.test(r.links.liveDemo)){s.error("Please enter a valid Live Demo URL (must start with http:// or https://)");return}A(!0);try{if(i&&c)await X(c,r),s.success("Project updated successfully!"),d(`/dashboard/marketplace/project/${c}`);else{const o={...r,sellerId:x.id,sellerName:v.name,sellerAvatar:U||""};await Q(o),s.success("Project submitted for verification! It will be visible after admin approval.",{duration:5e3,icon:"ðŸ”"}),d("/dashboard/marketplace/my-listings")}}catch(o){console.error(`Error ${i?"updating":"creating"} project:`,o),o?.message?s.error(`Failed to ${i?"update":"create"} listing: ${o.message}`):s.error(`Failed to ${i?"update":"create"} listing. Check browser console for details.`)}finally{A(!1)}};return T?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-t-transparent rounded-full animate-spin mb-4",style:{borderColor:"#00ADB5",borderTopColor:"transparent"}}),e.jsx("p",{className:"text-gray-600 dark:text-white font-medium",children:"Loading project..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>d(i?"/dashboard/marketplace/my-listings":"/dashboard/marketplace"),className:"mb-6 flex items-center gap-2 text-gray-600 dark:text-white transition-colors font-medium",style:{"--hover-color":"#00ADB5"},onMouseEnter:t=>t.currentTarget.style.color="#00ADB5",onMouseLeave:t=>t.currentTarget.style.color="",children:[e.jsx(z,{className:"w-5 h-5"}),i?"Back to My Listings":"Back to Marketplace"]}),e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-8 border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"#00ADB5"},children:i?"Edit Your Project":"List Your Project"}),e.jsx("p",{className:"text-gray-600 dark:text-white mb-8",children:i?"Update your project details":"Share your amazing project with the community"}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Project Title *"}),e.jsx("input",{type:"text",value:r.title,onChange:t=>l({...r,title:t.target.value}),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-800 transition-all",placeholder:"e.g., E-commerce Platform with React & Node.js",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Description *"}),e.jsx("textarea",{value:r.description,onChange:t=>l({...r,description:t.target.value}),rows:6,className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-800 transition-all",placeholder:"Describe your project, its features, and what makes it special...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Category *"}),e.jsx("select",{value:r.category,onChange:t=>l({...r,category:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:Object.entries(Z).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"License Type *"}),e.jsx("select",{value:r.licenseType,onChange:t=>l({...r,licenseType:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:Object.entries(ee).map(([t,a])=>e.jsx("option",{value:t,children:a},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Tech Stack *"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:h,onChange:t=>w(t.target.value),onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),S(h))},list:"tech-options",className:"flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-800 transition-all",placeholder:"Type or select technology..."}),e.jsx("datalist",{id:"tech-options",children:re.map(t=>e.jsx("option",{value:t},t))}),e.jsxs("button",{type:"button",onClick:()=>S(h),className:"px-4 py-2 text-white rounded-lg transition-colors flex items-center gap-2 hover:opacity-90",style:{backgroundColor:"#00ADB5"},children:[e.jsx(j,{className:"w-5 h-5"}),"Add"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.techStack.map(t=>e.jsxs("span",{className:"px-3 py-1.5 rounded-lg text-sm font-medium flex items-center gap-2",style:{backgroundColor:"rgba(0, 173, 181, 0.15)",color:"#00ADB5"},children:[t,e.jsx("button",{type:"button",onClick:()=>R(t),className:"hover:text-purple-900 transition-colors",children:e.jsx(F,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Pricing"}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:r.isFree,onChange:()=>l({...r,isFree:!0,price:0}),className:"w-4 h-4 accent-[#00ADB5]"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Free"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",checked:!r.isFree,onChange:()=>l({...r,isFree:!1}),className:"w-4 h-4 accent-[#00ADB5]"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:"Paid"})]})]}),!r.isFree&&e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-white font-medium",children:"$"}),e.jsx("input",{type:"number",min:"1",value:r.price,onChange:t=>l({...r,price:Number(t.target.value)}),className:"w-full pl-8 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-600 transition-all",placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["Project Images ",e.jsx("span",{className:"text-gray-500 text-xs",children:"(max 5 images)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("input",{ref:f,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",multiple:!0,onChange:q,className:"hidden",id:"image-upload",disabled:b||r.images.length>=5}),e.jsx("label",{htmlFor:"image-upload",className:`flex flex-col items-center justify-center w-full p-6 border-2 border-dashed rounded-lg cursor-pointer transition-all ${b||r.images.length>=5?"border-gray-400 bg-gray-200 dark:bg-gray-800 cursor-not-allowed opacity-60":"border-[#00ADB5] bg-gradient-to-br from-[#00ADB5]/5 to-[#00ADB5]/10 hover:from-[#00ADB5]/10 hover:to-[#00ADB5]/20 dark:from-[#00ADB5]/10 dark:to-[#00ADB5]/20"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 border-4 border-[#00ADB5] border-t-transparent rounded-full animate-spin mb-3"}),e.jsxs("span",{className:"text-sm font-medium text-[#00ADB5]",children:["Uploading... ",C,"%"]}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 dark:bg-gray-700 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-[#00ADB5] transition-all duration-300",style:{width:`${C}%`}})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 bg-[#00ADB5]/20 rounded-full mb-3",children:e.jsx(te,{className:"w-8 h-8 text-[#00ADB5]"})}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-white",children:r.images.length>=5?"Maximum images reached":"Click to upload images"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:r.images.length>=5?"Remove some images to add more":"JPEG, PNG, GIF, WebP up to 5MB each"}),r.images.length<5&&e.jsxs("span",{className:"text-xs text-[#00ADB5] mt-2 font-medium",children:[5-r.images.length," slot(s) remaining"]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"flex-1 h-px bg-gray-300 dark:bg-gray-600"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium",children:"OR ADD BY URL"}),e.jsx("div",{className:"flex-1 h-px bg-gray-300 dark:bg-gray-600"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"url",value:u,onChange:t=>N(t.target.value),onKeyPress:t=>{t.key==="Enter"&&(t.preventDefault(),I())},disabled:r.images.length>=5,className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-600 transition-all text-sm disabled:opacity-60 disabled:cursor-not-allowed",placeholder:"https://example.com/image.jpg"})]}),e.jsxs("button",{type:"button",onClick:I,disabled:r.images.length>=5||!u,className:"px-4 py-2.5 bg-[#00ADB5] text-white rounded-lg hover:opacity-90 transition-colors flex items-center gap-2 text-sm font-medium disabled:opacity-60 disabled:cursor-not-allowed",children:[e.jsx(j,{className:"w-4 h-4"}),"Add URL"]})]})}),r.images.length>0&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:r.images.map((t,a)=>e.jsxs("div",{className:"relative group aspect-square",children:[e.jsx("img",{src:t,alt:`Preview ${a+1}`,className:"w-full h-full object-cover rounded-lg border-2 border-transparent group-hover:border-[#00ADB5] transition-all",onError:o=>{o.target.src="https://via.placeholder.com/150?text=Image+Error"}}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>V(t),className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg",children:e.jsx(F,{className:"w-5 h-5"})})}),e.jsx("span",{className:"absolute bottom-1 left-1 px-1.5 py-0.5 bg-black/60 text-white text-xs rounded",children:a+1})]},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["GitHub Repository ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",value:r.links.github,onChange:t=>l({...r,links:{...r.links,github:t.target.value}}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",placeholder:"https://github.com/...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["Live Demo ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"url",value:r.links.liveDemo,onChange:t=>l({...r,links:{...r.links,liveDemo:t.target.value}}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",placeholder:"https://demo.example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Documentation"}),e.jsx("input",{type:"url",value:r.links.documentation,onChange:t=>l({...r,links:{...r.links,documentation:t.target.value}}),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",placeholder:"https://docs.example.com"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-xl p-6 border border-purple-200 dark:border-purple-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:["ðŸ“¹ Required Videos",e.jsx("span",{className:"text-xs bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 px-2 py-1 rounded-full",children:"Required"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Upload two videos to help buyers understand your project better. Good videos can earn you coin rewards!"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["ðŸŽ¬ Demo Video ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Show your project in action - features, UI, functionality"}),e.jsx("input",{type:"url",value:r.links.demoVideo,onChange:t=>l({...r,links:{...r.links,demoVideo:t.target.value}}),className:"w-full px-4 py-2 border border-purple-300 dark:border-purple-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"https://youtube.com/watch?v=...",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-900 dark:text-white mb-2",children:["ðŸ’¡ Explanation Video ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Explain your idea - concept, use cases, why it's valuable"}),e.jsx("input",{type:"url",value:r.links.explanationVideo,onChange:t=>l({...r,links:{...r.links,explanationVideo:t.target.value}}),className:"w-full px-4 py-2 border border-blue-300 dark:border-blue-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://youtube.com/watch?v=...",required:!0})]})]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400 mt-3 flex items-center gap-1",children:"ðŸª™ Earn coins when buyers rate your project above 3.5 stars or every 1000 views!"})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>d(i?"/dashboard/marketplace/my-listings":"/dashboard/marketplace"),className:"flex-1 px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:D,className:"flex-1 px-6 py-3 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 hover:opacity-90",style:{background:"linear-gradient(135deg, #00ADB5 0%, #00d4ff 100%)"},children:D?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:i?"Updating...":"Publishing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-5 h-5"}),e.jsx("span",{children:i?"Update Project":"Publish Project"})]})})]})]})]})]})})}export{ge as default};
