import{g as Z,r as s,j as e,i as Ne,Z as Pe,t as _e,v as Ve,E as Re,w as wt,X as xe,x as ne,h as qe,F as Nt,S as vt,y as ct,k as Ge,C as et,U as ye,M as kt,p as St,z as He,D as tt,T as st,H as Ct,l as $t,u as Dt}from"./index-D5a2jDWJ.js";import{G as ce}from"./git-branch-DBu4fv7o.js";import{C as ve}from"./clock-D3TpyMa4.js";import{F as Qe}from"./file-text-B9NHNs2u.js";import{P as Ye}from"./play-B27EwLOf.js";import{P as be}from"./plus-MEwH8TaG.js";import{T as Ce}from"./trash-2-BWT2lx6t.js";import{L as ge}from"./loader-circle-CrUwiNWV.js";import{C as me}from"./circle-alert-Btf6GzqI.js";import{T as gt,a as Ae,L as xt}from"./tag-CihcQhSx.js";import{G as we}from"./github-DU6--TrO.js";import{C as Be}from"./chevron-down-DY7a3qR0.js";import{i as mt,a as ht,o as _t,b as ut,c as At,g as Tt}from"./socketService-Bb3-UrQE.js";import{C as Xe}from"./chevron-right-jPn2UXno.js";import{C as pt}from"./chevron-left-qfHiwsns.js";import{U as Je}from"./user-BBTtKFBF.js";import{S as Me}from"./send-BQnAf8Lv.js";import{C as Et}from"./circle-x-Cjh7aFCh.js";import{T as rt}from"./trending-up-CDpxN5D4.js";import{U as Pt}from"./upload-CHp4Q_1q.js";import{E as Rt}from"./eye-BzT_Lw6Z.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],Ze=Z("chart-no-axes-column",Mt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ie=Z("chevron-up",Ft);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],$e=Z("circle-check",Lt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ht=Z("download",Bt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Gt=Z("ellipsis-vertical",qt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Ut=Z("ellipsis",zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01",key:"gkbcor"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}]],Ot=Z("file-archive",It);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],Jt=Z("file-audio",Vt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],Kt=Z("file-code",Wt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Yt=Z("file-image",Qt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]],Zt=Z("file-play",Xt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],at=Z("file",es);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]],le=Z("git-commit-horizontal",ts);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]],Te=Z("git-merge",ss);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["line",{x1:"6",x2:"6",y1:"9",y2:"21",key:"rroup"}]],he=Z("git-pull-request",rs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],ns=Z("grid-3x3",as);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M5 3v14",key:"9nsxs2"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"M19 3v18",key:"1sk56x"}]],We=Z("kanban",ls);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],os=Z("lock",is);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],Ke=Z("paperclip",ds);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],gs=Z("pause",cs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ze=Z("settings",xs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],yt=Z("unlink",ms);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],us=Z("user-check",hs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],ys=Z("user-x",ps),nt="http://localhost:5000/api";function bs({projectId:t,limit:k=50,includeGitHub:l=!0}){const[C,p]=s.useState([]),[F,H]=s.useState([]),[z,P]=s.useState(!0),[L,G]=s.useState(null),[E,N]=s.useState(!0),q={task_created:e.jsx(be,{className:"w-4 h-4"}),task_updated:e.jsx(ze,{className:"w-4 h-4"}),task_completed:e.jsx($e,{className:"w-4 h-4"}),task_deleted:e.jsx(Ce,{className:"w-4 h-4"}),task_moved:e.jsx(ce,{className:"w-4 h-4"}),task_commented:e.jsx(_e,{className:"w-4 h-4"}),board_created:e.jsx(be,{className:"w-4 h-4"}),sprint_started:e.jsx(Ye,{className:"w-4 h-4"}),sprint_completed:e.jsx($e,{className:"w-4 h-4"}),member_joined:e.jsx(Ve,{className:"w-4 h-4"}),file_uploaded:e.jsx(Qe,{className:"w-4 h-4"}),time_logged:e.jsx(ve,{className:"w-4 h-4"}),github_push:e.jsx(le,{className:"w-4 h-4"}),github_commit:e.jsx(le,{className:"w-4 h-4"}),github_pr_opened:e.jsx(he,{className:"w-4 h-4"}),github_pr_merged:e.jsx(Te,{className:"w-4 h-4"}),github_pr_closed:e.jsx(he,{className:"w-4 h-4"}),github_issue_opened:e.jsx(ce,{className:"w-4 h-4"}),github_issue_closed:e.jsx($e,{className:"w-4 h-4"}),github_review:e.jsx(_e,{className:"w-4 h-4"}),default:e.jsx(Pe,{className:"w-4 h-4"})},D={task_created:"bg-green-500",task_updated:"bg-blue-500",task_completed:"bg-teal-500",task_deleted:"bg-red-500",task_moved:"bg-yellow-500",task_commented:"bg-indigo-500",board_created:"bg-green-500",sprint_started:"bg-teal-500",sprint_completed:"bg-teal-500",member_joined:"bg-cyan-500",file_uploaded:"bg-orange-500",time_logged:"bg-pink-500",github_push:"bg-gray-700",github_commit:"bg-gray-700",github_pr_opened:"bg-blue-600",github_pr_merged:"bg-purple-600",github_pr_closed:"bg-red-600",github_issue_opened:"bg-green-600",github_issue_closed:"bg-purple-500",github_review:"bg-yellow-600",default:"bg-gray-500"};s.useEffect(()=>{(async()=>{try{P(!0);const w=localStorage.getItem("authToken"),r=await fetch(`${nt}/boards/project/${t}/activity?limit=${k}`,{headers:{Authorization:`Bearer ${w}`}});if(!r.ok)throw new Error("Failed to fetch activities");const _=await r.json();if(p(_),l)try{const R=await fetch(`${nt}/github/projects/${t}/activity?limit=${k}`,{headers:{Authorization:`Bearer ${w}`}});if(R.ok){const h=((await R.json()).activities||[]).map(f=>({_id:f._id,projectId:f.projectId,userId:f.sender?.login||"GitHub",userName:f.sender?.login||"GitHub",type:`github_${f.eventType}${f.action?"_"+f.action:""}`,title:b(f),metadata:f.payload,createdAt:f.createdAt,isGitHubActivity:!0,githubEventType:f.eventType,githubUrl:f.payload?.html_url||f.payload?.pull_request?.html_url}));H(h)}}catch(R){console.error("Error fetching GitHub activities:",R)}}catch(w){console.error("Error fetching activities:",w),G(w.message)}finally{P(!1)}})()},[t,k,l]);const b=j=>{const{eventType:w,action:r,payload:_}=j;switch(w){case"push":const R=_?.commits?.length||1;return`pushed ${R} commit${R>1?"s":""} to ${_?.ref?.replace("refs/heads/","")||"main"}`;case"pull_request":const i=_?.pull_request?.title||`PR #${_?.number}`;return r==="opened"?`opened pull request: ${i}`:r==="closed"&&_?.pull_request?.merged?`merged pull request: ${i}`:r==="closed"?`closed pull request: ${i}`:`${r} pull request: ${i}`;case"issue":const h=_?.issue?.title||`Issue #${_?.number}`;return`${r} issue: ${h}`;case"pull_request_review":return`reviewed pull request #${_?.pull_request?.number}`;case"issue_comment":return`commented on issue #${_?.issue?.number}`;default:return`${w} ${r||""}`.trim()}},x=s.useMemo(()=>(E?[...C,...F]:C).sort((w,r)=>new Date(r.createdAt).getTime()-new Date(w.createdAt).getTime()),[C,F,E]),m=s.useMemo(()=>{const j={};return x.forEach(w=>{const r=new Date(w.createdAt),_=new Date,R=new Date(_);R.setDate(R.getDate()-1);let i;r.toDateString()===_.toDateString()?i="Today":r.toDateString()===R.toDateString()?i="Yesterday":i=r.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),j[i]||(j[i]=[]),j[i].push(w)}),j},[x]),y=j=>new Date(j).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ne,{className:"w-6 h-6 animate-spin text-teal-500"})}):L?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx("p",{className:"text-red-500 mb-2",children:"Failed to load activities"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-teal-500 text-white rounded-lg",children:"Retry"})]}):C.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Pe,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{children:"No activities yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Activities will appear here when team members start working"})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm p-4 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-teal-500"}),"Activity Feed"]}),l&&F.length>0&&e.jsxs("button",{onClick:()=>N(!E),className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm transition-colors ${E?"bg-gray-900 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400"}`,children:[e.jsx(le,{className:"w-4 h-4"}),"GitHub (",F.length,")"]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(m).map(([j,w])=>e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-900 py-2 mb-3 z-10",children:e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:j})}),e.jsxs("div",{className:"space-y-4 relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700"}),w.map(r=>{const _=q[r.type]||q.default,R=D[r.type]||D.default;return e.jsxs("div",{className:"flex gap-4 relative",children:[e.jsx("div",{className:`relative z-10 w-8 h-8 rounded-full ${R} flex items-center justify-center text-white flex-shrink-0`,children:_}),e.jsx("div",{className:`flex-1 min-w-0 rounded-lg p-3 ${r.isGitHubActivity?"bg-gray-900/5 dark:bg-gray-800 border border-gray-200 dark:border-gray-700":"bg-gray-50 dark:bg-gray-800"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:r.userName})," ",e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:r.title})]}),r.isGitHubActivity&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-gray-900 text-white",children:[e.jsx(le,{className:"w-3 h-3"}),"GitHub"]}),r.githubUrl&&e.jsx("a",{href:r.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-teal-600 hover:underline",children:"View on GitHub →"})]}),r.metadata&&Object.keys(r.metadata).length>0&&!r.isGitHubActivity&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[r.metadata.taskTitle&&e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded",children:r.metadata.taskTitle}),r.metadata.columnFrom&&r.metadata.columnTo&&e.jsxs("span",{children:[" → ",r.metadata.columnFrom," to ",r.metadata.columnTo]}),r.metadata.velocity!==void 0&&e.jsxs("span",{children:[" • Velocity: ",r.metadata.velocity," points"]})]})]}),e.jsx("span",{className:"text-xs text-gray-400 flex-shrink-0",children:y(r.createdAt)})]})})]},r._id)})]})]},j))})]})}const ie="http://localhost:5000/api",oe=()=>({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`}),bt=async()=>{const t=await fetch(`${ie}/github/auth`,{headers:oe()});if(!t.ok)throw new Error("Failed to start GitHub authentication");return(await t.json()).authUrl},ft=async()=>{const t=await fetch(`${ie}/github/status`,{headers:oe()});if(!t.ok)throw new Error("Failed to get GitHub status");return t.json()},fs=async()=>{if(!(await fetch(`${ie}/github/disconnect`,{method:"DELETE",headers:oe()})).ok)throw new Error("Failed to disconnect GitHub")},js=async(t=1,k=30)=>{const l=await fetch(`${ie}/github/repos?page=${t}&perPage=${k}`,{headers:oe()});if(!l.ok)throw new Error("Failed to get repositories");return l.json()},ws=async(t,k,l={})=>{const C=new URLSearchParams;l.sha&&C.append("sha",l.sha),l.since&&C.append("since",l.since),l.until&&C.append("until",l.until),l.page&&C.append("page",String(l.page)),l.perPage&&C.append("perPage",String(l.perPage));const p=await fetch(`${ie}/github/repos/${t}/${k}/commits?${C.toString()}`,{headers:oe()});if(!p.ok)throw new Error("Failed to get commits");return p.json()},Ns=async(t,k,l="all")=>{const C=await fetch(`${ie}/github/repos/${t}/${k}/pulls?state=${l}`,{headers:oe()});if(!C.ok)throw new Error("Failed to get pull requests");return C.json()},vs=async(t,k)=>{const l=await fetch(`${ie}/github/repos/${t}/${k}/branches`,{headers:oe()});if(!l.ok)throw new Error("Failed to get branches");return l.json()},ks=async(t,k,l,C)=>{const p=await fetch(`${ie}/github/projects/${t}/connect`,{method:"POST",headers:oe(),body:JSON.stringify({repoOwner:k,repoName:l,syncSettings:C})});if(!p.ok){const F=await p.json();throw new Error(F.message||"Failed to connect repository")}return p.json()},Ss=async t=>{if(!(await fetch(`${ie}/github/projects/${t}/disconnect`,{method:"DELETE",headers:oe()})).ok)throw new Error("Failed to disconnect repository")},jt=async t=>{const k=await fetch(`${ie}/github/projects/${t}/status`,{headers:oe()});if(!k.ok)throw new Error("Failed to get project GitHub status");return k.json()},Cs=async(t,k=50,l=0)=>{const C=await fetch(`${ie}/github/projects/${t}/activity?limit=${k}&offset=${l}`,{headers:oe()});if(!C.ok)throw new Error("Failed to get GitHub activity");return C.json()};function $s({projectId:t,limit:k=20,compact:l=!1}){const[C,p]=s.useState([]),[F,H]=s.useState(!0),[z,P]=s.useState(null),L=s.useRef(!1),G=s.useCallback(async()=>{H(!0),P(null);try{const b=await Cs(t,k,0);p(b.activities)}catch(b){console.error("Error loading GitHub activity:",b),P("Failed to load GitHub activity")}finally{H(!1)}},[t,k]);s.useEffect(()=>{L.current||(L.current=!0,G())},[]);const E=(b,x)=>{switch(b){case"push":return e.jsx(le,{className:"w-4 h-4"});case"pull_request":return x==="closed"?e.jsx(Te,{className:"w-4 h-4"}):e.jsx(he,{className:"w-4 h-4"});case"issues":return e.jsx(me,{className:"w-4 h-4"});case"issue_comment":return e.jsx(wt,{className:"w-4 h-4"});case"create":return e.jsx(ce,{className:"w-4 h-4"});case"delete":return e.jsx(Ce,{className:"w-4 h-4"});default:return e.jsx(gt,{className:"w-4 h-4"})}},N=(b,x)=>{switch(b){case"push":return"text-blue-500 bg-blue-50 dark:bg-blue-900/20";case"pull_request":return x==="closed"?"text-purple-500 bg-purple-50 dark:bg-purple-900/20":"text-green-500 bg-green-50 dark:bg-green-900/20";case"issues":return"text-yellow-500 bg-yellow-50 dark:bg-yellow-900/20";case"issue_comment":return"text-gray-500 bg-gray-50 dark:bg-gray-900/50";case"create":return"text-teal-500 bg-teal-50 dark:bg-teal-900/20";case"delete":return"text-red-500 bg-red-50 dark:bg-red-900/20";default:return"text-gray-500 bg-gray-50 dark:bg-gray-900/50"}},q=b=>{const{eventType:x,action:m,payload:y,sender:j}=b;switch(x){case"push":{const w=y.commits?.length||0,r=y.ref?.replace("refs/heads/","");return e.jsxs("span",{children:[e.jsx("strong",{children:j.login})," pushed ",w," commit",w!==1?"s":""," to"," ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:r})]})}case"pull_request":{const w=y.pullRequest;return e.jsxs("span",{children:[e.jsx("strong",{children:j.login})," ",m," pull request"," ",e.jsxs("a",{href:w?.url,target:"_blank",rel:"noopener noreferrer",className:"text-teal-600 hover:underline",children:["#",w?.number]})," ","- ",w?.title]})}case"issues":{const w=y.issue;return e.jsxs("span",{children:[e.jsx("strong",{children:j.login})," ",m," issue"," ",e.jsxs("a",{href:w?.url,target:"_blank",rel:"noopener noreferrer",className:"text-teal-600 hover:underline",children:["#",w?.number]})," ","- ",w?.title]})}case"issue_comment":return e.jsxs("span",{children:[e.jsx("strong",{children:j.login})," commented on issue #",y.issue?.number]});case"create":return e.jsxs("span",{children:[e.jsx("strong",{children:j.login})," created ",y.refType," ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:y.ref})]});case"delete":return e.jsxs("span",{children:[e.jsx("strong",{children:j.login})," deleted ",y.refType," ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:y.ref})]});default:return e.jsxs("span",{children:[e.jsx("strong",{children:j.login})," performed ",x," ",m&&`(${m})`]})}},D=b=>{const x=new Date(b),y=new Date().getTime()-x.getTime(),j=Math.floor(y/6e4),w=Math.floor(y/36e5),r=Math.floor(y/864e5);return j<1?"just now":j<60?`${j}m ago`:w<24?`${w}h ago`:r<7?`${r}d ago`:x.toLocaleDateString()};return F?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading activity..."})]}):z?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-500",children:z}),e.jsx("button",{onClick:G,className:"mt-2 text-sm text-teal-600 hover:underline",children:"Try again"})]}):C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(le,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No GitHub activity yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Activity will appear here when webhook events are received"})]}):e.jsxs("div",{className:l?"":"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[!l&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"GitHub Activity"}),e.jsx("button",{onClick:G,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Refresh",children:e.jsx(Ne,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:l?"space-y-2":"divide-y divide-gray-100 dark:divide-gray-800",children:C.map((b,x)=>e.jsx("div",{className:`${l?"p-2":"p-4"} hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${N(b.eventType,b.action)}`,children:E(b.eventType,b.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[b.sender.avatarUrl&&e.jsx("img",{src:b.sender.avatarUrl,alt:b.sender.login,className:"w-5 h-5 rounded-full"}),e.jsx("p",{className:`text-gray-900 dark:text-white ${l?"text-sm":""}`,children:q(b)})]}),e.jsx("span",{className:"text-xs text-gray-400 whitespace-nowrap",children:D(b.createdAt)})]}),b.eventType==="push"&&b.payload.commits&&!l&&e.jsxs("div",{className:"mt-2 space-y-1",children:[b.payload.commits.slice(0,3).map((m,y)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("code",{className:"text-xs font-mono",children:m.sha?.slice(0,7)}),e.jsx("span",{className:"truncate",children:m.message?.split(`
`)[0]}),m.url&&e.jsx("a",{href:m.url,target:"_blank",rel:"noopener noreferrer",className:"text-teal-500 hover:text-teal-600",children:e.jsx(Re,{className:"w-3 h-3"})})]},m.sha||`commit-${y}`)),b.payload.commits.length>3&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",b.payload.commits.length-3," more commits"]})]})]})]})},b._id?.toString()||`activity-${x}`))})]})}function lt({onConnectionChange:t,compact:k}){const[l,C]=s.useState(null),[p,F]=s.useState(!0),[H,z]=s.useState(!1),[P,L]=s.useState(!1),[G,E]=s.useState(null),[N,q]=s.useState(null),D=s.useRef(!1);s.useEffect(()=>{const y=new URLSearchParams(window.location.search),j=y.get("github");if(j==="success")q("GitHub account connected successfully!"),window.history.replaceState({},"",window.location.pathname);else if(j==="error"){const w=y.get("message")||"Failed to connect GitHub account";E(w),window.history.replaceState({},"",window.location.pathname)}},[]);const b=s.useCallback(async()=>{F(!0);try{const y=await ft();C(y)}catch(y){console.error("Error fetching GitHub status:",y),E("Failed to check GitHub connection status")}finally{F(!1)}},[]);s.useEffect(()=>{D.current||(D.current=!0,b())},[]);const x=async()=>{z(!0),E(null);try{const y=await bt();window.location.href=y}catch(y){console.error("Error starting GitHub auth:",y),E("Failed to start GitHub authentication"),z(!1)}},m=async()=>{if(confirm("Are you sure you want to disconnect your GitHub account?")){L(!0),E(null);try{await fs(),C({connected:!1}),q("GitHub account disconnected")}catch(y){console.error("Error disconnecting GitHub:",y),E("Failed to disconnect GitHub account")}finally{L(!1)}}};return s.useEffect(()=>{if(N||G){const y=setTimeout(()=>{q(null),E(null)},5e3);return()=>clearTimeout(y)}},[N,G]),p?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"w-6 h-6 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Checking GitHub connection..."})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-900 dark:bg-white rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-white dark:text-gray-900"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"GitHub Integration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Connect your GitHub account for seamless integration"})]})]}),e.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Refresh status",children:e.jsx(Ne,{className:"w-4 h-4 text-gray-500"})})]}),G&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-400",children:G}),e.jsx("button",{onClick:()=>E(null),className:"ml-auto",children:e.jsx(xe,{className:"w-4 h-4 text-red-500"})})]}),N&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-400",children:N}),e.jsx("button",{onClick:()=>q(null),className:"ml-auto",children:e.jsx(xe,{className:"w-4 h-4 text-green-500"})})]}),e.jsx("div",{className:"p-4",children:l?.connected?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[l.avatarUrl&&e.jsx("img",{src:l.avatarUrl,alt:l.githubUsername,className:"w-12 h-12 rounded-full border-2 border-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["@",l.githubUsername]}),e.jsx("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full",children:"Connected"})]}),l.connectedAt&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Connected ",new Date(l.connectedAt).toLocaleDateString()]})]}),e.jsx("a",{href:`https://github.com/${l.githubUsername}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-4 h-4 text-gray-500"})})]}),l.scopes&&l.scopes.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Permissions:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.scopes.map((y,j)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs rounded",children:y},j))})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"What you can do:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-green-500"}),"Connect repositories to projects"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-green-500"}),"View commits, PRs, and issues"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-green-500"}),"Auto-sync GitHub issues with tasks"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-green-500"}),"Receive real-time GitHub events"]})]})]}),e.jsxs("button",{onClick:m,disabled:P,className:"w-full mt-4 py-2 px-4 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[P?e.jsx(ge,{className:"w-4 h-4 animate-spin"}):e.jsx(yt,{className:"w-4 h-4"}),P?"Disconnecting...":"Disconnect GitHub"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(we,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Connect Your GitHub Account"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-sm mx-auto",children:"Link your GitHub account to sync repositories, track commits, and automate task management with GitHub issues and pull requests."})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Features you'll unlock:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-teal-500"}),"Connect GitHub repos to your projects"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-teal-500"}),"View commits, branches, and PRs in-app"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-teal-500"}),"Auto-create tasks from GitHub issues"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-teal-500"}),"Auto-complete tasks when PRs merge"]})]})]}),e.jsxs("button",{onClick:x,disabled:H,className:"w-full py-3 px-4 bg-gray-900 dark:bg-white text-white dark:text-gray-900 rounded-lg hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[H?e.jsx(ge,{className:"w-5 h-5 animate-spin"}):e.jsx(we,{className:"w-5 h-5"}),H?"Connecting...":"Connect with GitHub"]}),e.jsx("p",{className:"text-xs text-center text-gray-400",children:"We'll ask for permission to access your repositories and create webhooks."})]})})]})}function it({projectId:t,projectName:k="Project"}){const[l,C]=s.useState(!1),[p,F]=s.useState(null),[H,z]=s.useState([]),[P,L]=s.useState(!0),[G,E]=s.useState(!1),[N,q]=s.useState(!1),[D,b]=s.useState(!1),[x,m]=s.useState(null),[y,j]=s.useState(null),[w,r]=s.useState(""),[_,R]=s.useState(!1),[i,h]=s.useState(null),[f,u]=s.useState(!1),[S,a]=s.useState({syncIssues:!0,syncPullRequests:!0,syncCommits:!0,autoPR:!1,autoIssue:!1}),n=s.useRef(!1),d=s.useCallback(async()=>{L(!0);try{const A=await ft();C(A.connected);const V=await jt(t);F(V)}catch(A){console.error("Error checking statuses:",A)}finally{L(!1)}},[t]);s.useEffect(()=>{n.current||(n.current=!0,d())},[]);const o=async()=>{E(!0);try{const A=await js(1,100);z(A.repos)}catch(A){console.error("Error loading repositories:",A),m("Failed to load repositories")}finally{E(!1)}},U=async()=>{try{const A=await bt();window.location.href=A}catch(A){console.error("Error starting GitHub auth:",A),m("Failed to start GitHub authentication")}},W=async A=>{q(!0),m(null);try{const[V,Y]=A.fullName.split("/");await ks(t,V,Y,S),j(`Connected ${A.fullName} to ${k}`),R(!1),h(null),await d()}catch(V){const Y=V instanceof Error?V.message:"Failed to connect repository";m(Y)}finally{q(!1)}},$=async()=>{if(confirm("Are you sure you want to disconnect this repository?")){b(!0),m(null);try{await Ss(t),j("Repository disconnected"),F({connected:!1})}catch(A){console.error("Error disconnecting repo:",A),m("Failed to disconnect repository")}finally{b(!1)}}},O=H.filter(A=>A.name.toLowerCase().includes(w.toLowerCase())||A.fullName.toLowerCase().includes(w.toLowerCase()));return s.useEffect(()=>{if(y||x){const A=setTimeout(()=>{j(null),m(null)},5e3);return()=>clearTimeout(A)}},[y,x]),P?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(ge,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading GitHub integration..."})]})}):l?p?.connected?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-900 dark:bg-white rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-white dark:text-gray-900"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"GitHub Repository"}),e.jsxs("a",{href:p.repoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-teal-600 hover:underline flex items-center gap-1",children:[p.repoFullName,e.jsx(Re,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>u(!f),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Settings",children:e.jsx(ze,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:$,disabled:D,className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-500",title:"Disconnect",children:D?e.jsx(ge,{className:"w-4 h-4 animate-spin"}):e.jsx(yt,{className:"w-4 h-4"})})]})]}),x&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-400",children:x}),e.jsx("button",{onClick:()=>m(null),className:"ml-auto",children:e.jsx(xe,{className:"w-4 h-4 text-red-500"})})]}),y&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-400",children:y}),e.jsx("button",{onClick:()=>j(null),className:"ml-auto",children:e.jsx(xe,{className:"w-4 h-4 text-green-500"})})]}),f&&e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Sync Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:p.syncSettings?.syncIssues,className:"w-4 h-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500",readOnly:!0}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Sync GitHub issues to tasks"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:p.syncSettings?.syncPullRequests,className:"w-4 h-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500",readOnly:!0}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Track pull requests"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:p.syncSettings?.syncCommits,className:"w-4 h-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500",readOnly:!0}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show commits in activity feed"})]})]})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[p.connectedAt&&e.jsxs("span",{children:["Connected ",new Date(p.connectedAt).toLocaleDateString()]}),p.lastSyncAt&&e.jsxs("span",{children:["Last sync: ",new Date(p.lastSyncAt).toLocaleString()]})]})})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx(Ae,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Connect Repository"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Link a GitHub repository to this project"})]})]})}),x&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-400",children:x}),e.jsx("button",{onClick:()=>m(null),className:"ml-auto",children:e.jsx(xe,{className:"w-4 h-4 text-red-500"})})]}),e.jsx("div",{className:"p-4",children:_?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search repositories...",value:w,onChange:A=>r(A.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sync Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S.syncIssues,onChange:A=>a({...S,syncIssues:A.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Sync Issues"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S.syncPullRequests,onChange:A=>a({...S,syncPullRequests:A.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Track PRs"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:S.syncCommits,onChange:A=>a({...S,syncCommits:A.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Show Commits"})]})]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:G?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading repositories..."})]}):O.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No repositories found"}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:O.map(A=>e.jsx("button",{onClick:()=>h(A),className:`w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${i?.id===A.id?"bg-teal-50 dark:bg-teal-900/20":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Nt,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:A.name}),A.private&&e.jsx(os,{className:"w-3 h-3 text-gray-400"}),i?.id===A.id&&e.jsx(ne,{className:"w-4 h-4 text-teal-500"})]}),A.description&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:A.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-400",children:[A.language&&e.jsx("span",{children:A.language}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(vt,{className:"w-3 h-3"})," ",A.starCount]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," ",A.forkCount]})]})]})]})},A.id?.toString()||A.fullName))})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{R(!1),h(null),r("")},className:"flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>i&&W(i),disabled:!i||N,className:"flex-1 py-2 px-4 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),"Connect Repository"]})})]})]}):e.jsxs("button",{onClick:()=>{R(!0),o()},className:"w-full py-3 px-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-teal-500 dark:hover:border-teal-500 transition-colors flex items-center justify-center gap-2 text-gray-600 dark:text-gray-400 hover:text-teal-600",children:[e.jsx(we,{className:"w-5 h-5"}),"Select a Repository"]})})]}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(we,{className:"w-6 h-6 text-gray-400"})}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Connect GitHub First"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"You need to connect your GitHub account before linking a repository."}),e.jsxs("button",{onClick:U,className:"px-4 py-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 rounded-lg hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors flex items-center gap-2 mx-auto",children:[e.jsx(we,{className:"w-4 h-4"}),"Connect GitHub"]})]})})}function Ds({projectId:t,isOwner:k}){const[l,C]=s.useState("overview"),[p,F]=s.useState(null),[H,z]=s.useState(!0),[P,L]=s.useState(null),[G,E]=s.useState([]),[N,q]=s.useState([]),[D,b]=s.useState([]),[x,m]=s.useState(!1),[y,j]=s.useState(!0),[w,r]=s.useState(!0),[_,R]=s.useState(!1),i=s.useRef(!1),h=s.useCallback(async()=>{z(!0),L(null);try{const a=await jt(t);F(a)}catch(a){console.error("Error loading GitHub status:",a),L("Failed to load GitHub connection status")}finally{z(!1)}},[t]),f=s.useCallback(async a=>{const[n,d]=a.split("/");if(!(!n||!d)){m(!0);try{const[o,U,W]=await Promise.all([ws(n,d,{perPage:10}),Ns(n,d),vs(n,d)]);E(o.commits||[]),q(U.pullRequests||[]),b(W.branches||[])}catch(o){console.error("Error loading repository data:",o)}finally{m(!1)}}},[]);s.useEffect(()=>{i.current||(i.current=!0,h())},[]),s.useEffect(()=>{p?.connected&&p?.repository?.fullName&&f(p.repository.fullName)},[p?.connected,p?.repository?.fullName]);const u=s.useCallback(()=>{h()},[h]),S=a=>{const n=new Date(a),o=new Date().getTime()-n.getTime(),U=Math.floor(o/6e4),W=Math.floor(o/36e5),$=Math.floor(o/864e5);return U<1?"just now":U<60?`${U}m ago`:W<24?`${W}h ago`:$<7?`${$}d ago`:n.toLocaleDateString()};return H?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(ge,{className:"w-6 h-6 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading GitHub integration..."})]}):P?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(me,{className:"w-10 h-10 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-red-500 font-medium",children:P}),e.jsx("button",{onClick:h,className:"mt-3 text-teal-600 hover:underline",children:"Try again"})]}):p?.connected?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:p.repository?.fullName}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-300",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${p.repository?.private?"bg-yellow-500/20 text-yellow-300":"bg-green-500/20 text-green-300"}`,children:p.repository?.private?"Private":"Public"}),e.jsxs("span",{className:`flex items-center gap-1 ${p.webhookActive?"text-green-400":"text-yellow-400"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${p.webhookActive?"bg-green-400":"bg-yellow-400"}`}),p.webhookActive?"Webhook Active":"Webhook Inactive"]})]})]})]}),e.jsx("a",{href:p.repository?.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})})]}),p.syncSettings&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[p.syncSettings.syncIssues&&e.jsx("span",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Issues"}),p.syncSettings.syncPullRequests&&e.jsx("span",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Pull Requests"}),p.syncSettings.syncCommits&&e.jsx("span",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Commits"}),p.syncSettings.autoCreateTasks&&e.jsx("span",{className:"px-2 py-1 bg-teal-500/20 text-teal-300 rounded text-xs",children:"Auto-Create Tasks"}),p.syncSettings.autoUpdateStatus&&e.jsx("span",{className:"px-2 py-1 bg-teal-500/20 text-teal-300 rounded text-xs",children:"Auto-Update Status"})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>C("overview"),className:`px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors ${l==="overview"?"border-teal-500 text-teal-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(le,{className:"w-4 h-4"}),"Overview"]}),e.jsxs("button",{onClick:()=>C("activity"),className:`px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors ${l==="activity"?"border-teal-500 text-teal-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(ct,{className:"w-4 h-4"}),"Activity"]}),k&&e.jsxs("button",{onClick:()=>C("settings"),className:`px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors ${l==="settings"?"border-teal-500 text-teal-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(ze,{className:"w-4 h-4"}),"Settings"]})]}),l==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:u,disabled:H||x,className:"flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-teal-600 dark:hover:text-teal-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(Ne,{className:`w-4 h-4 ${H||x?"animate-spin":""}`}),"Refresh"]})}),x&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ge,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading repository data..."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>j(!y),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Recent Commits"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",G.length,")"]})]}),y?e.jsx(Ie,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})]}),y&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 divide-y divide-gray-100 dark:divide-gray-700",children:G.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No commits found"}):G.map((a,n)=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[a.author?.avatarUrl&&e.jsx("img",{src:a.author.avatarUrl,alt:a.author.login,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-900 dark:text-white font-medium truncate",children:a.message.split(`
`)[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsx("code",{className:"text-xs font-mono",children:a.sha.slice(0,7)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:a.author?.login||a.author.name}),e.jsx("span",{children:"•"}),e.jsx("span",{children:S(a.author.date)})]})]}),e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors",children:e.jsx(Re,{className:"w-4 h-4 text-gray-400"})})]})},a.sha?.toString()||`commit-${n}`))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>r(!w),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Pull Requests"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",N.length,")"]})]}),w?e.jsx(Ie,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})]}),w&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 divide-y divide-gray-100 dark:divide-gray-700",children:N.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No open pull requests"}):N.map(a=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[a.merged?e.jsx(Te,{className:"w-5 h-5 text-purple-500 mt-0.5"}):a.state==="open"?e.jsx(he,{className:"w-5 h-5 text-green-500 mt-0.5"}):e.jsx(he,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-gray-900 dark:text-white font-medium",children:["#",a.number," ",a.title]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsx("img",{src:a.user.avatarUrl,alt:a.user.login,className:"w-4 h-4 rounded-full"}),e.jsx("span",{children:a.user.login}),e.jsx("span",{children:"•"}),e.jsx("span",{children:S(a.updatedAt)})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.merged?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300":a.state==="open"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"}`,children:a.merged?"Merged":a.state})]})},`pr-${a.number}`))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>R(!_),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-teal-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Branches"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",D.length,")"]})]}),_?e.jsx(Ie,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})]}),_&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 divide-y divide-gray-100 dark:divide-gray-700",children:D.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No branches found"}):D.map(a=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-mono text-sm text-gray-900 dark:text-white",children:a.name}),a.protected&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300 rounded text-xs",children:"Protected"})]})})},`branch-${a.name}`))})]})]}),l==="activity"&&e.jsx($s,{projectId:t,limit:50}),l==="settings"&&k&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(lt,{}),e.jsx(it,{projectId:t,onConnectionChange:h})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-800/50 rounded-xl",children:[e.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Connect GitHub Repository"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Link your GitHub repository to automatically sync issues, pull requests, and commits with your project tasks."})]}),e.jsx(lt,{compact:!0}),e.jsx(it,{projectId:t})]})}function _s({task:t,labels:k,onClick:l,onDragStart:C,onDragEnd:p,isDragging:F,currentUserId:H,isProjectOwner:z=!1}){console.log("🎯 TaskCard FULL DATA for:",t.title),console.log("   - assignees:",t.assignees),console.log("   - assignees length:",t.assignees?.length),console.log("   - full task:",JSON.stringify(t,null,2));const P=z||t.assignees?.some(r=>r._id===H||r.id===H||String(r._id)===H),L={low:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",medium:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",high:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",critical:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},G={low:e.jsx(Be,{className:"w-3 h-3"}),medium:e.jsx(Xe,{className:"w-3 h-3"}),high:e.jsx(me,{className:"w-3 h-3"}),critical:e.jsx(me,{className:"w-3 h-3"})},E=s.useMemo(()=>{if(t.subtasks.length===0)return null;const r=t.subtasks.filter(_=>_.completed).length;return{completed:r,total:t.subtasks.length,percentage:Math.round(r/t.subtasks.length*100)}},[t.subtasks]),N=s.useMemo(()=>Array.isArray(t.labels)?t.labels.map(r=>{if(typeof r=="object"&&r!==null&&"id"in r)return r;if(typeof r=="string")return k.find(_=>_.id===r)}).filter(r=>r!=null&&typeof r.id=="string"):[],[t.labels,k]),q=s.useMemo(()=>!t.dueDate||t.completedAt?!1:new Date(t.dueDate)<new Date,[t.dueDate,t.completedAt]),D=s.useMemo(()=>{if(!t.dueDate)return null;const r=new Date(t.dueDate),_=new Date,R=Math.ceil((r.getTime()-_.getTime())/(1e3*60*60*24));return R===0?"Today":R===1?"Tomorrow":R===-1?"Yesterday":R<0?`${Math.abs(R)} days ago`:R<7?`${R} days`:r.toLocaleDateString("en-US",{month:"short",day:"numeric"})},[t.dueDate]),b=s.useMemo(()=>{if(!t.totalTimeSpent)return null;const r=Math.floor(t.totalTimeSpent/60),_=t.totalTimeSpent%60;return r===0?`${_}m`:`${r}h ${_}m`},[t.totalTimeSpent]),x=t.github?.linkedPRs||[],m=t.github?.linkedCommits||[],y=x.length>0||m.length>0||t.github?.linkedIssueNumber,j=r=>r.state==="merged"?"text-purple-500 bg-purple-100 dark:bg-purple-900/30":r.state==="closed"?"text-red-500 bg-red-100 dark:bg-red-900/30":r.reviewStatus==="approved"?"text-green-500 bg-green-100 dark:bg-green-900/30":r.reviewStatus==="changes_requested"?"text-orange-500 bg-orange-100 dark:bg-orange-900/30":"text-blue-500 bg-blue-100 dark:bg-blue-900/30",w=r=>r.state==="merged"?e.jsx(Te,{className:"w-3 h-3"}):r.checksStatus==="success"?e.jsx($e,{className:"w-3 h-3"}):r.checksStatus==="failure"?e.jsx(me,{className:"w-3 h-3"}):e.jsx(he,{className:"w-3 h-3"});return e.jsxs("div",{draggable:P,onDragStart:P?C:void 0,onDragEnd:P?p:void 0,onClick:l,className:`
        bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700
        p-3 cursor-pointer transition-all duration-200
        hover:shadow-md hover:border-purple-300 dark:hover:border-purple-600
        ${F?"opacity-50 rotate-3 scale-105":""}
        ${P?"":"cursor-default"}
      `,title:P?void 0:"Only assignees can move this task",children:[N.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:N.map(r=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full text-white",style:{backgroundColor:r.color},children:r.name},r.id))}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white text-sm mb-2 line-clamp-2",children:t.title}),e.jsx("div",{className:"flex items-center gap-2 mb-2 p-1.5 bg-gray-50 dark:bg-gray-700/50 rounded-md",children:t.assignees&&t.assignees.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex -space-x-1",children:t.assignees.map((r,_)=>{const R=typeof r=="string"?{_id:r,name:r,email:""}:r,i=R?.name||R?.email||"User";return e.jsx("div",{className:"w-5 h-5 rounded-full bg-teal-500 flex items-center justify-center text-white text-[10px] font-medium border border-white dark:border-gray-800",title:i,children:R?.avatar?e.jsx("img",{src:R.avatar,alt:i,className:"w-full h-full rounded-full"}):i.charAt(0).toUpperCase()},R?._id||`assignee-${_}`)})}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-300 font-medium truncate",children:t.assignees.map((r,_)=>{const R=typeof r=="string"?r:r?.name||r?.email||"User";return _===0?R:`, ${R}`}).join("")})]}):e.jsx("span",{className:"text-xs text-gray-400 italic",children:"Unassigned"})}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 line-clamp-2",children:t.description}),E&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"}),E.completed,"/",E.total]}),e.jsxs("span",{children:[E.percentage,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 rounded-full transition-all duration-300",style:{width:`${E.percentage}%`}})})]}),y&&e.jsxs("div",{className:"mb-2 space-y-1",children:[x.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.slice(0,2).map(r=>e.jsxs("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",onClick:_=>_.stopPropagation(),className:`flex items-center gap-1 px-1.5 py-0.5 rounded text-xs ${j(r)} hover:opacity-80 transition-opacity`,title:`PR #${r.number}: ${r.title}`,children:[w(r),e.jsxs("span",{children:["#",r.number]})]},r.number)),x.length>2&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",x.length-2]})]}),m.length>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsxs("span",{children:[m.length," commit",m.length>1?"s":""]})]}),t.github?.linkedIssueNumber&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600 dark:text-green-400",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsxs("span",{children:["Issue #",t.github.linkedIssueNumber]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`flex items-center gap-0.5 px-1.5 py-0.5 rounded ${L[t.priority]}`,children:[G[t.priority],e.jsx("span",{className:"capitalize",children:t.priority})]}),t.storyPoints&&e.jsxs("span",{className:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 px-1.5 py-0.5 rounded",children:[t.storyPoints," pts"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[t.comments.length>0&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(_e,{className:"w-3 h-3"}),t.comments.length]}),t.attachments.length>0&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(Ke,{className:"w-3 h-3"}),t.attachments.length]})]})]}),e.jsx("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[D&&e.jsxs("span",{className:`flex items-center gap-1 ${q?"text-red-500":"text-gray-500 dark:text-gray-400"}`,children:[e.jsx(Ge,{className:"w-3 h-3"}),D]}),b&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-500 dark:text-gray-400",children:[e.jsx(ve,{className:"w-3 h-3"}),b]})]})})]})}function As({column:t,tasks:k,labels:l,currentUserId:C,isProjectOwner:p,onAddTask:F,onTaskClick:H,onDragStart:z,onDragEnd:P,onDragOver:L,onDrop:G,onColumnSettings:E,onToggleCollapse:N,dragOverColumnId:q}){const[D,b]=s.useState(!1),x=s.useRef(null),m=k.length,y=t.taskLimit&&m>t.taskLimit,j=q===t.id,w=[...k].sort((r,_)=>{const R=r.assignees?.some(h=>(typeof h=="string"?h:h?._id||h?.userId)===C),i=_.assignees?.some(h=>(typeof h=="string"?h:h?._id||h?.userId)===C);return R&&!i?-1:!R&&i?1:r.position-_.position});return t.isCollapsed?e.jsx("div",{className:"flex-shrink-0 w-12 bg-white dark:bg-gray-800 rounded-xl p-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-lg border border-gray-200 dark:border-gray-700",onClick:()=>N?.(t.id),children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-[#00ADB5]"}),e.jsx("span",{className:"writing-mode-vertical text-xs font-medium text-gray-700 dark:text-gray-300",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:t.title}),e.jsx("span",{className:"bg-[#00ADB5]/10 text-[#00ADB5] px-1.5 py-0.5 rounded-full text-xs font-medium",children:m})]})}):e.jsxs("div",{ref:x,className:`
        flex-shrink-0 w-72 bg-white dark:bg-gray-800 rounded-xl flex flex-col shadow-lg border border-gray-200 dark:border-gray-700
        transition-all duration-200
        ${j?"ring-2 ring-[#00ADB5] bg-[#00ADB5]/5 dark:bg-[#00ADB5]/10":""}
      `,onDragOver:L,onDrop:r=>G(r,t.id),children:[e.jsxs("div",{className:"p-3 flex items-center justify-between border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:t.title}),e.jsxs("span",{className:`
              px-2 py-0.5 rounded-full text-xs font-medium
              ${y?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}
            `,children:[m,t.taskLimit&&` / ${t.taskLimit}`]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>N?.(t.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors",title:"Collapse column",children:e.jsx(pt,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:()=>F(t.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors",title:"Add task",children:e.jsx(be,{className:"w-4 h-4 text-gray-500"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>b(!D),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors",children:e.jsx(Ut,{className:"w-4 h-4 text-gray-500"})}),D&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>b(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20 py-1",children:e.jsxs("button",{onClick:()=>{E?.(t),b(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),"Column Settings"]})})]})]})]})]}),y&&e.jsx("div",{className:"mx-3 mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400",children:["⚠️ WIP limit exceeded (",m,"/",t.taskLimit,")"]})}),e.jsx("div",{className:"flex-1 p-2 space-y-2 overflow-y-auto max-h-[calc(100vh-300px)] min-h-[100px]",children:w.length===0?e.jsx("div",{className:"flex items-center justify-center h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-400",children:"Drop tasks here"})}):w.map((r,_)=>e.jsx(_s,{task:r,labels:l,currentUserId:C,isProjectOwner:p,onClick:()=>H(r),onDragStart:R=>z(R,r._id,t.id),onDragEnd:P},typeof r._id=="string"?r._id:String(r._id)||`task-${_}`))}),p&&e.jsx("div",{className:"p-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{onClick:()=>F(t.id),className:"w-full flex items-center justify-center gap-1 py-2.5 text-sm text-[#00ADB5] font-medium hover:bg-[#00ADB5]/10 rounded-lg transition-all",children:[e.jsx(be,{className:"w-4 h-4"}),"Add Task"]})})]})}function Ts({columnId:t,columns:k,labels:l,members:C,onClose:p,onCreate:F}){const[H,z]=s.useState(""),[P,L]=s.useState(""),[G,E]=s.useState("medium"),[N,q]=s.useState([]),[D,b]=s.useState([]),[x,m]=s.useState(""),[y,j]=s.useState(""),[w,r]=s.useState(""),[_,R]=s.useState(!1),i=async a=>{if(a.preventDefault(),!!H.trim()){if(D.length===0){alert("Please assign at least one team member to this task");return}R(!0);try{await F({title:H.trim(),description:P.trim()||void 0,priority:G,labels:N,assignees:D,dueDate:x||void 0,estimatedHours:y?parseFloat(y):void 0,storyPoints:w?parseInt(w):void 0})}finally{R(!1)}}},h=a=>{q(n=>n.includes(a)?n.filter(d=>d!==a):[...n,a])},f=a=>{b(n=>n.includes(a)?n.filter(d=>d!==a):[...n,a])},u={low:"bg-green-100 text-green-700 border-green-300",medium:"bg-yellow-100 text-yellow-700 border-yellow-300",high:"bg-orange-100 text-orange-700 border-orange-300",critical:"bg-red-100 text-red-700 border-red-300"},S=k.find(a=>a.id===t);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-lg mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:S?.color}}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["New Task in ",S?.title]})]}),e.jsx("button",{onClick:p,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:i,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:H,onChange:a=>z(a.target.value),placeholder:"Enter task title...",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-[#00ADB5] focus:border-[#00ADB5]",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:P,onChange:a=>L(a.target.value),placeholder:"Add a description...",rows:3,className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg resize-none focus:ring-2 focus:ring-[#00ADB5] focus:border-[#00ADB5]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-2",children:["low","medium","high","critical"].map(a=>e.jsx("button",{type:"button",onClick:()=>E(a),className:`px-3 py-1.5 rounded-lg border text-sm capitalize transition-all ${G===a?u[a]+" ring-2 ring-offset-1":"bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-700 text-gray-600 dark:text-gray-400"}`,children:a},a))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(gt,{className:"w-4 h-4 inline mr-1"}),"Labels"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(a=>e.jsx("button",{type:"button",onClick:()=>h(a.id),className:`px-2 py-1 rounded-full text-xs transition-all ${N.includes(a.id)?"text-white ring-2 ring-offset-1":"opacity-60 hover:opacity-100"}`,style:{backgroundColor:a.color},children:a.name},a.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(Je,{className:"w-4 h-4 inline mr-1"}),"Assignee *",e.jsx("span",{className:"text-xs text-red-500 ml-1",children:"(Required)"})]}),D.length===0&&e.jsx("p",{className:"text-xs text-red-500 mb-2",children:"Please select at least one assignee"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:C.map(a=>e.jsxs("button",{type:"button",onClick:()=>f(a.userId),className:`flex items-center gap-2 px-2 py-1 rounded-lg text-sm transition-all ${D.includes(a.userId)?"bg-[#00ADB5]/10 dark:bg-[#00ADB5]/20 text-[#00ADB5] ring-2 ring-[#00ADB5] ring-offset-1":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gradient-to-r from-[#00ADB5] to-cyan-500 flex items-center justify-center text-white text-xs",children:a.name.charAt(0).toUpperCase()}),a.name]},a.userId))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx(Ge,{className:"w-4 h-4 inline mr-1"}),"Due Date"]}),e.jsx("input",{type:"date",value:x,onChange:a=>m(a.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Est. Hours"}),e.jsx("input",{type:"number",value:y,onChange:a=>j(a.target.value),placeholder:"0",min:"0",step:"0.5",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Story Points"}),e.jsx("input",{type:"number",value:w,onChange:a=>r(a.target.value),placeholder:"0",min:"0",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!H.trim()||_,className:"px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white font-medium rounded-lg hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:_?"Creating...":"Create Task"})]})]})]})})}function Es({task:t,labels:k,columns:l,members:C,currentUserId:p,isProjectOwner:F,onClose:H,onUpdate:z,onDelete:P,onAddComment:L,onAddSubtask:G,onToggleSubtask:E,onStartTimer:N,onStopTimer:q,onSubmitForReview:D,onApprove:b,onRequestChanges:x}){const[m,y]=s.useState(!1),[j,w]=s.useState(t.title),[r,_]=s.useState(t.description||""),[R,i]=s.useState(!1),[h,f]=s.useState(""),[u,S]=s.useState(""),[a,n]=s.useState(!1),[d,o]=s.useState(!1),[U,W]=s.useState(!1),[$,O]=s.useState(!1),[A,V]=s.useState(!1),[Y,ue]=s.useState(""),[ae,fe]=s.useState("approve"),se=l.find(g=>g.id===t.columnId),ke=se?.title.toLowerCase()==="review",Se=F&&(t.reviewStatus==="pending"||t.reviewStatus!=="approved"&&ke);console.log("🎯 TaskDetailModal Review Debug:",{isProjectOwner:F,taskReviewStatus:t.reviewStatus,taskColumnId:t.columnId,currentColumnTitle:se?.title,isReviewColumn:ke,shouldShowReviewButtons:Se});const je=s.useMemo(()=>t.timeEntries.find(g=>g.userId===p&&!g.endTime),[t.timeEntries,p]),X=s.useMemo(()=>F?!0:t.assignees?.some(g=>(typeof g=="string"?g:g?._id||g?.userId)===p),[t.assignees,p,F]),J=s.useMemo(()=>{if(t.subtasks.length===0)return null;const g=t.subtasks.filter(ee=>ee.completed).length;return{completed:g,total:t.subtasks.length,percentage:Math.round(g/t.subtasks.length*100)}},[t.subtasks]),c=g=>{const ee=Math.floor(g/60),de=g%60;return ee===0?`${de}m`:`${ee}h ${de}m`},v=()=>{j.trim()&&j!==t.title&&z(t._id,{title:j.trim()}),y(!1)},B=()=>{r!==t.description&&z(t._id,{description:r}),i(!1)},T=g=>{const ee=t.labels.includes(g)?t.labels.filter(de=>de!==g):[...t.labels,g];z(t._id,{labels:ee})},K=g=>{const de=t.assignees.map(Ee=>Ee._id).includes(g)?t.assignees.filter(Ee=>Ee._id!==g):[...t.assignees,C.find(Ee=>Ee.userId===g)].filter(Boolean);z(t._id,{assignees:de})},M=g=>{g!==t.columnId&&z(t._id,{columnId:g}),W(!1)},I=g=>{z(t._id,{priority:g})},Q=g=>{z(t._id,{dueDate:g.target.value||void 0})},re=g=>{if(g.preventDefault(),!h.trim())return;const ee=h.match(/@(\w+)/g)?.map(de=>de.slice(1))||[];L(t._id,h.trim(),ee),f("")},Ue=g=>{g.preventDefault(),u.trim()&&(G(t._id,u.trim()),S(""))},De={low:"bg-green-100 text-green-700 border-green-300",medium:"bg-yellow-100 text-yellow-700 border-yellow-300",high:"bg-orange-100 text-orange-700 border-orange-300",critical:"bg-red-100 text-red-700 border-red-300"};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center z-50 overflow-y-auto py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-3xl mx-4 relative",children:[e.jsx("button",{onClick:H,className:"absolute top-4 right-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[t.labels.map(g=>{const ee=k.find(de=>de.id===g);return ee?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full text-white",style:{backgroundColor:ee.color},children:ee.name},ee.id):null}),X&&e.jsxs("button",{onClick:()=>n(!a),className:"px-2 py-1 text-xs rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700",children:[e.jsx(be,{className:"w-3 h-3 inline"})," Label"]})]}),a&&e.jsx("div",{className:"absolute left-6 mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-10 py-1",children:k.map(g=>e.jsxs("button",{onClick:()=>T(g.id),className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:g.color}}),e.jsx("span",{children:g.name}),t.labels.includes(g.id)&&e.jsx(ne,{className:"w-4 h-4 ml-auto text-green-500"})]},g.id))}),m&&X?e.jsx("input",{type:"text",value:j,onChange:g=>w(g.target.value),onBlur:v,onKeyDown:g=>g.key==="Enter"&&v(),className:"w-full text-xl font-bold bg-transparent border-b-2 border-[#00ADB5] outline-none dark:text-white",autoFocus:!0}):e.jsx("h2",{onClick:()=>X&&y(!0),className:`text-xl font-bold text-gray-900 dark:text-white pr-8 ${X?"cursor-pointer hover:text-[#00ADB5]":""}`,children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3 text-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>W(!U),className:"flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:l.find(g=>g.id===t.columnId)?.color}}),l.find(g=>g.id===t.columnId)?.title]}),U&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-40 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-10 py-1",children:l.map(g=>e.jsxs("button",{onClick:()=>M(g.id),className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:g.color}}),g.title,g.id===t.columnId&&e.jsx(ne,{className:"w-4 h-4 ml-auto text-green-500"})]},g.id))})]}),X?e.jsxs("select",{value:t.priority,onChange:g=>I(g.target.value),className:`px-2 py-1 rounded-lg border text-sm ${De[t.priority]}`,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]}):e.jsx("span",{className:`px-2 py-1 rounded-lg border text-sm ${De[t.priority]}`,children:t.priority.charAt(0).toUpperCase()+t.priority.slice(1)}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4 text-gray-400"}),X?e.jsx("input",{type:"date",value:t.dueDate?t.dueDate.split("T")[0]:"",onChange:Q,className:"bg-transparent border-none text-sm text-gray-600 dark:text-gray-400"}):e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.dueDate?new Date(t.dueDate).toLocaleDateString():"No due date"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Points:"}),X?e.jsx("input",{type:"number",value:t.storyPoints||"",onChange:g=>z(t._id,{storyPoints:parseInt(g.target.value)||void 0}),className:"w-12 bg-gray-100 dark:bg-gray-800 rounded px-2 py-1 text-sm",placeholder:"0",min:"0"}):e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.storyPoints||0})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[t.reviewStatus&&t.reviewStatus!=="not_submitted"&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ${t.reviewStatus==="approved"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.reviewStatus==="pending"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:[t.reviewStatus==="approved"&&e.jsx(et,{className:"w-4 h-4"}),t.reviewStatus==="pending"&&e.jsx(ve,{className:"w-4 h-4"}),t.reviewStatus==="changes_requested"&&e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:t.reviewStatus.replace("_"," ")})]}),t.reviewedBy&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Reviewed by ",t.reviewedBy.name," on ",new Date(t.reviewedAt).toLocaleDateString()]})]}),t.reviewComment&&t.reviewStatus==="changes_requested"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-400",children:[e.jsx("strong",{children:"Changes Requested:"})," ",t.reviewComment]})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[X&&!F&&t.reviewStatus==="not_submitted"&&D&&e.jsxs("button",{onClick:()=>D(t._id),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg transition-all",children:[e.jsx(Me,{className:"w-4 h-4"}),"Submit for Review"]}),X&&!F&&t.reviewStatus==="changes_requested"&&D&&e.jsxs("button",{onClick:()=>D(t._id),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg transition-all",children:[e.jsx(Me,{className:"w-4 h-4"}),"Re-submit for Review"]}),Se&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{fe("approve"),V(!0)},className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600",children:[e.jsx(et,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>{fe("changes"),V(!0)},className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600",children:[e.jsx(Et,{className:"w-4 h-4"}),"Request Changes"]})]})]})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md mx-4 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:ae==="approve"?"✅ Approve Task":"❌ Request Changes"}),e.jsx("textarea",{value:Y,onChange:g=>ue(g.target.value),placeholder:ae==="approve"?"Add approval comment (optional)...":"Describe the changes needed (required)...",className:"w-full h-32 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 resize-none mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{ae==="approve"?b?.(t._id,Y):Y.trim()&&x?.(t._id,Y),V(!1),ue("")},disabled:ae==="changes"&&!Y.trim(),className:`flex-1 py-2 rounded-lg text-white text-sm ${ae==="approve"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed"}`,children:ae==="approve"?"Approve":"Request Changes"}),e.jsx("button",{onClick:()=>{V(!1),ue("")},className:"flex-1 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 p-6",children:[e.jsxs("div",{className:"col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Description"]}),R&&X?e.jsxs("div",{children:[e.jsx("textarea",{value:r,onChange:g=>_(g.target.value),className:"w-full h-32 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 resize-none",placeholder:"Add a description..."}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:B,className:"px-3 py-1 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{_(t.description||""),i(!1)},className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]}):e.jsx("div",{onClick:()=>X&&i(!0),className:`p-3 bg-gray-50 dark:bg-gray-800 rounded-lg min-h-[80px] ${X?"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":""}`,children:t.description||e.jsx("span",{className:"text-gray-400",children:X?"Click to add description...":"No description"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4"}),"Subtasks",J&&e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",J.completed,"/",J.total,")"]})]}),J&&e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all duration-300",style:{width:`${J.percentage}%`}})}),e.jsx("div",{className:"space-y-2",children:t.subtasks.map(g=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("button",{onClick:()=>X&&E(t._id,g.id,!g.completed),disabled:!X,className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${X?"":"cursor-not-allowed opacity-60"} ${g.completed?"bg-green-500 border-green-500 text-white":"border-gray-300 dark:border-gray-600 hover:border-green-400"}`,children:g.completed&&e.jsx(ne,{className:"w-3 h-3"})}),e.jsx("span",{className:g.completed?"line-through text-gray-400":"text-gray-700 dark:text-gray-300",children:g.text})]},g.id))}),X&&e.jsxs("form",{onSubmit:Ue,className:"mt-2 flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:g=>S(g.target.value),placeholder:"Add a subtask...",className:"flex-1 px-3 py-2 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 text-sm"}),e.jsx("button",{type:"submit",disabled:!u.trim(),className:"px-3 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg disabled:opacity-50 transition-all",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Comments (",t.comments.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:t.comments.map(g=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#00ADB5] to-cyan-500 flex items-center justify-center text-white text-sm",children:g.authorName.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900 dark:text-white",children:g.authorName}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(g.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:g.content})]})]},g.id))}),X&&e.jsxs("form",{onSubmit:re,className:"mt-3",children:[e.jsx("textarea",{value:h,onChange:g=>f(g.target.value),placeholder:"Write a comment... Use @username to mention someone",className:"w-full p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 resize-none text-sm",rows:2}),e.jsx("button",{type:"submit",disabled:!h.trim(),className:"mt-2 px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg disabled:opacity-50 transition-all",children:"Post Comment"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Assignees"]}),e.jsxs("div",{className:"space-y-2",children:[t.assignees.map((g,ee)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-[#00ADB5] to-cyan-500 flex items-center justify-center text-white text-xs",children:(g.name||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:g.name||"Unknown"})]},typeof g._id=="string"?g._id:String(g._id)||`assignee-${ee}`)),F&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>o(!d),className:"flex items-center gap-1 text-sm text-[#00ADB5] hover:text-cyan-600",children:[e.jsx(be,{className:"w-4 h-4"}),"Add assignee"]}),d&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:C.map(g=>e.jsxs("button",{onClick:()=>K(g.userId),className:"w-full flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center text-xs",children:g.name.charAt(0).toUpperCase()}),e.jsx("span",{children:g.name}),t.assignees.some(ee=>ee._id===g.userId)&&e.jsx(ne,{className:"w-4 h-4 ml-auto text-green-500"})]},g.userId))})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Time Tracking"]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:c(t.totalTimeSpent)}),t.estimatedHours&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Estimated: ",t.estimatedHours,"h"]}),X&&(je?e.jsxs("button",{onClick:()=>q(t._id,je.id),className:"w-full flex items-center justify-center gap-2 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:[e.jsx(gs,{className:"w-4 h-4"}),"Stop Timer"]}):e.jsxs("button",{onClick:()=>N(t._id),className:"w-full flex items-center justify-center gap-2 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Start Timer"]}))]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Attachments (",t.attachments.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.attachments.map(g=>e.jsxs("a",{href:g.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:[e.jsx(Ke,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"truncate",children:g.name})]},g.id))})]}),X&&e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:$?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-red-600",children:"Are you sure you want to delete this task?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P(t._id),className:"flex-1 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600",children:"Delete"}),e.jsx("button",{onClick:()=>O(!1),className:"flex-1 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>O(!0),className:"w-full flex items-center justify-center gap-2 py-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-sm",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Delete Task"]})})]})]})]})})}const te="http://localhost:5000/api";function Ps({projectId:t,boardId:k,members:l,currentUserId:C,currentUserName:p,isProjectOwner:F,onViewChange:H}){console.log("📋 KanbanBoard - isProjectOwner received:",F);const[z,P]=s.useState(!0),[L,G]=s.useState(null),[E,N]=s.useState([]),[q,D]=s.useState(null),[b,x]=s.useState(null),[m,y]=s.useState(""),[j,w]=s.useState("all"),[r,_]=s.useState("all"),[R,i]=s.useState(null),[h,f]=s.useState(null),[u,S]=s.useState(null),a=()=>localStorage.getItem("authToken"),n=s.useCallback(async()=>{try{P(!0),S(null);const v={"Content-Type":"application/json",Authorization:`Bearer ${a()}`},B=await fetch(`${te}/boards/project/${t}`,{headers:v});if(!B.ok)throw new Error("Failed to fetch boards");const T=await B.json();if(T.length===0){const K=await fetch(`${te}/boards/project/${t}`,{method:"POST",headers:v,body:JSON.stringify({title:"Main Board"})});if(!K.ok)throw new Error("Failed to create board");const M=await K.json();G(M),N([])}else{const K=k&&T.find(Q=>Q._id===k)||T[0],M=await fetch(`${te}/boards/${K._id}`,{headers:v});if(!M.ok)throw new Error("Failed to fetch board");const I=await M.json();G(I.board||I),N(I.tasks||[])}}catch(c){console.error("Error fetching board:",c),S(c.message)}finally{P(!1)}},[t,k]);s.useEffect(()=>{n()},[n]);const d=s.useMemo(()=>E.filter(c=>{if(m){const v=m.toLowerCase(),B=c.title.toLowerCase().includes(v),T=c.description?.toLowerCase().includes(v);if(!B&&!T)return!1}return!(j!=="all"&&c.priority!==j||r!=="all"&&(r==="unassigned"&&c.assignees.length>0||r!=="unassigned"&&!c.assignees.some(v=>v._id===r)))}),[E,m,j,r]),o=s.useMemo(()=>{const c={};return L&&L.columns.forEach(v=>{c[v.id]=d.filter(B=>B.columnId===v.id).sort((B,T)=>B.position-T.position)}),c},[L,d]),U=(c,v,B)=>{c.dataTransfer.setData("text/plain",v),f({taskId:v,columnId:B})},W=()=>{f(null),i(null)},$=c=>{c.preventDefault()},O=async(c,v)=>{c.preventDefault();const B=c.dataTransfer.getData("text/plain");if(i(null),!h||h.columnId===v){f(null);return}if(L?.columns.find(M=>M.id===v)?.title.toLowerCase()==="done"&&!F){alert("Only the project owner can move tasks to Done by approving them in the Review column."),f(null);return}try{const M=a(),Q=(o[v]||[]).length;if(!(await fetch(`${te}/boards/tasks/${B}/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${M}`},body:JSON.stringify({columnId:v,position:Q})})).ok)throw new Error("Failed to move task");N(Ue=>Ue.map(De=>De._id===B?{...De,columnId:v,position:Q}:De))}catch(M){console.error("Error moving task:",M)}f(null)},A=async c=>{if(!(!L||!b)){console.log("🎯 handleCreateTask called with:",c),console.log("   - taskData.assignees:",c.assignees);try{const v=a(),B=[];if(Array.isArray(c.assignees)){for(const M of c.assignees)if(typeof M=="string")B.push(M);else if(M&&typeof M=="object"){const I=M._id||M.userId||M.id;if(I)B.push(I);else if(M.email){const Q=l.find(re=>re.email===M.email);Q?.userId&&B.push(Q.userId)}}}console.log("   - processedAssignees:",B);const T=await fetch(`${te}/boards/${L._id}/tasks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify({...c,columnId:b.columnId,labels:Array.isArray(c.labels)?c.labels.map(M=>typeof M=="string"?M:M?.id).filter(Boolean):[],assignees:B})});if(!T.ok){const M=await T.json().catch(()=>({}));throw new Error(M.message||"Failed to create task")}const K=await T.json();N(M=>[...M,K]),x(null)}catch(v){throw console.error("Error creating task:",v),v}}},V=async(c,v)=>{try{const B=a(),T=await fetch(`${te}/boards/tasks/${c}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify(v)});if(!T.ok)throw new Error("Failed to update task");const K=await T.json();N(M=>M.map(I=>I._id===c?K:I)),q?._id===c&&D(K)}catch(B){console.error("Error updating task:",B)}},Y=async c=>{try{const v=a();if(!(await fetch(`${te}/boards/tasks/${c}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}})).ok)throw new Error("Failed to delete task");N(T=>T.filter(K=>K._id!==c)),D(null)}catch(v){console.error("Error deleting task:",v)}},ue=async(c,v,B)=>{try{const T=a();if(!(await fetch(`${te}/boards/tasks/${c}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T}`},body:JSON.stringify({content:v,mentions:B})})).ok)throw new Error("Failed to add comment");const M=await fetch(`${te}/boards/tasks/${c}`,{headers:{Authorization:`Bearer ${T}`}});if(M.ok){const I=await M.json();N(Q=>Q.map(re=>re._id===c?I:re)),q?._id===c&&D(I)}}catch(T){console.error("Error adding comment:",T)}},ae=async(c,v)=>{try{const B=a(),T=await fetch(`${te}/boards/tasks/${c}/subtasks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify({text:v})});if(!T.ok)throw new Error("Failed to add subtask");const K=await T.json();N(M=>M.map(I=>I._id===c?{...I,subtasks:[...I.subtasks,K]}:I)),q?._id===c&&D(M=>M?{...M,subtasks:[...M.subtasks,K]}:null)}catch(B){console.error("Error adding subtask:",B)}},fe=async(c,v,B)=>{try{const T=a(),K=await fetch(`${te}/boards/tasks/${c}/subtasks/${v}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T}`},body:JSON.stringify({completed:B})});if(!K.ok)throw new Error("Failed to toggle subtask");const M=await K.json();N(I=>I.map(Q=>Q._id===c?{...Q,subtasks:Q.subtasks.map(re=>re.id===v?M:re)}:Q)),q?._id===c&&D(I=>I?{...I,subtasks:I.subtasks.map(Q=>Q.id===v?M:Q)}:null)}catch(T){console.error("Error toggling subtask:",T)}},se=async(c,v)=>{try{const B=a(),T=await fetch(`${te}/boards/tasks/${c}/time/start`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify({description:v})});if(!T.ok)throw new Error("Failed to start timer");const K=await T.json();N(M=>M.map(I=>I._id===c?{...I,timeEntries:[...I.timeEntries,K]}:I)),q?._id===c&&D(M=>M?{...M,timeEntries:[...M.timeEntries,K]}:null)}catch(B){console.error("Error starting timer:",B)}},ke=async(c,v)=>{try{const B=a(),T=await fetch(`${te}/boards/tasks/${c}/time/${v}/stop`,{method:"PATCH",headers:{Authorization:`Bearer ${B}`}});if(!T.ok)throw new Error("Failed to stop timer");const{timeEntry:K,totalTimeSpent:M}=await T.json();N(I=>I.map(Q=>Q._id===c?{...Q,timeEntries:Q.timeEntries.map(re=>re.id===v?K:re),totalTimeSpent:M}:Q)),q?._id===c&&D(I=>I?{...I,timeEntries:I.timeEntries.map(Q=>Q.id===v?K:Q),totalTimeSpent:M}:null)}catch(B){console.error("Error stopping timer:",B)}},Se=async c=>{try{const v=a(),B=await fetch(`${te}/boards/tasks/${c}/submit-review`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`}});if(!B.ok)throw new Error("Failed to submit task for review");const T=await B.json();N(K=>K.map(M=>M._id===c?T:M)),q?._id===c&&D(T)}catch(v){console.error("Error submitting task for review:",v)}},je=async(c,v)=>{try{const B=a(),T=await fetch(`${te}/boards/tasks/${c}/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify({comment:v})});if(!T.ok){const M=await T.json();throw new Error(M.message||"Failed to approve task")}const K=await T.json();N(M=>M.map(I=>I._id===c?K:I)),q?._id===c&&D(K)}catch(B){console.error("Error approving task:",B),alert(B instanceof Error?B.message:"Failed to approve task")}},X=async(c,v)=>{try{const B=a(),T=await fetch(`${te}/boards/tasks/${c}/request-changes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify({comment:v})});if(!T.ok){const M=await T.json();throw new Error(M.message||"Failed to request changes")}const K=await T.json();N(M=>M.map(I=>I._id===c?K:I)),q?._id===c&&D(K)}catch(B){console.error("Error requesting changes:",B),alert(B instanceof Error?B.message:"Failed to request changes")}},J=c=>{L&&G({...L,columns:L.columns.map(v=>v.id===c?{...v,isCollapsed:!v.isCollapsed}:v)})};return z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"inline-block w-12 h-12 border-4 border-[#00ADB5] border-t-transparent rounded-full animate-spin"})}):u?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8",children:[e.jsx("p",{className:"text-red-500 font-medium",children:u}),e.jsx("button",{onClick:n,className:"px-6 py-3 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white font-bold rounded-xl hover:shadow-lg transition-all",children:"Retry"})]}):L?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-4 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg shadow-sm",title:"Kanban View",children:e.jsx(We,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>H?.("list"),className:"p-2 hover:bg-white dark:hover:bg-gray-600 rounded-lg text-gray-500 dark:text-gray-400 transition-all",title:"List View",children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>H?.("calendar"),className:"p-2 hover:bg-white dark:hover:bg-gray-600 rounded-lg text-gray-500 dark:text-gray-400 transition-all",title:"Calendar View",children:e.jsx(Ge,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>H?.("timeline"),className:"p-2 hover:bg-white dark:hover:bg-gray-600 rounded-lg text-gray-500 dark:text-gray-400 transition-all",title:"Timeline View",children:e.jsx(Ze,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:m,onChange:c=>y(c.target.value),placeholder:"Search tasks...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-600 transition-all text-sm"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:j,onChange:c=>w(c.target.value),className:"px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsxs("select",{value:r,onChange:c=>_(c.target.value),className:"px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:[e.jsx("option",{value:"all",children:"All Assignees"}),e.jsx("option",{value:"unassigned",children:"Unassigned"}),l.map((c,v)=>e.jsx("option",{value:c.userId?.toString()||"",children:c.name},c.userId?.toString()||`member-${v}`))]}),e.jsx("button",{onClick:n,className:"p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-[#00ADB5] border border-gray-300 dark:border-gray-600 transition-all",title:"Refresh",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-x-auto",children:e.jsxs("div",{className:"flex gap-4 p-4 min-h-full",children:[L.columns.sort((c,v)=>c.position-v.position).map(c=>e.jsx(As,{column:c,tasks:o[c.id]||[],labels:L.labels,currentUserId:C,isProjectOwner:F,onAddTask:v=>x({columnId:v}),onTaskClick:D,onDragStart:U,onDragEnd:W,onDragOver:v=>{$(v),i(c.id)},onDrop:O,onToggleCollapse:J,dragOverColumnId:R},c.id)),e.jsx("div",{className:"flex-shrink-0 w-72",children:e.jsxs("button",{className:"w-full h-12 flex items-center justify-center gap-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(be,{className:"w-5 h-5"}),"Add Column"]})})]})}),q&&e.jsx(Es,{task:q,labels:L.labels,columns:L.columns,members:l,currentUserId:C,currentUserName:p,isProjectOwner:F,onClose:()=>D(null),onUpdate:V,onDelete:Y,onAddComment:ue,onAddSubtask:ae,onToggleSubtask:fe,onStartTimer:se,onStopTimer:ke,onSubmitForReview:Se,onApprove:je,onRequestChanges:X}),b&&e.jsx(Ts,{columnId:b.columnId,columns:L.columns,labels:L.labels,members:l,onClose:()=>x(null),onCreate:A})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center",children:[e.jsx(We,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"No board found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create a new board to get started"})]})}const ot="http://localhost:5000/api";function Rs({projectId:t,projectTitle:k,onClose:l,onInviteSent:C}){const[p,F]=s.useState(""),[H,z]=s.useState([]),[P,L]=s.useState(null),[G,E]=s.useState(!0),[N,q]=s.useState(null),[D,b]=s.useState(""),[x,m]=s.useState(!1),[y,j]=s.useState(null),[w,r]=s.useState(null),[_,R]=s.useState(null),i=s.useRef(null),h=s.useRef(null),f=()=>localStorage.getItem("authToken");s.useEffect(()=>{const o=U=>{U.key==="Escape"&&l()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[l]);const u=s.useCallback(async(o=1,U="")=>{try{E(!0),j(null);const W=f();console.log("Fetching developers for projectId:",t);let $=`${ot}/project-invites/developers/${t}?page=${o}&limit=10`;U.trim()&&($+=`&search=${encodeURIComponent(U.trim())}`),console.log("Full URL:",$);const O=await fetch($,{headers:{Authorization:`Bearer ${W}`}});if(console.log("Fetch developers response:",O.status,O.statusText),!O.ok){const V=await O.json().catch(()=>({}));throw console.error("Fetch developers error:",V),new Error(V.error||"Failed to fetch developers")}const A=await O.json();z(A.developers||[]),L(A.pagination||null)}catch(W){console.error("Error fetching developers:",W),j("Failed to load developers")}finally{E(!1)}},[t]);s.useEffect(()=>{u(1,"")},[u]),s.useEffect(()=>{const o=setTimeout(()=>{u(1,p)},300);return()=>clearTimeout(o)},[p,u]);const S=o=>{u(o,p)},a=async()=>{if(N)try{m(!0),j(null);const o=f(),U=await fetch(`${ot}/project-invites`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({projectId:t,invitedUserId:N._id||N.id,message:D.trim()||void 0})}),W=await U.json();if(!U.ok)throw new Error(W.error||"Failed to send invite");r(`Invite sent to ${N.name}!`),R(W.invite?.inviteLink||null),C?.()}catch(o){console.error("Error sending invite:",o),j(o instanceof Error?o.message:"Failed to send invite")}finally{m(!1)}},n=()=>{_&&(navigator.clipboard.writeText(_),alert("Invite link copied to clipboard!"))},d=()=>{q(null),b(""),r(null),R(null),u(1,p)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",onClick:o=>{o.target===o.currentTarget&&l()},children:e.jsxs("div",{ref:h,className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Invite Developer"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["to ",k]})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[calc(90vh-200px)]",children:[w&&e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("p",{className:"text-green-700 dark:text-green-400 font-medium mb-2",children:["✅ ",w]}),_&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Share this link with ",N?.name,":"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:_,className:"flex-1 px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300"}),e.jsxs("button",{onClick:n,className:"flex items-center gap-1 px-3 py-2 bg-teal-500 hover:bg-teal-600 text-white rounded-lg text-sm font-medium",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Copy"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Expires in 7 days"})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 bg-teal-500 hover:bg-teal-600 text-white rounded-lg text-sm font-medium",children:"Invite Another"}),e.jsx("button",{onClick:l,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg text-sm",children:"Done"})]})]}),y&&e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400 text-sm",children:["❌ ",y]}),!w&&e.jsxs(e.Fragment,{children:[!N&&e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{ref:i,type:"text",value:p,onChange:o=>F(o.target.value),placeholder:"Search developers by name, email, or skills...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),G&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-3 border-teal-500 border-t-transparent rounded-full animate-spin"})}),!N&&!G&&H.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase font-medium",children:[P?.total||H.length," developer",(P?.total||H.length)!==1?"s":""," available"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-80 overflow-y-auto",children:H.map(o=>e.jsxs("button",{onClick:()=>q(o),className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 hover:bg-teal-50 dark:hover:bg-teal-900/30 rounded-lg transition-colors text-left group border border-transparent hover:border-teal-300 dark:hover:border-teal-700",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center text-white font-medium flex-shrink-0",children:o.avatar?e.jsx("img",{src:o.avatar,alt:o.name,className:"w-full h-full rounded-full object-cover"}):o.name?.charAt(0).toUpperCase()||e.jsx(Je,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate text-sm",children:o.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:o.email}),o.skills&&o.skills.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[o.skills.slice(0,2).map((U,W)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-[10px] rounded-full",children:U},W)),o.skills.length>2&&e.jsxs("span",{className:"text-[10px] text-gray-400",children:["+",o.skills.length-2]})]})]}),e.jsx(kt,{className:"w-4 h-4 text-gray-400 group-hover:text-teal-500 flex-shrink-0"})]},o._id||o.id))}),P&&P.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>S(P.page-1),disabled:P.page<=1,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(pt,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Page ",P.page," of ",P.totalPages]}),e.jsx("button",{onClick:()=>S(P.page+1),disabled:!P.hasMore,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Xe,{className:"w-4 h-4"})})]})]}),!G&&H.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Je,{className:"w-12 h-12 mx-auto mb-3 text-gray-300 dark:text-gray-600"}),e.jsx("p",{children:"No developers available to invite"}),e.jsx("p",{className:"text-sm mt-1",children:"All developers are already members or have pending invites"})]}),N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-teal-50 dark:bg-teal-900/30 border border-teal-200 dark:border-teal-800 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-teal-500 flex items-center justify-center text-white font-medium flex-shrink-0",children:N.avatar?e.jsx("img",{src:N.avatar,alt:N.name,className:"w-full h-full rounded-full object-cover"}):N.name?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:N.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:N.email})]}),e.jsx("button",{onClick:()=>q(null),className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Personal Message (optional)"}),e.jsx("textarea",{value:D,onChange:o=>b(o.target.value),placeholder:"Hi! I'd like to invite you to join our project...",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-teal-500 resize-none",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 text-right",children:[D.length,"/500"]})]}),e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:[e.jsx(Ae,{className:"w-4 h-4 inline mr-1"}),"A unique join link will be generated. Share it with ",N.name," to join directly."]})})]})]})]}),!w&&e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:!N||x,className:"flex items-center gap-2 px-4 py-2 bg-teal-500 hover:bg-teal-600 disabled:bg-gray-300 dark:disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-lg font-medium",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4"}),"Send Invite Link"]})})]})]})})}const Fe="http://localhost:5000/api";function Ms({projectId:t,githubRepoFullName:k}){const[l,C]=s.useState(null),[p,F]=s.useState(null),[H,z]=s.useState(!0),[P,L]=s.useState(null),[G,E]=s.useState("tasks");s.useEffect(()=>{(async()=>{try{z(!0);const m=localStorage.getItem("authToken"),y=await fetch(`${Fe}/boards/project/${t}/analytics`,{headers:{Authorization:`Bearer ${m}`}});if(!y.ok)throw new Error("Failed to fetch analytics");const j=await y.json();if(C(j),k)try{const[w,r]=k.split("/"),[_,R,i]=await Promise.all([fetch(`${Fe}/github/repos/${w}/${r}/commits?perPage=100`,{headers:{Authorization:`Bearer ${m}`}}),fetch(`${Fe}/github/repos/${w}/${r}/pulls?state=all`,{headers:{Authorization:`Bearer ${m}`}}),fetch(`${Fe}/github/repos/${w}/${r}/contributors`,{headers:{Authorization:`Bearer ${m}`}}).catch(()=>null)]);let h=[],f=[],u=[];_.ok&&(h=(await _.json()).commits||[]),R.ok&&(f=(await R.json()).pullRequests||[]),i&&i.ok&&(u=((await i.json()).contributors||[]).slice(0,5).map(d=>({login:d.login,avatarUrl:d.avatar_url||d.avatarUrl,commits:d.contributions||0,prsOpened:0,prsMerged:0})));const S={},a=new Date;for(let n=6;n>=0;n--){const d=new Date(a);d.setDate(d.getDate()-n),S[d.toISOString().split("T")[0]]=0}h.forEach(n=>{const d=new Date(n.author?.date).toISOString().split("T")[0];S[d]!==void 0&&S[d]++}),f.forEach(n=>{const d=u.find(o=>o.login===n.user?.login);d&&(d.prsOpened++,n.merged&&d.prsMerged++)}),F({totalCommits:h.length,totalPRs:f.length,openPRs:f.filter(n=>n.state==="open").length,mergedPRs:f.filter(n=>n.merged).length,contributors:u,commitActivity:Object.entries(S).map(([n,d])=>({date:n,count:d}))})}catch(w){console.error("Error fetching GitHub stats:",w)}}catch(m){console.error("Error fetching analytics:",m),L(m.message)}finally{z(!1)}})()},[t,k]);const N=x=>{const m=Math.floor(x/60),y=x%60;return m===0?`${y}m`:y===0?`${m}h`:`${m}h ${y}m`},q={low:"#10B981",medium:"#F59E0B",high:"#F97316",critical:"#EF4444"};if(H)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ne,{className:"w-6 h-6 animate-spin text-teal-500"})});if(P||!l)return e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:e.jsx("p",{className:"text-red-500",children:"Failed to load analytics"})});const D=Math.max(...Object.values(l.tasks.byColumn),1),b=p?Math.max(...p.commitActivity.map(x=>x.count),1):1;return e.jsxs("div",{className:"space-y-6 p-4",children:[p&&e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>E("tasks"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${G==="tasks"?"bg-teal-500 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:"Task Analytics"}),e.jsxs("button",{onClick:()=>E("github"),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${G==="github"?"bg-gray-900 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:[e.jsx(St,{className:"w-4 h-4"}),"GitHub Stats"]})]}),G==="github"&&p&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-800 rounded-xl",children:e.jsx(le,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Commits"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:p.totalCommits})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:e.jsx(he,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Open PRs"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p.openPRs})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-xl",children:e.jsx(Te,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Merged PRs"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:p.mergedPRs})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-teal-100 dark:bg-teal-900/30 rounded-xl",children:e.jsx(ye,{className:"w-6 h-6 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Contributors"}),e.jsx("p",{className:"text-2xl font-bold text-teal-600",children:p.contributors.length})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(rt,{className:"w-5 h-5 text-teal-500"}),"Commit Activity (Last 7 Days)"]}),e.jsx("div",{className:"flex items-end justify-between gap-2 h-32",children:p.commitActivity.map(x=>e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1",children:x.count}),e.jsx("div",{className:"w-full bg-gradient-to-t from-teal-500 to-teal-400 rounded-t transition-all duration-300",style:{height:`${x.count/b*100}%`,minHeight:x.count>0?"8px":"2px",opacity:x.count>0?1:.3}}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(x.date).toLocaleDateString("en-US",{weekday:"short"}).slice(0,2)})]},x.date))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-teal-500"}),"Top Contributors"]}),e.jsxs("div",{className:"space-y-3",children:[p.contributors.map((x,m)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-bold text-gray-400 w-6",children:m+1}),e.jsx("img",{src:x.avatarUrl,alt:x.login,className:"w-10 h-10 rounded-full"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:"font-medium text-gray-900 dark:text-white",children:["@",x.login]})}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",title:"Commits",children:[e.jsx(le,{className:"w-4 h-4"}),x.commits]}),e.jsxs("span",{className:"flex items-center gap-1",title:"PRs Opened",children:[e.jsx(he,{className:"w-4 h-4"}),x.prsOpened]}),e.jsxs("span",{className:"flex items-center gap-1 text-purple-500",title:"PRs Merged",children:[e.jsx(Te,{className:"w-4 h-4"}),x.prsMerged]})]})]},x.login)),p.contributors.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-4",children:"No contributor data available"})]})]})]}),G==="tasks"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-teal-100 dark:bg-teal-900/30 rounded-xl",children:e.jsx(He,{className:"w-6 h-6 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.tasks.total})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Completed"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[l.tasks.completed,"/",l.tasks.total]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-teal-500 rounded-full transition-all duration-500",style:{width:`${l.tasks.completionRate}%`}})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:e.jsx($e,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Completion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[l.tasks.completionRate,"%"]})]})]}),l.tasks.overdue>0&&e.jsxs("p",{className:"mt-4 text-sm text-red-500",children:["⚠️ ",l.tasks.overdue," overdue tasks"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:e.jsx(ve,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Time Spent"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:N(l.time.totalSpent)})]})]}),l.time.totalEstimated>0&&e.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["Est: ",N(l.time.totalEstimated)," (",l.time.efficiency,"% efficiency)"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-xl",children:e.jsx(ye,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Team Members"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.team.memberCount})]})]}),e.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["~",l.team.tasksPerMember," tasks per member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-teal-500"}),"Tasks by Column"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(l.tasks.byColumn).map(([x,m])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:x}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:m})]}),e.jsx("div",{className:"h-6 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-teal-500 to-indigo-500 rounded-full transition-all duration-500 flex items-center justify-end px-2",style:{width:`${m/D*100}%`},children:m>0&&e.jsx("span",{className:"text-xs text-white font-medium",children:m})})})]},x))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-teal-500"}),"Tasks by Priority"]}),e.jsx("div",{className:"flex items-center justify-center gap-4 h-48",children:Object.entries(l.tasks.byPriority).map(([x,m])=>{const y=Math.max(...Object.values(l.tasks.byPriority),1),j=m/y*100;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"relative h-36 w-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-end",children:[e.jsx("div",{className:"w-full rounded-lg transition-all duration-500",style:{backgroundColor:q[x],height:`${j}%`,minHeight:m>0?"8px":"0"}}),e.jsx("span",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-sm font-medium text-gray-900 dark:text-white",children:m})]}),e.jsx("span",{className:"text-xs capitalize text-gray-500",children:x})]},x)})})]})]}),l.sprints.total>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(rt,{className:"w-5 h-5 text-teal-500"}),"Sprint Performance"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:l.sprints.total}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Sprints"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:l.sprints.completed}),e.jsx("p",{className:"text-sm text-gray-500",children:"Completed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-teal-600",children:l.sprints.averageVelocity}),e.jsx("p",{className:"text-sm text-gray-500",children:"Avg Velocity (pts)"})]})]})]})]})]})}const dt="http://localhost:5000/api";function Fs({projectId:t,currentUserId:k,currentUserName:l,members:C=[],projectTitle:p="Project Chat"}){const[F,H]=s.useState([]),[z,P]=s.useState(""),[L,G]=s.useState(!0),[E,N]=s.useState(!1),[q,D]=s.useState(null),[b,x]=s.useState(!1),m=s.useRef(null),y=s.useRef(null),j=()=>localStorage.getItem("authToken"),w=s.useCallback(()=>{m.current?.scrollIntoView({behavior:"smooth"})},[]),r=s.useCallback(async(u=!0)=>{if(t)try{u&&(G(!0),D(null));const S=j(),a=await fetch(`${dt}/projects/${t}/messages`,{headers:{Authorization:`Bearer ${S}`,"Content-Type":"application/json"}});if(a.ok){const d=(await a.json()).messages||[];H(o=>{const U=o.filter(O=>O.id.startsWith("temp-")),W=o.filter(O=>!O.id.startsWith("temp-"));if(W.length===d.length&&W.length>0&&W[W.length-1]?.id===d[d.length-1]?.id)return o;const $=U.filter(O=>!d.some(A=>A.text===O.text&&A.senderId===O.senderId));return[...d,...$]}),u&&D(null)}else if(u){let n="Failed to fetch messages";try{n=(await a.json()).error||n}catch{}a.status===401?D("Please log in to view messages."):a.status===403?D("You do not have permission to view these messages."):D(n)}}catch(S){u&&(console.error("📨 Network error fetching messages:",S),D("Failed to connect to server"))}finally{u&&G(!1)}},[t]);s.useEffect(()=>{if(!t)return;mt(),ht(t),r(!0);const u=a=>{console.log("📨 Real-time message received:",a.id),H(n=>{if(n.some(o=>o.id===a.id))return n;const d=n.map(o=>o.id.startsWith("temp-")&&o.text===a.text&&o.senderId===a.senderId?a:o);return n.some(o=>o.id.startsWith("temp-")&&o.text===a.text&&o.senderId===a.senderId)?d:[...d,a]}),D(null)};_t(u);const S=setInterval(()=>{r(!1)},15e3);return()=>{clearInterval(S),ut(t),At(u)}},[t,r]),s.useEffect(()=>{w()},[F,w]);const _=async u=>{u?.preventDefault();const S=z.trim();if(!(!S||E))try{N(!0),D(null);const a=j(),n={id:`temp-${Date.now()}`,text:S,senderId:k,senderName:l,timestamp:new Date().toISOString()};H(o=>[...o,n]),P(""),console.log("📨 Sending message:",S);const d=await fetch(`${dt}/projects/${t}/messages`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({text:S})});if(console.log("📨 Send response status:",d.status),d.ok){const o=await d.json();console.log("📨 Message sent successfully:",o.message?.id),H(U=>U.map(W=>W.id===n.id?o.message:W)),D(null)}else{H(U=>U.filter(W=>W.id!==n.id)),P(S);let o="Failed to send message";try{o=(await d.json()).error||o}catch{}console.error("📨 Send error:",d.status,o),D(o)}}catch(a){console.error("📨 Network error sending message:",a),D("Failed to send message. Check your connection.")}finally{N(!1),y.current?.focus()}},R=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),_())},i=u=>{const S=new Date(u),a=new Date;return S.toDateString()===a.toDateString()?S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):S.toLocaleDateString([],{month:"short",day:"numeric"})+" "+S.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},h=u=>{const S=["bg-teal-500","bg-blue-500","bg-purple-500","bg-pink-500","bg-orange-500","bg-green-500"],a=u.charCodeAt(0)%S.length;return S[a]},f=u=>C.find(S=>S.userId===u||String(S.userId)===String(u));return L?e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-180px)] min-h-[500px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Loading messages..."})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-180px)] min-h-[500px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:p}),e.jsxs("p",{className:"text-sm text-gray-500",children:[C.length," members • ",F.length," messages"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(!b),className:`p-2 rounded-lg transition-colors ${b?"bg-teal-100 dark:bg-teal-900/30 text-teal-600":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500"}`,title:"Show members",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500",children:e.jsx(Gt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[q&&!L&&e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-4 py-2 rounded-lg text-sm text-center",children:[q,e.jsx("button",{onClick:()=>{D(null),r()},className:"ml-2 underline",children:"Retry"})]}),F.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Me,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:"No messages yet"}),e.jsx("p",{className:"text-gray-500",children:"Be the first to send a message to your team!"})]})}):F.map((u,S)=>{const a=u.senderId===k||String(u.senderId)===String(k),n=f(u.senderId),d=S===0||F[S-1].senderId!==u.senderId;return e.jsxs("div",{className:`flex items-end gap-2 ${a?"justify-end":"justify-start"}`,children:[!a&&d&&e.jsx("div",{className:`w-8 h-8 rounded-full ${h(u.senderId)} flex items-center justify-center text-white text-sm font-medium flex-shrink-0`,children:n?.avatar?e.jsx("img",{src:n.avatar,alt:"",className:"w-full h-full rounded-full"}):u.senderName?.charAt(0).toUpperCase()||"?"}),!a&&!d&&e.jsx("div",{className:"w-8"}),e.jsxs("div",{className:`max-w-[70%] ${a?"order-1":""}`,children:[!a&&d&&e.jsx("p",{className:"text-xs text-gray-500 mb-1 ml-1",children:u.senderName}),e.jsx("div",{className:`px-4 py-2 rounded-2xl ${a?"bg-teal-500 text-white rounded-br-md":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white rounded-bl-md"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:u.text})}),e.jsx("p",{className:`text-xs text-gray-400 mt-1 ${a?"text-right mr-1":"ml-1"}`,children:i(u.timestamp)})]})]},u.id)}),e.jsx("div",{ref:m})]}),e.jsx("form",{onSubmit:_,className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:y,type:"text",value:z,onChange:u=>P(u.target.value),onKeyPress:R,placeholder:"Type a message...",className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500",disabled:E}),e.jsx("button",{type:"submit",disabled:!z.trim()||E,className:`p-3 rounded-full transition-colors ${z.trim()&&!E?"bg-teal-500 text-white hover:bg-teal-600":"bg-gray-200 dark:bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:e.jsx(Me,{className:"w-5 h-5"})})]})})]}),b&&e.jsx("div",{className:"w-64 border-l border-gray-200 dark:border-gray-700 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Team Members"}),e.jsx("div",{className:"space-y-2",children:C.map((u,S)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${h(u.userId)} flex items-center justify-center text-white text-sm font-medium`,children:u.avatar?e.jsx("img",{src:u.avatar,alt:"",className:"w-full h-full rounded-full"}):u.name?.charAt(0).toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:[u.name,u.userId===k&&e.jsx("span",{className:"text-xs text-teal-500 ml-1",children:"(you)"})]}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:u.role})]}),e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full",title:"Online"})]},u.userId||S))})]})})]})]})}const Oe="http://localhost:5000/api";function Ls({projectId:t}){const[k,l]=s.useState([]),[C,p]=s.useState(!0),[F,H]=s.useState(!1),[z,P]=s.useState(null),[L,G]=s.useState("grid"),[E,N]=s.useState(""),[q,D]=s.useState(null),[b,x]=s.useState(!1),[m,y]=s.useState({name:"",url:"",type:"document"}),[j,w]=s.useState(null),r=()=>localStorage.getItem("authToken"),_=s.useCallback(async()=>{if(t)try{p(!0);const n=r(),d=await fetch(`${Oe}/projects/${t}/files`,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(d.ok){const o=await d.json();l(o.files||[]),P(null)}else{const o=await d.json();P(o.error||"Failed to fetch files")}}catch(n){console.error("Error fetching files:",n),P("Failed to connect to server")}finally{p(!1)}},[t]);s.useEffect(()=>{if(!t)return;mt(),ht(t),_();const n=Tt();return n&&(n.on("file-uploaded",d=>{console.log("📁 New file uploaded:",d),l(o=>o.some(U=>U.id===d.id)?o:[...o,d])}),n.on("file-deleted",d=>{console.log("🗑️ File deleted:",d.fileId),l(o=>o.filter(U=>U.id!==d.fileId))})),()=>{ut(t),n&&(n.off("file-uploaded"),n.off("file-deleted"))}},[t,_]);const R=async n=>{if(n.preventDefault(),!(!m.name||!m.url))try{H(!0);const d=r(),o=await fetch(`${Oe}/projects/${t}/files`,{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({name:m.name,url:m.url,type:m.type,size:0})});if(o.ok){const U=await o.json();l(W=>[...W,U.file]),x(!1),y({name:"",url:"",type:"document"}),P(null)}else{const U=await o.json();P(U.error||"Failed to upload file")}}catch(d){console.error("Error uploading file:",d),P("Failed to upload file")}finally{H(!1)}},i=async n=>{try{const d=r(),o=await fetch(`${Oe}/projects/${t}/files/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});if(o.ok)l(U=>U.filter(W=>W.id!==n)),w(null),D(null);else{const U=await o.json();P(U.error||"Failed to delete file")}}catch(d){console.error("Error deleting file:",d),P("Failed to delete file")}},h=(n,d="w-8 h-8")=>{const o=`${d} text-gray-500`;switch(n.toLowerCase()){case"image":case"png":case"jpg":case"jpeg":case"gif":case"svg":return e.jsx(Yt,{className:`${d} text-purple-500`});case"video":case"mp4":case"mov":case"avi":return e.jsx(Zt,{className:`${d} text-red-500`});case"audio":case"mp3":case"wav":return e.jsx(Jt,{className:`${d} text-orange-500`});case"code":case"js":case"ts":case"py":case"java":case"html":case"css":return e.jsx(Kt,{className:`${d} text-green-500`});case"archive":case"zip":case"rar":case"tar":return e.jsx(Ot,{className:`${d} text-yellow-500`});case"document":case"pdf":case"doc":case"docx":case"txt":return e.jsx(Qe,{className:`${d} text-blue-500`});default:return e.jsx(at,{className:o})}},f=n=>{if(!n||n===0)return"Unknown size";const d=["B","KB","MB","GB"];let o=n,U=0;for(;o>=1024&&U<d.length-1;)o/=1024,U++;return`${o.toFixed(1)} ${d[U]}`},u=n=>new Date(n).toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"}),S=k.filter(n=>n.name.toLowerCase().includes(E.toLowerCase())),a=[{value:"document",label:"Document"},{value:"image",label:"Image"},{value:"video",label:"Video"},{value:"audio",label:"Audio"},{value:"code",label:"Code"},{value:"archive",label:"Archive"},{value:"other",label:"Other"}];return C?e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-280px)] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Loading files..."})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-280px)] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tt,{className:"w-5 h-5 text-teal-500"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Project Files"}),e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-600 dark:text-gray-400",children:[k.length," files"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:E,onChange:n=>N(n.target.value),placeholder:"Search files...",className:"pl-9 pr-4 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 w-48"})]}),e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>G("grid"),className:`p-1.5 rounded-md transition-colors ${L==="grid"?"bg-white dark:bg-gray-700 shadow-sm":""}`,children:e.jsx(ns,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>G("list"),className:`p-1.5 rounded-md transition-colors ${L==="list"?"bg-white dark:bg-gray-700 shadow-sm":""}`,children:e.jsx(xt,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})})]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-teal-500 text-white rounded-lg hover:bg-teal-600 text-sm",children:[e.jsx(Pt,{className:"w-4 h-4"}),"Upload"]})]})]}),z&&e.jsxs("div",{className:"mx-4 mt-4 px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg text-sm",children:[z,e.jsx("button",{onClick:()=>P(null),className:"ml-2 underline",children:"Dismiss"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:S.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(tt,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:E?"No files found":"No files yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:E?"Try a different search term":"Upload files to share with your team"}),!E&&e.jsx("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600",children:"Upload First File"})]})}):L==="grid"?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:S.map(n=>e.jsxs("div",{onClick:()=>D(n),className:"group relative bg-gray-50 dark:bg-gray-800 rounded-lg p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center text-center",children:[h(n.type,"w-12 h-12"),e.jsx("p",{className:"mt-3 text-sm font-medium text-gray-900 dark:text-white truncate w-full",children:n.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:f(n.size)})]}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:d=>{d.stopPropagation(),w(n.id)},className:"p-1.5 bg-red-100 dark:bg-red-900/30 rounded-md hover:bg-red-200 dark:hover:bg-red-900/50",children:e.jsx(Ce,{className:"w-4 h-4 text-red-500"})})})]},n.id))}):e.jsx("div",{className:"space-y-2",children:S.map(n=>e.jsxs("div",{onClick:()=>D(n),className:"flex items-center gap-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[h(n.type,"w-10 h-10"),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:n.name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3"}),u(n.uploadedAt)]}),e.jsx("span",{children:f(n.size)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",onClick:d=>d.stopPropagation(),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg",children:e.jsx(Ht,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),w(n.id)},className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg",children:e.jsx(Ce,{className:"w-4 h-4 text-red-500"})})]})]},n.id))})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>x(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-full max-w-md mx-4",onClick:n=>n.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add File"}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsx("input",{type:"text",value:m.name,onChange:n=>y(d=>({...d,name:n.target.value})),placeholder:"e.g., Project Proposal.pdf",className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File URL"}),e.jsx("input",{type:"url",value:m.url,onChange:n=>y(d=>({...d,url:n.target.value})),placeholder:"https://drive.google.com/file/...",className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Link to Google Drive, Dropbox, GitHub, or any other file hosting service"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Type"}),e.jsx("select",{value:m.type,onChange:n=>y(d=>({...d,type:n.target.value})),className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:a.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:F||!m.name||!m.url,className:"px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 disabled:opacity-50 disabled:cursor-not-allowed",children:F?"Adding...":"Add File"})]})]})]})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>D(null),children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-full max-w-lg mx-4",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start gap-4",children:[h(q.type,"w-16 h-16"),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:q.name}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-gray-500",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Uploaded ",u(q.uploadedAt)]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-4 h-4"}),f(q.size)," • ",q.type]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs("a",{href:q.url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600",children:[e.jsx(Rt,{className:"w-4 h-4"}),"Open"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(q.url),alert("Link copied!")},className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Copy Link"]}),e.jsx("button",{onClick:()=>w(q.id),className:"flex items-center justify-center gap-2 px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>w(null),children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-full max-w-sm mx-4",onClick:n=>n.stopPropagation(),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ce,{className:"w-6 h-6 text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Delete File?"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>w(null),className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:()=>i(j),className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})})})]})}const Le="http://localhost:5000/api";function Bs({projectId:t,boardId:k,tasks:l,onTaskClick:C,onTaskMoveToSprint:p}){const[F,H]=s.useState([]),[z,P]=s.useState(!0),[L,G]=s.useState(null),[E,N]=s.useState(!1),[q,D]=s.useState(null);s.useEffect(()=>{(async()=>{try{P(!0);const h=localStorage.getItem("authToken"),f=await fetch(`${Le}/boards/project/${t}/sprints`,{headers:{Authorization:`Bearer ${h}`}});if(!f.ok)throw new Error("Failed to fetch sprints");const u=await f.json();H(u)}catch(h){console.error("Error fetching sprints:",h),G(h.message)}finally{P(!1)}})()},[t]);const b=s.useMemo(()=>F.find(i=>i.status==="active"),[F]),x=s.useMemo(()=>l.filter(i=>!i.sprintId),[l]),m=s.useMemo(()=>{const i={};return F.forEach(h=>{i[h._id]=l.filter(f=>f.sprintId===h._id)}),i},[F,l]),y=i=>{const h=m[i]||[],f=h.filter(a=>a.completedAt).length,u=h.reduce((a,n)=>a+(n.storyPoints||0),0),S=h.filter(a=>a.completedAt).reduce((a,n)=>a+(n.storyPoints||0),0);return{taskCount:h.length,completed:f,progress:h.length>0?Math.round(f/h.length*100):0,totalPoints:u,completedPoints:S}},j=i=>{const h=new Date(i),f=new Date,u=Math.ceil((h.getTime()-f.getTime())/(1e3*60*60*24));return Math.max(0,u)},w=async i=>{try{const h=localStorage.getItem("authToken"),f=await fetch(`${Le}/boards/project/${t}/sprints`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({...i,boardId:k})});if(!f.ok)throw new Error("Failed to create sprint");const u=await f.json();H(S=>[...S,u]),N(!1)}catch(h){console.error("Error creating sprint:",h)}},r=async i=>{try{const h=localStorage.getItem("authToken"),f=await fetch(`${Le}/boards/sprints/${i}/start`,{method:"PATCH",headers:{Authorization:`Bearer ${h}`}});if(!f.ok)throw new Error("Failed to start sprint");const u=await f.json();H(S=>S.map(a=>a._id===i?u:a))}catch(h){console.error("Error starting sprint:",h)}},_=async i=>{try{const h=localStorage.getItem("authToken"),f=await fetch(`${Le}/boards/sprints/${i}/complete`,{method:"PATCH",headers:{Authorization:`Bearer ${h}`}});if(!f.ok)throw new Error("Failed to complete sprint");const u=await f.json();H(S=>S.map(a=>a._id===i?u:a))}catch(h){console.error("Error completing sprint:",h)}},R={low:"border-l-green-500",medium:"border-l-yellow-500",high:"border-l-orange-500",critical:"border-l-red-500"};return z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ne,{className:"w-6 h-6 animate-spin text-teal-500"})}):e.jsxs("div",{className:"h-full flex gap-4 overflow-hidden",children:[e.jsxs("div",{className:"w-80 flex-shrink-0 bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-gray-500"}),"Backlog",e.jsxs("span",{className:"ml-auto text-sm font-normal text-gray-500",children:[x.length," tasks"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[x.reduce((i,h)=>i+(h.storyPoints||0),0)," points"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[x.map(i=>e.jsxs("div",{draggable:!0,onDragStart:h=>h.dataTransfer.setData("taskId",i._id),onClick:()=>C(i),className:`
                p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer
                border-l-4 ${R[i.priority]}
                hover:shadow-md transition-all
              `,children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:i.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[i.storyPoints&&e.jsxs("span",{className:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400 px-1.5 py-0.5 rounded",children:[i.storyPoints," pts"]}),i.assignees.length>0&&e.jsx("div",{className:"flex -space-x-1",children:i.assignees.slice(0,2).map(h=>e.jsx("div",{className:"w-5 h-5 rounded-full bg-teal-500 flex items-center justify-center text-white text-xs",title:h.name,children:h.name.charAt(0)},h._id))})]})]},i._id)),x.length===0&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(He,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Backlog is empty"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[b&&e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-teal-50 dark:bg-teal-900/20 border-b border-teal-200 dark:border-teal-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-teal-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:b.name}),e.jsx("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full",children:"Active"})]}),b.goal&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:b.goal})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[j(b.endDate)," days remaining"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Ends ",new Date(b.endDate).toLocaleDateString()]})]})]}),(()=>{const i=y(b._id);return e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Tasks"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[i.completed,"/",i.taskCount]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-teal-600",children:[i.progress,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Points"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[i.completedPoints,"/",i.totalPoints]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:e.jsxs("button",{onClick:()=>_(b._id),className:"w-full h-full flex items-center justify-center gap-2 text-teal-600 hover:bg-teal-50 dark:hover:bg-teal-900/30 rounded-lg",children:[e.jsx(st,{className:"w-5 h-5"}),"Complete"]})})]})})()]}),e.jsxs("div",{className:"p-4 min-h-[100px]",onDragOver:i=>i.preventDefault(),onDrop:i=>{const h=i.dataTransfer.getData("taskId");h&&p(h,b._id)},children:[e.jsx("div",{className:"grid grid-cols-2 gap-2",children:(m[b._id]||[]).map(i=>e.jsxs("div",{onClick:()=>C(i),className:`
                      p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer
                      border-l-4 ${R[i.priority]}
                      ${i.completedAt?"opacity-60":""}
                      hover:shadow-md transition-all
                    `,children:[e.jsx("p",{className:`text-sm font-medium text-gray-900 dark:text-white ${i.completedAt?"line-through":""}`,children:i.title}),e.jsx("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:i.storyPoints&&e.jsxs("span",{className:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400 px-1.5 py-0.5 rounded",children:[i.storyPoints," pts"]})})]},i._id))}),(m[b._id]||[]).length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsx("p",{children:"Drag tasks here to add to sprint"})})]})]}),F.filter(i=>i.status==="planning").map(i=>{const h=y(i._id);return e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs rounded-full",children:"Planning"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[h.taskCount," tasks • ",h.totalPoints," points"]})]}),e.jsxs("button",{onClick:()=>r(i._id),disabled:!!b,className:"flex items-center gap-1 px-3 py-1.5 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Start Sprint"]})]})}),e.jsxs("div",{className:"p-4 min-h-[80px]",onDragOver:f=>f.preventDefault(),onDrop:f=>{const u=f.dataTransfer.getData("taskId");u&&p(u,i._id)},children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(m[i._id]||[]).map(f=>e.jsxs("div",{onClick:()=>C(f),className:`
                        p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer
                        border-l-4 ${R[f.priority]}
                        hover:shadow transition-all text-sm
                      `,children:[f.title,f.storyPoints&&e.jsxs("span",{className:"ml-2 text-xs text-teal-600",children:[f.storyPoints,"pts"]})]},f._id))}),(m[i._id]||[]).length===0&&e.jsx("div",{className:"text-center text-gray-400 py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsx("p",{className:"text-sm",children:"Drag tasks from backlog"})})]})]},i._id)}),F.filter(i=>i.status==="completed").length>0&&e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(st,{className:"w-5 h-5 text-yellow-500"}),"Completed Sprints"]}),e.jsx("div",{className:"mt-3 space-y-2",children:F.filter(i=>i.status==="completed").map(i=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:i.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Velocity: ",i.velocity||0," points"]})]},i._id))})]})}),e.jsxs("button",{onClick:()=>N(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg text-gray-500 hover:border-teal-500 hover:text-teal-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Create New Sprint"]})]}),E&&e.jsx(Hs,{onClose:()=>N(!1),onCreate:w})]})}function Hs({onClose:t,onCreate:k}){const[l,C]=s.useState(""),[p,F]=s.useState(""),[H,z]=s.useState(""),[P,L]=s.useState("");s.useEffect(()=>{const E=new Date,N=new Date(E);N.setDate(N.getDate()+14),z(E.toISOString().split("T")[0]),L(N.toISOString().split("T")[0])},[]);const G=E=>{E.preventDefault(),!(!l.trim()||!H||!P)&&k({name:l.trim(),goal:p.trim()||void 0,startDate:H,endDate:P})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Create Sprint"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:G,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sprint Name *"}),e.jsx("input",{type:"text",value:l,onChange:E=>C(E.target.value),placeholder:"Sprint 1",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sprint Goal"}),e.jsx("textarea",{value:p,onChange:E=>F(E.target.value),placeholder:"What should be achieved in this sprint?",rows:2,className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:H,onChange:E=>z(E.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:P,onChange:E=>L(E.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600",children:"Create Sprint"})]})]})]})})}const pe="http://localhost:5000/api";function ir(){const{projectId:t}=Ct(),{user:k}=$t(),l=Dt(),[C,p]=s.useState("board"),[,F]=s.useState("kanban"),[H,z]=s.useState(!0),[P,L]=s.useState(null),[G,E]=s.useState(null),[N,q]=s.useState(null),[D,b]=s.useState([]),[x,m]=s.useState([]),[,y]=s.useState(null),[j,w]=s.useState(void 0),[r,_]=s.useState([]),[R,i]=s.useState(!1),[h,f]=s.useState(!1),u=()=>localStorage.getItem("authToken"),S=s.useCallback(async()=>{if(t)try{z(!0),L(null);const $=u();if(!$){L("Please log in to view this project"),l("/login");return}const O={"Content-Type":"application/json",Authorization:`Bearer ${$}`},A=await fetch(`${pe}/projects/${t}`,{headers:O});if(A.status===404){L("Project not found. It may have been deleted or the link is incorrect.");return}if(A.status===401){L("Please log in to view this project"),l("/login");return}if(A.status===403){L("You do not have permission to view this project");return}if(!A.ok){const J=await A.json().catch(()=>({}));throw new Error(J.error||"Failed to fetch project")}const V=await A.json();E(V.project);const Y=V.project.members.map(J=>({_id:J._id,userId:J.userId?._id||J.userId,name:J.name||J.userId?.name,email:J.email||J.userId?.email,role:J.role,avatar:J.avatar}));m(Y);const ue=V.project.owner?._id||V.project.owner?.id||V.project.owner,ae=V.project.createdBy?._id||V.project.createdBy?.id||V.project.createdBy,fe=V.project.userId?._id||V.project.userId?.id||V.project.userId,se=k?.id||k?._id,ke=ue&&se&&String(ue)===String(se)||ae&&se&&String(ae)===String(se)||fe&&se&&String(fe)===String(se),Se=se&&Y.some(J=>J.userId&&String(J.userId)===String(se)&&J.role==="owner"),je=!!(ke||Se);i(je),console.log("🔍 Creator Check Debug:",{rawOwner:V.project.owner,ownerId:ue,createdById:ae,userIdField:fe,currentId:se,isOwnerByField:ke,isOwnerByMemberRole:Se,members:Y,isCreator:je}),console.log("🔍 Fetching join requests, isCreator:",je);try{console.log("📋 Fetching join requests from:",`${pe}/join-requests/project/${t}`);const J=await fetch(`${pe}/join-requests/project/${t}`,{headers:O});if(console.log("📋 Join requests response status:",J.status),J.ok){const c=await J.json();console.log("📋 Join requests raw data:",c);const v=(c.requests||[]).map(T=>({id:T._id||T.id,_id:T._id,userId:T.userId?._id||T.userId,userName:T.userId?.name||T.userName,userEmail:T.userId?.email||T.userEmail,requestedAt:T.createdAt||T.requestedAt,skills:T.skills,experience:T.experience,motivation:T.motivation||T.message,message:T.message,status:T.status}));console.log("📋 Mapped requests:",v);const B=v.filter(T=>!T.status||T.status==="pending");console.log("📋 Pending requests:",B),_(B)}else console.log("❌ Join requests fetch failed:",await J.text())}catch(J){console.error("Error fetching join requests:",J)}const X=await fetch(`${pe}/boards/project/${t}`,{headers:O});if(X.ok){const J=await X.json();if(J.length>0){const c=await fetch(`${pe}/boards/${J[0]._id}`,{headers:O});if(c.ok){const v=await c.json();q(v.board||v),b(v.tasks||[])}}}try{const J=await fetch(`${pe}/github/projects/${t}/status`,{headers:O});if(J.ok){const c=await J.json();c.connected&&c.repoFullName&&w(c.repoFullName)}}catch(J){console.log("GitHub status fetch skipped:",J)}}catch($){console.error("Error fetching project data:",$),L($ instanceof Error?$.message:"Failed to load project")}finally{z(!1)}},[t,l,k?.id]);s.useEffect(()=>{if(!k){l("/login");return}S()},[k,S,l]);const a=$=>{y($)},n=async($,O)=>{try{const A=u();await fetch(`${pe}/boards/tasks/${$}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`},body:JSON.stringify({sprintId:O})}),b(V=>V.map(Y=>Y._id===$?{...Y,sprintId:O||void 0}:Y))}catch(A){console.error("Error moving task to sprint:",A)}},d=$=>{F($)},o=async $=>{try{const O=u(),A=await fetch(`${pe}/join-requests/${$}/respond`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${O}`},body:JSON.stringify({status:"approved"})});if(A.ok)_(V=>V.filter(Y=>Y.id!==$&&Y._id!==$)),S(),alert("Request approved! User has been added to the project.");else{const V=await A.json();alert(V.error||"Failed to approve request")}}catch(O){console.error("Error approving request:",O),alert("Failed to approve request")}},U=async $=>{try{const O=u(),A=await fetch(`${pe}/join-requests/${$}/respond`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${O}`},body:JSON.stringify({status:"rejected"})});if(A.ok)_(V=>V.filter(Y=>Y.id!==$&&Y._id!==$)),alert("Request rejected.");else{const V=await A.json();alert(V.error||"Failed to reject request")}}catch(O){console.error("Error rejecting request:",O),alert("Failed to reject request")}};if(H)return e.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading project..."})]})});if(P||!G)return e.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Unable to Load Project"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:P||"Project not found. It may have been deleted or the link is incorrect."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx("button",{onClick:()=>l("/dashboard/projects"),className:"px-4 py-2 bg-teal-500 hover:bg-teal-600 text-white rounded-lg transition-colors",children:"Browse Projects"}),e.jsx("button",{onClick:()=>S(),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg transition-colors",children:"Try Again"})]})]})});const W=[{id:"board",label:"Board",icon:e.jsx(We,{className:"w-4 h-4"})},{id:"sprints",label:"Sprints",icon:e.jsx(He,{className:"w-4 h-4"})},{id:"github",label:"GitHub",icon:e.jsx(ce,{className:"w-4 h-4"}),connected:!!j},{id:"members",label:"Members",icon:e.jsx(ye,{className:"w-4 h-4"}),badge:R?r.length:0},{id:"files",label:"Files",icon:e.jsx(Qe,{className:"w-4 h-4"})},{id:"chat",label:"Chat",icon:e.jsx(_e,{className:"w-4 h-4"})},{id:"activity",label:"Activity",icon:e.jsx(ct,{className:"w-4 h-4"})},{id:"analytics",label:"Analytics",icon:e.jsx(Ze,{className:"w-4 h-4"})}];return e.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950",children:[e.jsx("header",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:G.title}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[G.description?.substring(0,100),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[j&&e.jsxs("a",{href:`https://github.com/${j}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-1.5 bg-gray-900 text-white rounded-lg text-sm hover:bg-gray-800 transition-colors",title:`Connected to ${j}`,children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:j.split("/")[1]})]}),e.jsxs("div",{className:"flex -space-x-2",children:[x.slice(0,4).map(($,O)=>e.jsx("div",{className:"w-8 h-8 rounded-full bg-teal-500 flex items-center justify-center text-white text-sm font-medium border-2 border-white dark:border-gray-900",title:$.name,children:$.avatar?e.jsx("img",{src:$.avatar,alt:$.name,className:"w-full h-full rounded-full"}):$.name?.charAt(0).toUpperCase()},$.userId?.toString()||`member-${O}`)),x.length>4&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-900",children:["+",x.length-4]})]}),e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-3 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 text-sm",children:[e.jsx(ye,{className:"w-4 h-4"}),"Invite"]})]})]}),e.jsx("nav",{className:"flex gap-1 mt-4 overflow-x-auto",children:W.map($=>e.jsxs("button",{onClick:()=>p($.id),className:`
                  flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap relative
                  ${C===$.id?"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}
                `,children:[$.icon,$.label,$.badge&&$.badge>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full animate-pulse",children:$.badge}),$.connected&&e.jsx("span",{className:"ml-1 w-2 h-2 bg-green-500 rounded-full",title:"Connected"})]},$.id))})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[C==="board"&&e.jsx(Ps,{projectId:t,boardId:N?._id,members:x,currentUserId:k?.id||"",currentUserName:k?.name||k?.email?.split("@")[0]||"User",isProjectOwner:R,onViewChange:d}),C==="sprints"&&e.jsx("div",{className:"h-[calc(100vh-250px)]",children:e.jsx(Bs,{projectId:t,boardId:N?._id,tasks:D,onTaskClick:a,onTaskMoveToSprint:n})}),C==="activity"&&e.jsx("div",{className:"h-[calc(100vh-250px)]",children:e.jsx(bs,{projectId:t,includeGitHub:!!j})}),C==="analytics"&&e.jsx(Ms,{projectId:t,githubRepoFullName:j}),C==="github"&&e.jsx(Ds,{projectId:t,isOwner:R}),C==="files"&&e.jsx(Ls,{projectId:t}),C==="chat"&&e.jsx(Fs,{projectId:t,currentUserId:k?.id||"",currentUserName:k?.name||k?.email?.split("@")[0]||"User",members:x,projectTitle:G?.title||"Team Chat"}),C==="members"&&e.jsxs("div",{className:"space-y-6",children:[R&&e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Pending Join Requests",r.length>0&&e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-sm font-bold rounded-full",children:r.length})]}),r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ve,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No pending join requests"}),e.jsx("p",{className:"text-sm mt-1",children:"When someone requests to join, they'll appear here"})]}):e.jsx("div",{className:"space-y-4",children:r.map($=>e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:$.userName}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:$.userEmail}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Applied ",$.requestedAt?new Date($.requestedAt).toLocaleDateString():"recently"]}),$.message&&e.jsxs("p",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 p-2 rounded",children:['"',$.message,'"']})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>o($.id),className:"px-3 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors flex items-center gap-1",children:[e.jsx(us,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>U($.id),className:"px-3 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors flex items-center gap-1",children:[e.jsx(ys,{className:"w-4 h-4"}),"Reject"]})]})]})},$.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Team Members (",x.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:x.map(($,O)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center text-white font-medium",children:$.avatar?e.jsx("img",{src:$.avatar,alt:$.name,className:"w-full h-full rounded-full"}):$.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:$.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:$.role})]})]},$.userId?.toString()||`member-${O}`))})]})]})]}),h&&t&&e.jsx(Rs,{projectId:t,projectTitle:G?.title||"Project",onClose:()=>f(!1)})]})}export{ir as default};
