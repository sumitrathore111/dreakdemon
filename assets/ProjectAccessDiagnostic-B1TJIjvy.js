import{I as v,l as C,n as A,u as D,r as n,j as e,J as p,i as d,C as x}from"./index-Dt41-Cvb.js";import{C as b}from"./circle-alert-Dfey5_Y8.js";import{C as c}from"./circle-x-BVPMnjbr.js";function S(){const[u]=v(),a=u.get("projectId"),{user:r}=C(),{userprofile:j}=A(),l=D(),y=async(t,w)=>({hasAccess:!1,issues:["Not implemented yet"]}),f=async(t,w,I)=>{console.log("Force add member not implemented")},[s,N]=n.useState(null),[o,m]=n.useState(!1),[i,g]=n.useState(!1),h=async()=>{if(!(!a||!r)){m(!0);try{const t=await y(a,r.id);N(t),console.log("ðŸ” DIAGNOSTIC RESULTS:",t)}catch(t){console.error("Error running diagnostics:",t),alert("Failed to run diagnostics")}finally{m(!1)}}},k=async()=>{if(!(!a||!r||!s)){g(!0);try{const t=j?.name||r.email?.split("@")[0]||"User";await f(a,r.id,t),alert("âœ… Access fixed! You have been added to the project. Redirecting..."),setTimeout(()=>{l(`/dashboard/projects/workspace/${a}`)},1500)}catch(t){console.error("Error fixing access:",t),alert("Failed to fix access. Please contact project creator.")}finally{g(!1)}}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>l("/dashboard/projects"),className:"mb-4 sm:mb-6 flex items-center gap-1.5 sm:gap-2 text-sm sm:text-base text-gray-600 dark:text-gray-400 hover:text-cyan-600 dark:hover:text-cyan-400 transition",children:[e.jsx(p,{size:18,className:"sm:hidden"}),e.jsx(p,{size:20,className:"hidden sm:block"}),"Back to Projects"]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-black text-gray-900 dark:text-white mb-2",children:"Project Access Diagnostic"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"Troubleshoot and fix access issues"})]}),s?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg sm:rounded-xl p-4 sm:p-6 space-y-3 sm:space-y-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-white mb-3 sm:mb-4",children:"Diagnostic Results"}),e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[s.projectExists?e.jsx(x,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(c,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-white",children:"Project Exists"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:s.projectExists?"Project found in database":"Project not found"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[s.isCreator?e.jsx(x,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(c,{className:"w-5 h-5 sm:w-6 sm:h-6 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-white",children:"Creator Status"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:s.isCreator?"You are the project creator":"You are not the creator"}),s.projectCreatorId&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-500 mt-1 break-all",children:["Creator ID: ",s.projectCreatorId]})]})]}),e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[s.isMember?e.jsx(x,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-500 flex-shrink-0 mt-0.5"}):e.jsx(c,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm sm:text-base font-semibold text-gray-900 dark:text-white",children:"Member Status"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:s.isMember?"You are in Project_Members collection":"You are NOT in Project_Members collection"}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Total project members: ",s.totalMembers]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[s.userRequests.length>0?e.jsx(b,{className:"w-6 h-6 text-blue-500 flex-shrink-0 mt-0.5"}):e.jsx(c,{className:"w-6 h-6 text-gray-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:"Join Requests"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["You have ",s.userRequests.length," join request(s) on record"]}),s.userRequests.length>0&&e.jsx("div",{className:"space-y-2",children:s.userRequests.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded p-3 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["Request ID: ",t.id]}),e.jsx("span",{className:`px-2 py-1 rounded ${t.status==="approved"?"bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-400":t.status==="rejected"?"bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-400":"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-700 dark:text-yellow-400"}`,children:t.status})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Project ID: ",t.projectId]}),t.approvedAt&&e.jsxs("p",{className:"text-green-600 dark:text-green-400 mt-1",children:["Approved: ",new Date(t.approvedAt.seconds*1e3).toLocaleString()]})]},t.id))})]})]})]}),e.jsxs("div",{className:`rounded-xl p-6 ${s.isMember||s.isCreator?"bg-green-50 dark:bg-green-900/30 border-2 border-green-200 dark:border-green-700":"bg-red-50 dark:bg-red-900/30 border-2 border-red-200 dark:border-red-700"}`,children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:s.isMember||s.isCreator?"âœ… Access OK":"âŒ Access Issue Detected"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:s.isMember||s.isCreator?"You have proper access to this project. You can navigate to the project workspace.":s.userRequests.some(t=>t.status==="approved")?"Your request was approved, but you're not in the members list. This is a database sync issue.":"You don't have access to this project. You may need to request to join or wait for approval."}),!s.isMember&&!s.isCreator&&s.userRequests.some(t=>t.status==="approved")&&e.jsxs("button",{onClick:k,disabled:i,className:"w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold rounded-xl hover:shadow-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(d,{className:`w-5 h-5 ${i?"animate-spin":""}`}),i?"Fixing Access...":"ðŸ”§ Fix Access Issue"]}),s.isMember||s.isCreator?e.jsx("button",{onClick:()=>l(`/dashboard/projects/workspace/${a}`),className:"w-full px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold rounded-xl hover:shadow-lg transition-all",children:"Go to Project Workspace â†’"}):null]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:h,disabled:o,className:"px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all disabled:opacity-50 flex items-center gap-2 mx-auto",children:[e.jsx(d,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"Refresh Diagnostics"]})})]}):e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(b,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-yellow-500"}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-3 sm:mb-4",children:"Run Diagnostic Check"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-4 sm:mb-6 px-4",children:"Click the button below to analyze your access to this project"}),e.jsxs("button",{onClick:h,disabled:o,className:"px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold rounded-lg sm:rounded-xl hover:shadow-lg transition-all disabled:opacity-50 flex items-center gap-2 mx-auto",children:[e.jsx(d,{className:`w-4 h-4 sm:w-5 sm:h-5 ${o?"animate-spin":""}`}),o?"Running Diagnostics...":"Run Diagnostics"]})]})]}),s&&e.jsxs("div",{className:"mt-6 bg-gray-800 text-gray-100 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-3",children:"Debug Information (for developers)"}),e.jsx("pre",{className:"text-xs overflow-auto",children:JSON.stringify(s,null,2)})]})]})})}export{S as default};
