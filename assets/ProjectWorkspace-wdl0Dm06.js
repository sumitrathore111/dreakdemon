import{c as _,t as Je,i as Ve,k as $e,u as _e,r as m,j as e,C as J,v as se,w as re,x as ae,h as oe,y as ze}from"./index-CfUjm6_w.js";import{i as He,a as Ke,b as We,o as Xe,c as Ge,d as Qe,e as Ye,f as Ze,h as et,k as tt,m as st,n as rt,p as at,q as ot,r as lt}from"./socketService-BG6E60ON.js";import{S as le}from"./shield-DK4YcWNy.js";import{U as ie}from"./user-Cah6LnQC.js";import{F as V}from"./file-text-QWi7dhFJ.js";import{B as it}from"./bell-BpEMIOsU.js";import{U as de}from"./upload-BoaPSJqe.js";import{T as ne}from"./trash-2-vZcKVb3n.js";import{S as dt}from"./send-BVzDoBY-.js";import{U as nt}from"./user-minus-Nq0WrulI.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],mt=_("circle",ct);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],$=_("user-check",xt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],pt=_("user-x",gt);function Tt(){const{projectId:c}=Je(),{user:x}=Ve(),{fetchAllIdeas:ce,checkUserRole:me,getProjectMembers:z,fetchJoinRequests:H,fetchAllJoinRequestsDebug:xe,fixJoinRequestProjectId:ge,approveJoinRequest:pe,rejectJoinRequest:he,addTask:ue,fetchTasks:ye,updateTask:B,deleteTask:be,sendMessage:fe,fetchMessages:je,uploadFile:we,fetchFiles:Ne,deleteFile:ke}=$e(),T=_e(),[h,w]=m.useState("tasks"),[g,ve]=m.useState(null),[Te,K]=m.useState(!0),[N,De]=m.useState(null),[i,Ce]=m.useState(null),[k,F]=m.useState([]),[u,D]=m.useState([]),[y,f]=m.useState([]),[I,S]=m.useState({}),[W,R]=m.useState(!1),[p,v]=m.useState({title:"",description:"",priority:"medium",assignedTo:"",dueDate:""}),[U,X]=m.useState([]),[M,G]=m.useState(""),E=m.useRef(null),[P,Q]=m.useState([]);m.useEffect(()=>{if(!x||!c){T("/dashboard/projects");return}Ae()},[c,x]),m.useEffect(()=>{if(i)return He(),Ke(i),()=>{We(i)}},[i]),m.useEffect(()=>{if(!i)return;const t=a=>{console.log("ðŸ“¨ Real-time message received:",a),X(n=>n.some(o=>o.id===a.id)?n:[...n,a])},s=a=>{console.log("ðŸ“ Real-time task created:",a),f(n=>{const o={id:a.task._id||a.task.id,title:a.task.title,description:a.task.description,status:a.task.status==="open"?"todo":a.task.status==="in-progress"?"inprogress":"completed",priority:a.task.priority,assignedTo:a.task.assignedTo,createdBy:a.task.createdBy,createdAt:a.task.createdAt};return n.some(d=>d.id===o.id)?n:[...n,o]})},r=a=>{console.log("ðŸ“ Real-time task updated:",a),f(n=>n.map(o=>{if(o.id===a.taskId){const d=a.task;return{...o,title:d.title||o.title,description:d.description??o.description,status:d.status==="open"?"todo":d.status==="in-progress"?"inprogress":d.status==="closed"?"completed":o.status,priority:d.priority||o.priority,assignedTo:d.assignedTo??o.assignedTo,completedBy:d.completedBy??o.completedBy,completedByName:d.completedByName??o.completedByName,completedAt:d.completedAt??o.completedAt,pendingVerification:d.pendingVerification??o.pendingVerification,verified:d.verified??o.verified,verifiedBy:d.verifiedBy??o.verifiedBy,verifiedByName:d.verifiedByName??o.verifiedByName,verifiedAt:d.verifiedAt??o.verifiedAt,verificationFeedback:d.verificationFeedback??o.verificationFeedback}}return o}))},l=a=>{console.log("ðŸ—‘ï¸ Real-time task deleted:",a),f(n=>n.filter(o=>o.id!==a.taskId))},j=a=>{console.log("ðŸ‘¤ Real-time member joined:",a),F(n=>n.some(o=>o.userId===a.userId)?n:[...n,{id:a.userId,userId:a.userId,userName:a.userName,role:"contributor",joinedAt:new Date().toISOString()}])},b=a=>{console.log("ðŸ“‹ Real-time join request updated:",a),a.status!=="pending"&&D(n=>n.filter(o=>o.id!==a.requestId))};return Xe(t),Ge(s),Qe(r),Ye(l),Ze(j),et(b),()=>{tt(t),st(s),rt(r),at(l),ot(j),lt(b)}},[i]),m.useEffect(()=>{h==="chat"&&(i||c)&&q(),h==="files"&&(i||c)&&L()},[h,c,i]),m.useEffect(()=>{E.current&&E.current.scrollIntoView({behavior:"smooth"})},[U]);const Ae=async()=>{K(!0);try{const t=await ce(),s=t.find(d=>d.id===c);if(console.log("ðŸ” All ideas:",t),console.log("ðŸ” Found project data:",s),!s){alert("Project not found"),T("/dashboard/projects");return}if(s.status!=="approved"){alert("This project is not approved yet"),T("/dashboard/projects");return}De(s);const r=s.projectId?._id||s.projectId||c;Ce(r),console.log("ðŸ“‹ Idea ID:",c),console.log("ðŸ“‹ projectData.projectId:",s.projectId),console.log("ðŸ“‹ Actual Project ID to use:",r);const l=await me(r);if(console.log("ðŸ‘¤ User role:",l),!l){console.log("âŒ NO ACCESS - Redirecting to diagnostics page"),T(`/dashboard/projects/access-diagnostic?projectId=${c}`);return}ve(l),console.log("ðŸ” Loading members for realProjectId:",r);const j=await z(r);console.log("ðŸ” LOADED MEMBERS FROM BACKEND:",j);const b=String(s.userId);console.log("ðŸ” Creator userId:",b);const a=new Set;a.add(b);const n=j.filter(d=>{const C=String(d.userId);return console.log("ðŸ” Checking member:",C,"vs creator:",b,"equal:",C===b),a.has(C)?!1:(a.add(C),!0)});console.log("ðŸ” Non-creator members:",n);const o=[{id:"creator",userId:b,userName:s.userName,role:"creator",joinedAt:s.submittedAt},...n];if(console.log("ðŸ‘¥ ALL MEMBERS (including creator):",o),F(o),l==="creator"){console.log("ðŸ“‹ Loading join requests for project:",r),console.log("ðŸ“‹ Current user ID:",x.id),console.log("ðŸ“‹ Project creator ID:",s.userId);const d=await H(r);if(console.log("ðŸ“‹ Fetched join requests:",d),D(d),d.length===0){const te=(await xe()).filter(A=>A.status==="pending"&&A.creatorId===x.id&&A.projectId!==r);if(te.length>0&&r){for(const Oe of te)await ge(Oe.id,r);const A=await H(r);D(A)}}}Y(r),q(),L()}catch(t){console.error("Error loading project:",t),alert("Failed to load project"),T("/dashboard/projects")}finally{K(!1)}},Y=async t=>{try{const r=await ye(t||i||c);f(r.filter(l=>!l.deleted))}catch(s){console.error("Error loading tasks:",s)}},q=async()=>{try{const s=await je(i||c);X(s)}catch(t){console.error("Error loading messages:",t)}},L=async()=>{try{const s=await Ne(i||c);Q(s)}catch(t){console.error("Error loading files:",t)}},Be=async(t,s,r)=>{try{const l=i||c;await pe(t,l,s,r),D(u.filter(o=>o.id!==t));const j=await z(l),b=String(N.userId),a=j.filter(o=>String(o.userId)!==b),n=[{id:"creator",userId:b,userName:N.userName,role:"creator",joinedAt:N.submittedAt},...a];F(n),alert(`${r} has been added to the project!`)}catch(l){console.error("Error approving request:",l),alert("Failed to approve request")}},Fe=t=>{if(!t)return"Unassigned";const s=k.find(l=>l.userName===t);return s?s.userName:k.find(l=>l.userId===t)?.userName||t},Ie=t=>{if(!t||!x)return!1;const s=x.name||x.email?.split("@")[0]||"";return t===x.name||t===x.email?.split("@")[0]||t.toLowerCase()===s.toLowerCase()},Se=async t=>{try{await he(t),D(u.filter(s=>s.id!==t)),alert("Join request rejected")}catch(s){console.error("Error rejecting request:",s),alert("Failed to reject request")}},Re=async()=>{if(g!=="creator"){alert("Only the project creator can add tasks");return}if(!p.title.trim()){alert("Please enter a task title");return}if(!i){console.error("âŒ actualProjectId is not set. Project data:",N),alert("Project not properly loaded. Please refresh the page.");return}console.log("ðŸ“ Creating task with actualProjectId:",i),console.log("ðŸ“ User role:",g);try{await ue(i,{title:p.title,description:p.description,status:"todo",priority:p.priority,assignedTo:p.assignedTo,dueDate:p.dueDate}),await Y(),v({title:"",description:"",priority:"medium",assignedTo:"",dueDate:""}),R(!1)}catch(t){console.error("Error adding task:",t),alert(`Failed to add task: ${t?.message||"Unknown error"}`)}},O=async(t,s)=>{try{await B(i||c,t,{status:s}),f(y.map(r=>r.id===t?{...r,status:s}:r))}catch(r){console.error("Error updating task:",r),alert("Failed to update task")}},Ue=async t=>{if(g!=="creator"){alert("Only the project creator can delete tasks");return}try{await be(i||c,t),f(y.filter(s=>s.id!==t))}catch(s){console.error("Error deleting task:",s),alert("Failed to delete task")}},Me=async t=>{if(x)try{const s=x.name||x.email?.split("@")[0]||"User";await B(i||c,t,{completedBy:x.id,completedByName:s,completedAt:new Date().toISOString(),pendingVerification:!0}),f(y.map(r=>r.id===t?{...r,completedBy:x.id,completedByName:s,completedAt:new Date().toISOString(),pendingVerification:!0}:r))}catch(s){console.error("Error marking task completed:",s),alert("Failed to mark task completed")}},Ee=async t=>{if(g!=="creator"){alert("Only the project creator can verify completed tasks");return}try{const s=I[t]||"",r=x?.name||x?.email?.split("@")[0]||"Creator";await B(i||c,t,{verified:!0,verifiedBy:x?.id,verifiedByName:r,verifiedAt:new Date().toISOString(),verificationFeedback:s,pendingVerification:!1,status:"completed"}),f(y.map(l=>l.id===t?{...l,verified:!0,verifiedBy:x?.id||null,verifiedByName:r,verificationFeedback:s,pendingVerification:!1,status:"completed"}:l)),S(l=>({...l,[t]:""}))}catch(s){console.error("Error approving verification:",s),alert("Failed to approve verification")}},Pe=async t=>{if(g!=="creator"){alert("Only the project creator can reject verification");return}try{const s=I[t]||"";await B(i||c,t,{verified:!1,verificationFeedback:s,pendingVerification:!1,status:"inprogress",completedBy:null,completedAt:null,completedByName:null}),f(y.map(r=>r.id===t?{...r,verified:!1,verificationFeedback:s,pendingVerification:!1,status:"inprogress",completedBy:null,completedAt:void 0,completedByName:null}:r)),S(r=>({...r,[t]:""}))}catch(s){console.error("Error rejecting verification:",s),alert("Failed to reject verification")}},Z=async()=>{if(M.trim())try{await fe(i||c,{text:M}),await q(),G("")}catch(t){console.error("Error sending message:",t),alert("Failed to send message")}},qe=t=>{switch(t){case"completed":return e.jsx(J,{className:"w-5 h-5 text-green-500"});case"inprogress":return e.jsx(oe,{className:"w-5 h-5 text-yellow-500"});default:return e.jsx(mt,{className:"w-5 h-5 text-gray-400"})}},Le=t=>{switch(t){case"high":return"bg-red-100 text-red-700";case"medium":return"bg-yellow-100 text-yellow-700";default:return"bg-green-100 text-green-700"}},ee=()=>{if(y.length===0)return 0;const t=y.filter(s=>s.status==="completed").length;return Math.round(t/y.length*100)};return Te?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block w-16 h-16 border-4 border-[#00ADB5] border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400 font-semibold",children:"Loading project..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-start justify-between gap-3 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 w-full lg:w-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3 mb-2",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-black text-gray-900 dark:text-white",children:N?.title}),e.jsx("span",{className:`px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-[10px] sm:text-xs font-bold whitespace-nowrap ${g==="creator"?"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400":"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400"}`,children:g==="creator"?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 inline mr-1"}),"CREATOR"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3 inline mr-1"}),"CONTRIBUTOR"]})})]}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-3 sm:mb-4",children:N?.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-6 text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx(ie,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsxs("span",{children:[k.length," members"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[e.jsx(V,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsxs("span",{children:[y.length," tasks"]})]})]})]}),e.jsxs("div",{className:"text-left sm:text-right w-full sm:w-auto",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1 sm:mb-2",children:"Progress"}),e.jsxs("div",{className:"text-2xl sm:text-3xl font-black text-[#00ADB5]",children:[ee(),"%"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 sm:h-3",children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${ee()}%`,backgroundColor:"#00ADB5"}})})]}),g==="creator"&&u.length>0&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-lg sm:rounded-xl p-3 sm:p-4 mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[e.jsx(it,{className:"w-5 h-5 sm:w-6 sm:h-6 text-yellow-600 dark:text-yellow-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-sm sm:text-base font-bold text-yellow-900 dark:text-yellow-200",children:[u.length," Pending Join Request",u.length>1?"s":""]}),e.jsx("p",{className:"text-xs sm:text-sm text-yellow-700 dark:text-yellow-300",children:"Review requests in the Members tab"})]}),e.jsx("button",{onClick:()=>w("members"),className:"w-full sm:w-auto px-3 sm:px-4 py-1.5 sm:py-2 text-sm sm:text-base bg-yellow-600 text-white font-semibold rounded-lg hover:bg-yellow-700 transition-colors",children:"Review"})]})}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 bg-white dark:bg-gray-800 rounded-lg sm:rounded-xl p-1.5 sm:p-2 shadow-lg mb-4 sm:mb-6 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>w("tasks"),className:`flex-1 min-w-[80px] py-2 sm:py-3 px-2 sm:px-4 rounded-lg text-xs sm:text-sm font-semibold transition-all whitespace-nowrap ${h==="tasks"?"bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(J,{className:"w-4 h-4 sm:w-5 sm:h-5 inline mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Tasks"}),e.jsx("span",{className:"sm:hidden",children:"Tasks"})]}),e.jsxs("button",{onClick:()=>w("chat"),className:`flex-1 min-w-[80px] py-2 sm:py-3 px-2 sm:px-4 rounded-lg text-xs sm:text-sm font-semibold transition-all whitespace-nowrap ${h==="chat"?"bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(se,{className:"w-4 h-4 sm:w-5 sm:h-5 inline mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Chat"}),e.jsx("span",{className:"sm:hidden",children:"Chat"})]}),e.jsxs("button",{onClick:()=>w("files"),className:`flex-1 min-w-[80px] py-2 sm:py-3 px-2 sm:px-4 rounded-lg text-xs sm:text-sm font-semibold transition-all whitespace-nowrap ${h==="files"?"bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(de,{className:"w-4 h-4 sm:w-5 sm:h-5 inline mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Files"}),e.jsx("span",{className:"sm:hidden",children:"Files"})]}),e.jsxs("button",{onClick:()=>w("members"),className:`flex-1 min-w-[100px] py-2 sm:py-3 px-2 sm:px-4 rounded-lg text-xs sm:text-sm font-semibold transition-all whitespace-nowrap ${h==="members"?"bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(re,{className:"w-4 h-4 sm:w-5 sm:h-5 inline mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Members"}),e.jsx("span",{className:"sm:hidden",children:"Team"}),u.length>0&&e.jsx("span",{className:"ml-1 sm:ml-2 px-1.5 sm:px-2 py-0.5 sm:py-1 bg-white text-[#00ADB5] rounded-full text-[10px] sm:text-xs font-bold",children:u.length})]}),e.jsxs("button",{onClick:()=>w("activity"),className:`flex-1 min-w-[90px] py-2 sm:py-3 px-2 sm:px-4 rounded-lg text-xs sm:text-sm font-semibold transition-all whitespace-nowrap ${h==="activity"?"bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.jsx(ae,{className:"w-4 h-4 sm:w-5 sm:h-5 inline mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Activity"}),e.jsx("span",{className:"sm:hidden",children:"Log"})]})]}),h==="tasks"&&e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0 mb-3 sm:mb-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-gray-900 dark:text-white",children:"Tasks"}),g==="creator"?e.jsx("button",{onClick:()=>R(!W),className:"w-full sm:w-auto px-3 sm:px-4 py-1.5 sm:py-2 text-sm sm:text-base bg-[#00ADB5] text-white font-semibold rounded-lg hover:bg-cyan-600 transition-colors",children:"+ Add Task"}):e.jsx("button",{disabled:!0,title:"Only the project creator can add tasks",className:"w-full sm:w-auto px-3 sm:px-4 py-1.5 sm:py-2 text-sm sm:text-base bg-gray-200 text-gray-500 font-semibold rounded-lg cursor-not-allowed",children:"+ Add Task"})]}),W&&g==="creator"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-3 sm:p-4 md:p-6 mb-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4 text-gray-900 dark:text-white",children:"New Task"}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Task title",value:p.title,onChange:t=>v({...p,title:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-[#00ADB5] focus:outline-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white"}),e.jsx("textarea",{placeholder:"Task description",value:p.description,onChange:t=>v({...p,description:t.target.value}),className:"w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-[#00ADB5] focus:outline-none resize-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white",rows:3}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("select",{value:p.priority,onChange:t=>v({...p,priority:t.target.value}),className:"px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-[#00ADB5] focus:outline-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"low",children:"Low Priority"}),e.jsx("option",{value:"medium",children:"Medium Priority"}),e.jsx("option",{value:"high",children:"High Priority"})]}),e.jsxs("select",{value:p.assignedTo,onChange:t=>v({...p,assignedTo:t.target.value}),className:"px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-[#00ADB5] focus:outline-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white",disabled:g!=="creator",children:[e.jsx("option",{value:"",children:"Assign to..."}),k.map(t=>e.jsx("option",{value:t.userName,children:t.userName},t.id))]}),e.jsx("input",{type:"date",value:p.dueDate,onChange:t=>v({...p,dueDate:t.target.value}),className:"px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-[#00ADB5] focus:outline-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:Re,className:"flex-1 px-4 py-2 sm:py-3 text-sm sm:text-base bg-[#00ADB5] text-white font-semibold rounded-xl hover:bg-cyan-600 transition-colors",children:"Create Task"}),e.jsx("button",{onClick:()=>R(!1),className:"px-4 py-2 sm:py-3 text-sm sm:text-base bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-semibold rounded-xl hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]}),y.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 sm:p-12 text-center",children:[e.jsx(J,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white mb-2",children:"No tasks yet"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-400",children:"Create your first task to get started"})]}):e.jsx("div",{className:"space-y-3",children:y.map(t=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-3 sm:p-4 md:p-6",children:e.jsxs("div",{className:"flex items-start gap-3 sm:gap-4",children:[e.jsx("button",{onClick:()=>{t.status==="completed"?O(t.id,"todo"):t.status==="todo"?O(t.id,"inprogress"):O(t.id,"completed")},className:"mt-1 flex-shrink-0",children:qe(t.status)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-white break-words",children:t.title}),t.description&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:`px-2 sm:px-3 py-1 rounded-full text-[10px] sm:text-xs font-bold ${Le(t.priority)}`,children:t.priority.toUpperCase()}),g==="creator"&&e.jsx("button",{onClick:()=>Ue(t.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:e.jsx(ne,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:[t.assignedTo&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"truncate",children:Fe(t.assignedTo)})]}),t.dueDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:new Date(t.dueDate).toLocaleDateString()}),e.jsx("span",{className:"sm:hidden",children:new Date(t.dueDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]})]}),e.jsxs("div",{className:"mt-3",children:[t.pendingVerification&&g==="creator"&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-lg p-2 sm:p-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-yellow-800 dark:text-yellow-300 font-semibold",children:"Completion pending verification"}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:["Marked completed by: ",t.completedByName||"Member"]}),e.jsx("textarea",{placeholder:"Add verification feedback (optional)",value:I[t.id]||"",onChange:s=>S(r=>({...r,[t.id]:s.target.value})),className:"w-full mt-2 p-2 text-sm border dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>Ee(t.id),className:"flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm bg-green-500 text-white rounded-lg",children:"Approve"}),e.jsx("button",{onClick:()=>Pe(t.id),className:"flex-1 sm:flex-none px-3 py-1.5 sm:py-2 text-xs sm:text-sm bg-red-500 text-white rounded-lg",children:"Reject"})]})]}),!t.pendingVerification&&!t.verified&&t.assignedTo&&Ie(t.assignedTo)&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>Me(t.id),className:"w-full sm:w-auto px-3 py-2 text-xs sm:text-sm bg-[#00ADB5] text-white rounded-lg",children:"Mark Completed"})}),t.verified&&e.jsxs("div",{className:"mt-2 bg-green-50 dark:bg-green-900/30 border-l-4 border-green-400 p-2 rounded",children:[e.jsx("p",{className:"text-xs sm:text-sm text-green-800 dark:text-green-300 font-semibold",children:"âœ“ Verified completed"}),t.completedByName&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:["Completed by: ",t.completedByName]}),t.verifiedByName&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:["Reviewed by: ",t.verifiedByName]}),t.verificationFeedback&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-600 dark:text-gray-400",children:["Feedback: ",t.verificationFeedback]})]})]})]})]})},t.id))})]}),h==="chat"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-3 sm:p-4 md:p-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-gray-900 dark:text-white mb-3 sm:mb-4",children:"Team Chat"}),e.jsx("div",{className:"h-64 sm:h-80 md:h-96 overflow-y-auto mb-3 sm:mb-4 p-3 sm:p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:U.length===0?e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-8 sm:py-12",children:[e.jsx(se,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-sm sm:text-base",children:"No messages yet. Start the conversation!"})]}):e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[U.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-2 sm:p-3 shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-semibold text-xs sm:text-sm text-gray-900 dark:text-white truncate",children:t.senderName||t.userName}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 flex-shrink-0 ml-2",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-700 dark:text-gray-300 break-words",children:t.text||t.message})]},t.id)),e.jsx("div",{ref:E})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:M,onChange:t=>G(t.target.value),onKeyPress:t=>t.key==="Enter"&&Z(),placeholder:"Type your message...",className:"flex-1 px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-[#00ADB5] focus:outline-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white"}),e.jsx("button",{onClick:Z,className:"px-3 sm:px-6 py-2 sm:py-3 bg-[#00ADB5] text-white font-semibold rounded-xl hover:bg-cyan-600 transition-colors flex-shrink-0",children:e.jsx(dt,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),h==="files"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-3 sm:p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-3 sm:mb-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-black text-gray-900 dark:text-white",children:"Project Files"}),e.jsxs("label",{className:"w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base bg-[#00ADB5] text-white font-semibold rounded-xl hover:bg-cyan-600 transition-colors cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Upload File",e.jsx("input",{type:"file",className:"hidden",onChange:async t=>{const s=t.target.files?.[0];if(s){const r={name:s.name,size:s.size,url:"#"};try{await we(i||c,r),await L(),alert("File metadata saved! (Note: Actual file upload requires Firebase Storage setup)")}catch(l){console.error("Error uploading file:",l),alert("Failed to upload file")}}}})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:P.length===0?e.jsxs("div",{className:"col-span-2 text-center py-8 sm:py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(V,{className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto mb-2 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-sm sm:text-base",children:"No files uploaded yet"})]}):P.map(t=>e.jsx("div",{className:"border-2 border-gray-200 dark:border-gray-700 rounded-xl p-3 sm:p-4 hover:border-[#00ADB5] transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-500 dark:text-gray-400 flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-gray-900 dark:text-white truncate",children:t.fileName})]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 mb-1 truncate",children:["Uploaded by ",t.uploaderName]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-400",children:[new Date(t.uploadedAt).toLocaleDateString("en-US",{month:"short",day:"numeric"})," â€¢ ",(t.fileSize/1024).toFixed(2)," KB"]})]}),g==="creator"&&e.jsx("button",{onClick:async()=>{try{await ke(i||c,t.id),Q(P.filter(r=>r.id!==t.id))}catch(s){console.error("Error deleting file:",s),alert("Failed to delete file")}},className:"text-red-500 hover:text-red-700 transition-colors",children:e.jsx(ne,{className:"w-4 h-4"})})]})},t.id))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4 text-center",children:"Note: Full file upload/download requires Firebase Storage setup. Currently storing metadata only."})]}),h==="members"&&e.jsxs("div",{className:"space-y-6",children:[g==="creator"&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-black text-gray-900 dark:text-white mb-4",children:["Pending Join Requests ",u.length>0&&`(${u.length})`]}),u.length===0?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-xl p-8 text-center",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-3 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 font-semibold",children:"No Pending Requests"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-2",children:"When someone requests to join your project, they will appear here"})]}):e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white text-lg",children:t.userName}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.userEmail}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Applied ",new Date(t.requestedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>Be(t.id,t.userId,t.userName),className:"px-4 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>Se(t.id),className:"px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4"}),"Reject"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1",children:"Skills"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:t.skills||"Not provided"})]}),t.experience&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1",children:"Experience"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:t.experience})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1",children:"Why they want to join"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:t.motivation||"Not provided"})]}),t.availability&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mb-1",children:"Availability"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:t.availability})]})]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 dark:text-white mb-4",children:"Team Members"}),e.jsx("div",{className:"space-y-3",children:k.map(t=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[#00ADB5] to-cyan-600 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:(t.userName?.charAt(0)||"").toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white",children:t.userName}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Joined ",new Date(t.joinedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${t.role==="creator"?"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-400":"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-400"}`,children:t.role==="creator"?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-3 h-3 inline mr-1"}),"CREATOR"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-3 h-3 inline mr-1"}),"CONTRIBUTOR"]})}),g==="creator"&&t.role!=="creator"&&e.jsx("button",{onClick:async()=>{if(window.confirm(`Remove ${t.userName} from the project?`))try{i&&(await ze(i,t.userId),F(k.filter(s=>s.userId!==t.userId)))}catch(s){alert(s?.message||"Failed to remove member")}},title:"Remove member",className:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors",children:e.jsx(nt,{className:"w-4 h-4"})})]})]})},t.id))})]})]}),h==="activity"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-12 text-center",children:[e.jsx(ae,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Activity Timeline"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Track all project activities"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-4",children:"Coming soon..."})]})]})})}export{Tt as default};
