import{g as Q,r as s,j as e,i as ue,Z as Ne,t as He,v as ke,E as Ce,w as mt,X as he,x as se,h as Ue,F as ht,S as ut,y as et,k as $e,C as Je,U as fe,z as Ae,D as We,T as Ye,H as yt,l as pt,u as bt}from"./index-Dt41-Cvb.js";import{C as ye}from"./clock-B_hAvV_z.js";import{F as Ge}from"./file-text-ytjj80rj.js";import{P as Oe}from"./play-vOgjdOYA.js";import{P as de}from"./plus-BifSPq8V.js";import{G as pe}from"./git-branch-Ce-4nEIv.js";import{T as be}from"./trash-2-CLOvfNSR.js";import{C as tt}from"./chevron-left-CkVRdP0N.js";import{C as Ie}from"./chevron-right-BfOnsba4.js";import{C as ce}from"./circle-alert-Dfey5_Y8.js";import{L as oe,U as ft}from"./upload-C6Fc2kqw.js";import{T as st,a as _e,L as rt}from"./tag-DRk1p_ua.js";import{G as me}from"./github-CAYc2bPS.js";import{C as Te}from"./chevron-down-C3ctp4yY.js";import{i as at,a as nt,o as jt,b as lt,c as wt,g as Nt}from"./socketService-Bb3-UrQE.js";import{U as it}from"./user-D0ROrVKK.js";import{S as Ee}from"./send-lBCyvB2O.js";import{C as vt}from"./circle-x-BVPMnjbr.js";import{T as kt}from"./trending-up-BzpWWDL-.js";import{E as Ct}from"./eye-D7heJZaR.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]],Ve=Q("chart-no-axes-column",St);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Le=Q("chevron-up",$t);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Se=Q("circle-check",Dt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],At=Q("download",Tt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Et=Q("ellipsis-vertical",_t);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Mt=Q("ellipsis",Pt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01",key:"gkbcor"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}]],Rt=Q("file-archive",Ft);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]],Bt=Q("file-audio",Lt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}]],qt=Q("file-code",Ht);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Ut=Q("file-image",zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]],Ot=Q("file-play",Gt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Ke=Q("file",It);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]],Pe=Q("git-commit-horizontal",Vt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]],ot=Q("git-merge",Jt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["line",{x1:"6",x2:"6",y1:"9",y2:"21",key:"rroup"}]],ve=Q("git-pull-request",Wt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Kt=Q("grid-3x3",Yt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["path",{d:"M5 3v14",key:"9nsxs2"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"M19 3v18",key:"1sk56x"}]],qe=Q("kanban",Qt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Xt=Q("lock",Zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],ze=Q("paperclip",es);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],ss=Q("pause",ts);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Me=Q("settings",rs);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],dt=Q("unlink",as);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ls=Q("user-check",ns);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],os=Q("user-x",is),ds="http://localhost:5000/api";function cs({projectId:t,limit:d=50}){const[c,w]=s.useState([]),[j,F]=s.useState(!0),[P,L]=s.useState(null),T={task_created:e.jsx(de,{className:"w-4 h-4"}),task_updated:e.jsx(Me,{className:"w-4 h-4"}),task_completed:e.jsx(Se,{className:"w-4 h-4"}),task_deleted:e.jsx(be,{className:"w-4 h-4"}),task_moved:e.jsx(pe,{className:"w-4 h-4"}),task_commented:e.jsx(ke,{className:"w-4 h-4"}),board_created:e.jsx(de,{className:"w-4 h-4"}),sprint_started:e.jsx(Oe,{className:"w-4 h-4"}),sprint_completed:e.jsx(Se,{className:"w-4 h-4"}),member_joined:e.jsx(He,{className:"w-4 h-4"}),file_uploaded:e.jsx(Ge,{className:"w-4 h-4"}),time_logged:e.jsx(ye,{className:"w-4 h-4"}),default:e.jsx(Ne,{className:"w-4 h-4"})},_={task_created:"bg-green-500",task_updated:"bg-blue-500",task_completed:"bg-teal-500",task_deleted:"bg-red-500",task_moved:"bg-yellow-500",task_commented:"bg-indigo-500",board_created:"bg-green-500",sprint_started:"bg-teal-500",sprint_completed:"bg-teal-500",member_joined:"bg-cyan-500",file_uploaded:"bg-orange-500",time_logged:"bg-pink-500",default:"bg-gray-500"};s.useEffect(()=>{(async()=>{try{F(!0);const i=localStorage.getItem("authToken"),a=await fetch(`${ds}/boards/project/${t}/activity?limit=${d}`,{headers:{Authorization:`Bearer ${i}`}});if(!a.ok)throw new Error("Failed to fetch activities");const o=await a.json();w(o)}catch(i){console.error("Error fetching activities:",i),L(i.message)}finally{F(!1)}})()},[t,d]);const A=s.useMemo(()=>{const b={};return c.forEach(i=>{const a=new Date(i.createdAt),o=new Date,v=new Date(o);v.setDate(v.getDate()-1);let f;a.toDateString()===o.toDateString()?f="Today":a.toDateString()===v.toDateString()?f="Yesterday":f=a.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),b[f]||(b[f]=[]),b[f].push(i)}),b},[c]),y=b=>new Date(b).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-6 h-6 animate-spin text-teal-500"})}):P?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx("p",{className:"text-red-500 mb-2",children:"Failed to load activities"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-teal-500 text-white rounded-lg",children:"Retry"})]}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(Ne,{className:"w-12 h-12 mb-4 text-gray-300"}),e.jsx("p",{children:"No activities yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Activities will appear here when team members start working"})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm p-4 h-full overflow-y-auto",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-teal-500"}),"Activity Feed"]}),e.jsx("div",{className:"space-y-6",children:Object.entries(A).map(([b,i])=>e.jsxs("div",{children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-900 py-2 mb-3 z-10",children:e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:b})}),e.jsxs("div",{className:"space-y-4 relative",children:[e.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700"}),i.map(a=>{const o=T[a.type]||T.default,v=_[a.type]||_.default;return e.jsxs("div",{className:"flex gap-4 relative",children:[e.jsx("div",{className:`relative z-10 w-8 h-8 rounded-full ${v} flex items-center justify-center text-white flex-shrink-0`,children:o}),e.jsx("div",{className:"flex-1 min-w-0 bg-gray-50 dark:bg-gray-800 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-900 dark:text-white",children:[e.jsx("span",{className:"font-medium",children:a.userName})," ",e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:a.title})]}),a.metadata&&Object.keys(a.metadata).length>0&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[a.metadata.taskTitle&&e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded",children:a.metadata.taskTitle}),a.metadata.columnFrom&&a.metadata.columnTo&&e.jsxs("span",{children:[" → ",a.metadata.columnFrom," to ",a.metadata.columnTo]}),a.metadata.velocity!==void 0&&e.jsxs("span",{children:[" • Velocity: ",a.metadata.velocity," points"]})]})]}),e.jsx("span",{className:"text-xs text-gray-400 flex-shrink-0",children:y(a.createdAt)})]})})]},a._id)})]})]},b))})]})}function xs({tasks:t,onTaskClick:d,onAddTask:c}){const[w,j]=s.useState(new Date),[F,P]=s.useState("month"),L=s.useMemo(()=>{const a=w.getFullYear(),o=w.getMonth(),v=new Date(a,o,1),f=new Date(a,o+1,0),N=v.getDay(),B=f.getDate(),M=new Date;M.setHours(0,0,0,0);const H=[],J=new Date(a,o,0).getDate();for(let m=N-1;m>=0;m--){const k=new Date(a,o-1,J-m);H.push({date:k,isCurrentMonth:!1,isToday:k.getTime()===M.getTime(),tasks:T(k)})}for(let m=1;m<=B;m++){const k=new Date(a,o,m);H.push({date:k,isCurrentMonth:!0,isToday:k.getTime()===M.getTime(),tasks:T(k)})}const x=42-H.length;for(let m=1;m<=x;m++){const k=new Date(a,o+1,m);H.push({date:k,isCurrentMonth:!1,isToday:k.getTime()===M.getTime(),tasks:T(k)})}return H},[w,t]);function T(a){return t.filter(o=>{if(!o.dueDate)return!1;const v=new Date(o.dueDate);return v.getFullYear()===a.getFullYear()&&v.getMonth()===a.getMonth()&&v.getDate()===a.getDate()})}const _=()=>{j(new Date(w.getFullYear(),w.getMonth()-1,1))},A=()=>{j(new Date(w.getFullYear(),w.getMonth()+1,1))},y=()=>{j(new Date)},b={low:"bg-green-500",medium:"bg-yellow-500",high:"bg-orange-500",critical:"bg-red-500"},i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:w.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:_,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(tt,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:y,className:"px-3 py-1 text-sm text-teal-600 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-lg",children:"Today"}),e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(Ie,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>P("month"),className:`px-3 py-1.5 text-sm rounded-lg ${F==="month"?"bg-teal-100 dark:bg-teal-900/30 text-teal-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:"Month"}),e.jsx("button",{onClick:()=>P("week"),className:`px-3 py-1.5 text-sm rounded-lg ${F==="week"?"bg-teal-100 dark:bg-teal-900/30 text-teal-600":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}`,children:"Week"})]})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700",children:i.map(a=>e.jsx("div",{className:"py-3 text-center text-sm font-medium text-gray-500 dark:text-gray-400",children:a},a))}),e.jsx("div",{className:"flex-1 grid grid-cols-7 auto-rows-fr",children:L.map((a,o)=>e.jsxs("div",{className:`
              min-h-[100px] p-1 border-b border-r border-gray-100 dark:border-gray-800
              ${a.isCurrentMonth?"":"bg-gray-50 dark:bg-gray-900/50"}
              ${a.isToday?"bg-teal-50 dark:bg-teal-900/10":""}
              group hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors
            `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`
                  w-7 h-7 flex items-center justify-center text-sm rounded-full
                  ${a.isToday?"bg-teal-500 text-white":a.isCurrentMonth?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}
                `,children:a.date.getDate()}),c&&e.jsx("button",{onClick:()=>c(a.date),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-opacity",children:e.jsx(de,{className:"w-4 h-4 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-1 overflow-y-auto max-h-[80px]",children:[a.tasks.slice(0,3).map(v=>{const f=v.dueDate&&new Date(v.dueDate)<new Date&&!v.completedAt;return e.jsxs("button",{onClick:()=>d(v),className:`
                      w-full text-left px-2 py-1 rounded text-xs truncate
                      ${f?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300"}
                      hover:ring-2 hover:ring-teal-400 transition-all
                    `,children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-1 ${b[v.priority]}`}),v.title]},v._id)}),a.tasks.length>3&&e.jsxs("div",{className:"text-xs text-gray-400 px-2",children:["+",a.tasks.length-3," more"]})]})]},o))}),e.jsxs("div",{className:"flex items-center gap-4 p-3 border-t border-gray-200 dark:border-gray-700 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Priority:"}),Object.entries(b).map(([a,o])=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${o}`}),e.jsx("span",{className:"capitalize text-gray-600 dark:text-gray-400",children:a})]},a)),e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx(ce,{className:"w-3 h-3 text-red-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Overdue"})]})]})]})}const ae="http://localhost:5000/api",ne=()=>({"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`}),ct=async()=>{const t=await fetch(`${ae}/github/auth`,{headers:ne()});if(!t.ok)throw new Error("Failed to start GitHub authentication");return(await t.json()).authUrl},xt=async()=>{const t=await fetch(`${ae}/github/status`,{headers:ne()});if(!t.ok)throw new Error("Failed to get GitHub status");return t.json()},gs=async()=>{if(!(await fetch(`${ae}/github/disconnect`,{method:"DELETE",headers:ne()})).ok)throw new Error("Failed to disconnect GitHub")},ms=async(t=1,d=30)=>{const c=await fetch(`${ae}/github/repos?page=${t}&perPage=${d}`,{headers:ne()});if(!c.ok)throw new Error("Failed to get repositories");return c.json()},hs=async(t,d,c={})=>{const w=new URLSearchParams;c.sha&&w.append("sha",c.sha),c.since&&w.append("since",c.since),c.until&&w.append("until",c.until),c.page&&w.append("page",String(c.page)),c.perPage&&w.append("perPage",String(c.perPage));const j=await fetch(`${ae}/github/repos/${t}/${d}/commits?${w.toString()}`,{headers:ne()});if(!j.ok)throw new Error("Failed to get commits");return j.json()},us=async(t,d,c="all")=>{const w=await fetch(`${ae}/github/repos/${t}/${d}/pulls?state=${c}`,{headers:ne()});if(!w.ok)throw new Error("Failed to get pull requests");return w.json()},ys=async(t,d)=>{const c=await fetch(`${ae}/github/repos/${t}/${d}/branches`,{headers:ne()});if(!c.ok)throw new Error("Failed to get branches");return c.json()},ps=async(t,d,c,w)=>{const j=await fetch(`${ae}/github/projects/${t}/connect`,{method:"POST",headers:ne(),body:JSON.stringify({repoOwner:d,repoName:c,syncSettings:w})});if(!j.ok){const F=await j.json();throw new Error(F.message||"Failed to connect repository")}return j.json()},bs=async t=>{if(!(await fetch(`${ae}/github/projects/${t}/disconnect`,{method:"DELETE",headers:ne()})).ok)throw new Error("Failed to disconnect repository")},gt=async t=>{const d=await fetch(`${ae}/github/projects/${t}/status`,{headers:ne()});if(!d.ok)throw new Error("Failed to get project GitHub status");return d.json()},fs=async(t,d=50,c=0)=>{const w=await fetch(`${ae}/github/projects/${t}/activity?limit=${d}&offset=${c}`,{headers:ne()});if(!w.ok)throw new Error("Failed to get GitHub activity");return w.json()};function js({projectId:t,limit:d=20,compact:c=!1}){const[w,j]=s.useState([]),[F,P]=s.useState(!0),[L,T]=s.useState(null),_=s.useRef(!1),A=s.useCallback(async()=>{P(!0),T(null);try{const o=await fs(t,d,0);j(o.activities)}catch(o){console.error("Error loading GitHub activity:",o),T("Failed to load GitHub activity")}finally{P(!1)}},[t,d]);s.useEffect(()=>{_.current||(_.current=!0,A())},[]);const y=(o,v)=>{switch(o){case"push":return e.jsx(Pe,{className:"w-4 h-4"});case"pull_request":return v==="closed"?e.jsx(ot,{className:"w-4 h-4"}):e.jsx(ve,{className:"w-4 h-4"});case"issues":return e.jsx(ce,{className:"w-4 h-4"});case"issue_comment":return e.jsx(mt,{className:"w-4 h-4"});case"create":return e.jsx(pe,{className:"w-4 h-4"});case"delete":return e.jsx(be,{className:"w-4 h-4"});default:return e.jsx(st,{className:"w-4 h-4"})}},b=(o,v)=>{switch(o){case"push":return"text-blue-500 bg-blue-50 dark:bg-blue-900/20";case"pull_request":return v==="closed"?"text-purple-500 bg-purple-50 dark:bg-purple-900/20":"text-green-500 bg-green-50 dark:bg-green-900/20";case"issues":return"text-yellow-500 bg-yellow-50 dark:bg-yellow-900/20";case"issue_comment":return"text-gray-500 bg-gray-50 dark:bg-gray-900/50";case"create":return"text-teal-500 bg-teal-50 dark:bg-teal-900/20";case"delete":return"text-red-500 bg-red-50 dark:bg-red-900/20";default:return"text-gray-500 bg-gray-50 dark:bg-gray-900/50"}},i=o=>{const{eventType:v,action:f,payload:N,sender:B}=o;switch(v){case"push":{const M=N.commits?.length||0,H=N.ref?.replace("refs/heads/","");return e.jsxs("span",{children:[e.jsx("strong",{children:B.login})," pushed ",M," commit",M!==1?"s":""," to"," ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:H})]})}case"pull_request":{const M=N.pullRequest;return e.jsxs("span",{children:[e.jsx("strong",{children:B.login})," ",f," pull request"," ",e.jsxs("a",{href:M?.url,target:"_blank",rel:"noopener noreferrer",className:"text-teal-600 hover:underline",children:["#",M?.number]})," ","- ",M?.title]})}case"issues":{const M=N.issue;return e.jsxs("span",{children:[e.jsx("strong",{children:B.login})," ",f," issue"," ",e.jsxs("a",{href:M?.url,target:"_blank",rel:"noopener noreferrer",className:"text-teal-600 hover:underline",children:["#",M?.number]})," ","- ",M?.title]})}case"issue_comment":return e.jsxs("span",{children:[e.jsx("strong",{children:B.login})," commented on issue #",N.issue?.number]});case"create":return e.jsxs("span",{children:[e.jsx("strong",{children:B.login})," created ",N.refType," ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:N.ref})]});case"delete":return e.jsxs("span",{children:[e.jsx("strong",{children:B.login})," deleted ",N.refType," ",e.jsx("code",{className:"px-1 py-0.5 bg-gray-100 dark:bg-gray-800 rounded text-sm",children:N.ref})]});default:return e.jsxs("span",{children:[e.jsx("strong",{children:B.login})," performed ",v," ",f&&`(${f})`]})}},a=o=>{const v=new Date(o),N=new Date().getTime()-v.getTime(),B=Math.floor(N/6e4),M=Math.floor(N/36e5),H=Math.floor(N/864e5);return B<1?"just now":B<60?`${B}m ago`:M<24?`${M}h ago`:H<7?`${H}d ago`:v.toLocaleDateString()};return F?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(oe,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading activity..."})]}):L?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-500",children:L}),e.jsx("button",{onClick:A,className:"mt-2 text-sm text-teal-600 hover:underline",children:"Try again"})]}):w.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Pe,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No GitHub activity yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Activity will appear here when webhook events are received"})]}):e.jsxs("div",{className:c?"":"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[!c&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"GitHub Activity"}),e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Refresh",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),e.jsx("div",{className:c?"space-y-2":"divide-y divide-gray-100 dark:divide-gray-800",children:w.map((o,v)=>e.jsx("div",{className:`${c?"p-2":"p-4"} hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${b(o.eventType,o.action)}`,children:y(o.eventType,o.action)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o.sender.avatarUrl&&e.jsx("img",{src:o.sender.avatarUrl,alt:o.sender.login,className:"w-5 h-5 rounded-full"}),e.jsx("p",{className:`text-gray-900 dark:text-white ${c?"text-sm":""}`,children:i(o)})]}),e.jsx("span",{className:"text-xs text-gray-400 whitespace-nowrap",children:a(o.createdAt)})]}),o.eventType==="push"&&o.payload.commits&&!c&&e.jsxs("div",{className:"mt-2 space-y-1",children:[o.payload.commits.slice(0,3).map((f,N)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("code",{className:"text-xs font-mono",children:f.sha?.slice(0,7)}),e.jsx("span",{className:"truncate",children:f.message?.split(`
`)[0]}),f.url&&e.jsx("a",{href:f.url,target:"_blank",rel:"noopener noreferrer",className:"text-teal-500 hover:text-teal-600",children:e.jsx(Ce,{className:"w-3 h-3"})})]},f.sha||`commit-${N}`)),o.payload.commits.length>3&&e.jsxs("span",{className:"text-xs text-gray-400",children:["+",o.payload.commits.length-3," more commits"]})]})]})]})},o._id?.toString()||`activity-${v}`))})]})}function Qe({onConnectionChange:t,compact:d}){const[c,w]=s.useState(null),[j,F]=s.useState(!0),[P,L]=s.useState(!1),[T,_]=s.useState(!1),[A,y]=s.useState(null),[b,i]=s.useState(null),a=s.useRef(!1);s.useEffect(()=>{const N=new URLSearchParams(window.location.search),B=N.get("github");if(B==="success")i("GitHub account connected successfully!"),window.history.replaceState({},"",window.location.pathname);else if(B==="error"){const M=N.get("message")||"Failed to connect GitHub account";y(M),window.history.replaceState({},"",window.location.pathname)}},[]);const o=s.useCallback(async()=>{F(!0);try{const N=await xt();w(N)}catch(N){console.error("Error fetching GitHub status:",N),y("Failed to check GitHub connection status")}finally{F(!1)}},[]);s.useEffect(()=>{a.current||(a.current=!0,o())},[]);const v=async()=>{L(!0),y(null);try{const N=await ct();window.location.href=N}catch(N){console.error("Error starting GitHub auth:",N),y("Failed to start GitHub authentication"),L(!1)}},f=async()=>{if(confirm("Are you sure you want to disconnect your GitHub account?")){_(!0),y(null);try{await gs(),w({connected:!1}),i("GitHub account disconnected")}catch(N){console.error("Error disconnecting GitHub:",N),y("Failed to disconnect GitHub account")}finally{_(!1)}}};return s.useEffect(()=>{if(b||A){const N=setTimeout(()=>{i(null),y(null)},5e3);return()=>clearTimeout(N)}},[b,A]),j?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(oe,{className:"w-6 h-6 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Checking GitHub connection..."})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-900 dark:bg-white rounded-lg flex items-center justify-center",children:e.jsx(me,{className:"w-6 h-6 text-white dark:text-gray-900"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"GitHub Integration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Connect your GitHub account for seamless integration"})]})]}),e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Refresh status",children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})})]}),A&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-400",children:A}),e.jsx("button",{onClick:()=>y(null),className:"ml-auto",children:e.jsx(he,{className:"w-4 h-4 text-red-500"})})]}),b&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-400",children:b}),e.jsx("button",{onClick:()=>i(null),className:"ml-auto",children:e.jsx(he,{className:"w-4 h-4 text-green-500"})})]}),e.jsx("div",{className:"p-4",children:c?.connected?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[c.avatarUrl&&e.jsx("img",{src:c.avatarUrl,alt:c.githubUsername,className:"w-12 h-12 rounded-full border-2 border-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["@",c.githubUsername]}),e.jsx("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full",children:"Connected"})]}),c.connectedAt&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Connected ",new Date(c.connectedAt).toLocaleDateString()]})]}),e.jsx("a",{href:`https://github.com/${c.githubUsername}`,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Ce,{className:"w-4 h-4 text-gray-500"})})]}),c.scopes&&c.scopes.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Permissions:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.scopes.map((N,B)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs rounded",children:N},B))})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"What you can do:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-500"}),"Connect repositories to projects"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-500"}),"View commits, PRs, and issues"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-500"}),"Auto-sync GitHub issues with tasks"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-500"}),"Receive real-time GitHub events"]})]})]}),e.jsxs("button",{onClick:f,disabled:T,className:"w-full mt-4 py-2 px-4 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[T?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(dt,{className:"w-4 h-4"}),T?"Disconnecting...":"Disconnect GitHub"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(me,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Connect Your GitHub Account"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-sm mx-auto",children:"Link your GitHub account to sync repositories, track commits, and automate task management with GitHub issues and pull requests."})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Features you'll unlock:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-teal-500"}),"Connect GitHub repos to your projects"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-teal-500"}),"View commits, branches, and PRs in-app"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-teal-500"}),"Auto-create tasks from GitHub issues"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-teal-500"}),"Auto-complete tasks when PRs merge"]})]})]}),e.jsxs("button",{onClick:v,disabled:P,className:"w-full py-3 px-4 bg-gray-900 dark:bg-white text-white dark:text-gray-900 rounded-lg hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[P?e.jsx(oe,{className:"w-5 h-5 animate-spin"}):e.jsx(me,{className:"w-5 h-5"}),P?"Connecting...":"Connect with GitHub"]}),e.jsx("p",{className:"text-xs text-center text-gray-400",children:"We'll ask for permission to access your repositories and create webhooks."})]})})]})}function Ze({projectId:t,projectName:d="Project"}){const[c,w]=s.useState(!1),[j,F]=s.useState(null),[P,L]=s.useState([]),[T,_]=s.useState(!0),[A,y]=s.useState(!1),[b,i]=s.useState(!1),[a,o]=s.useState(!1),[v,f]=s.useState(null),[N,B]=s.useState(null),[M,H]=s.useState(""),[Y,J]=s.useState(!1),[x,m]=s.useState(null),[k,p]=s.useState(!1),[D,r]=s.useState({syncIssues:!0,syncPullRequests:!0,syncCommits:!0,autoPR:!1,autoIssue:!1}),l=s.useRef(!1),u=s.useCallback(async()=>{_(!0);try{const $=await xt();w($.connected);const Z=await gt(t);F(Z)}catch($){console.error("Error checking statuses:",$)}finally{_(!1)}},[t]);s.useEffect(()=>{l.current||(l.current=!0,u())},[]);const S=async()=>{y(!0);try{const $=await ms(1,100);L($.repos)}catch($){console.error("Error loading repositories:",$),f("Failed to load repositories")}finally{y(!1)}},g=async()=>{try{const $=await ct();window.location.href=$}catch($){console.error("Error starting GitHub auth:",$),f("Failed to start GitHub authentication")}},z=async $=>{i(!0),f(null);try{const[Z,ee]=$.fullName.split("/");await ps(t,Z,ee,D),B(`Connected ${$.fullName} to ${d}`),J(!1),m(null),await u()}catch(Z){const ee=Z instanceof Error?Z.message:"Failed to connect repository";f(ee)}finally{i(!1)}},W=async()=>{if(confirm("Are you sure you want to disconnect this repository?")){o(!0),f(null);try{await bs(t),B("Repository disconnected"),F({connected:!1})}catch($){console.error("Error disconnecting repo:",$),f("Failed to disconnect repository")}finally{o(!1)}}},O=P.filter($=>$.name.toLowerCase().includes(M.toLowerCase())||$.fullName.toLowerCase().includes(M.toLowerCase()));return s.useEffect(()=>{if(N||v){const $=setTimeout(()=>{B(null),f(null)},5e3);return()=>clearTimeout($)}},[N,v]),T?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(oe,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading GitHub integration..."})]})}):c?j?.connected?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-900 dark:bg-white rounded-lg flex items-center justify-center",children:e.jsx(me,{className:"w-5 h-5 text-white dark:text-gray-900"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"GitHub Repository"}),e.jsxs("a",{href:j.repoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-teal-600 hover:underline flex items-center gap-1",children:[j.repoFullName,e.jsx(Ce,{className:"w-3 h-3"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>p(!k),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Settings",children:e.jsx(Me,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:W,disabled:a,className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-500",title:"Disconnect",children:a?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):e.jsx(dt,{className:"w-4 h-4"})})]})]}),v&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-400",children:v}),e.jsx("button",{onClick:()=>f(null),className:"ml-auto",children:e.jsx(he,{className:"w-4 h-4 text-red-500"})})]}),N&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-green-700 dark:text-green-400",children:N}),e.jsx("button",{onClick:()=>B(null),className:"ml-auto",children:e.jsx(he,{className:"w-4 h-4 text-green-500"})})]}),k&&e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Sync Settings"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:j.syncSettings?.syncIssues,className:"w-4 h-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500",readOnly:!0}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Sync GitHub issues to tasks"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:j.syncSettings?.syncPullRequests,className:"w-4 h-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500",readOnly:!0}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Track pull requests"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:j.syncSettings?.syncCommits,className:"w-4 h-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500",readOnly:!0}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show commits in activity feed"})]})]})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[j.connectedAt&&e.jsxs("span",{children:["Connected ",new Date(j.connectedAt).toLocaleDateString()]}),j.lastSyncAt&&e.jsxs("span",{children:["Last sync: ",new Date(j.lastSyncAt).toLocaleString()]})]})})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Connect Repository"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Link a GitHub repository to this project"})]})]})}),v&&e.jsxs("div",{className:"mx-4 mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-700 dark:text-red-400",children:v}),e.jsx("button",{onClick:()=>f(null),className:"ml-auto",children:e.jsx(he,{className:"w-4 h-4 text-red-500"})})]}),e.jsx("div",{className:"p-4",children:Y?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search repositories...",value:M,onChange:$=>H($.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-teal-500 focus:border-transparent"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sync Options"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D.syncIssues,onChange:$=>r({...D,syncIssues:$.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Sync Issues"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D.syncPullRequests,onChange:$=>r({...D,syncPullRequests:$.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Track PRs"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:D.syncCommits,onChange:$=>r({...D,syncCommits:$.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-teal-600"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Show Commits"})]})]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:A?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(oe,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading repositories..."})]}):O.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No repositories found"}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:O.map($=>e.jsx("button",{onClick:()=>m($),className:`w-full p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ${x?.id===$.id?"bg-teal-50 dark:bg-teal-900/20":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ht,{className:"w-5 h-5 text-gray-400 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:$.name}),$.private&&e.jsx(Xt,{className:"w-3 h-3 text-gray-400"}),x?.id===$.id&&e.jsx(se,{className:"w-4 h-4 text-teal-500"})]}),$.description&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:$.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-400",children:[$.language&&e.jsx("span",{children:$.language}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ut,{className:"w-3 h-3"})," ",$.starCount]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3"})," ",$.forkCount]})]})]})]})},$.id?.toString()||$.fullName))})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{J(!1),m(null),H("")},className:"flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>x&&z(x),disabled:!x||b,className:"flex-1 py-2 px-4 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-4 h-4"}),"Connect Repository"]})})]})]}):e.jsxs("button",{onClick:()=>{J(!0),S()},className:"w-full py-3 px-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-teal-500 dark:hover:border-teal-500 transition-colors flex items-center justify-center gap-2 text-gray-600 dark:text-gray-400 hover:text-teal-600",children:[e.jsx(me,{className:"w-5 h-5"}),"Select a Repository"]})})]}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(me,{className:"w-6 h-6 text-gray-400"})}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Connect GitHub First"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"You need to connect your GitHub account before linking a repository."}),e.jsxs("button",{onClick:g,className:"px-4 py-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 rounded-lg hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors flex items-center gap-2 mx-auto",children:[e.jsx(me,{className:"w-4 h-4"}),"Connect GitHub"]})]})})}function ws({projectId:t,isOwner:d}){const[c,w]=s.useState("overview"),[j,F]=s.useState(null),[P,L]=s.useState(!0),[T,_]=s.useState(null),[A,y]=s.useState([]),[b,i]=s.useState([]),[a,o]=s.useState([]),[v,f]=s.useState(!1),[N,B]=s.useState(!0),[M,H]=s.useState(!0),[Y,J]=s.useState(!1),x=s.useRef(!1),m=s.useCallback(async()=>{L(!0),_(null);try{const r=await gt(t);F(r)}catch(r){console.error("Error loading GitHub status:",r),_("Failed to load GitHub connection status")}finally{L(!1)}},[t]),k=s.useCallback(async r=>{const[l,u]=r.split("/");if(!(!l||!u)){f(!0);try{const[S,g,z]=await Promise.all([hs(l,u,{perPage:10}),us(l,u),ys(l,u)]);y(S.commits||[]),i(g.pullRequests||[]),o(z.branches||[])}catch(S){console.error("Error loading repository data:",S)}finally{f(!1)}}},[]);s.useEffect(()=>{x.current||(x.current=!0,m())},[]),s.useEffect(()=>{j?.connected&&j?.repository?.fullName&&k(j.repository.fullName)},[j?.connected,j?.repository?.fullName]);const p=s.useCallback(()=>{m()},[m]),D=r=>{const l=new Date(r),S=new Date().getTime()-l.getTime(),g=Math.floor(S/6e4),z=Math.floor(S/36e5),W=Math.floor(S/864e5);return g<1?"just now":g<60?`${g}m ago`:z<24?`${z}h ago`:W<7?`${W}d ago`:l.toLocaleDateString()};return P?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(oe,{className:"w-6 h-6 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading GitHub integration..."})]}):T?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"w-10 h-10 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-red-500 font-medium",children:T}),e.jsx("button",{onClick:m,className:"mt-3 text-teal-600 hover:underline",children:"Try again"})]}):j?.connected?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:j.repository?.fullName}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-300",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ${j.repository?.private?"bg-yellow-500/20 text-yellow-300":"bg-green-500/20 text-green-300"}`,children:j.repository?.private?"Private":"Public"}),e.jsxs("span",{className:`flex items-center gap-1 ${j.webhookActive?"text-green-400":"text-yellow-400"}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${j.webhookActive?"bg-green-400":"bg-yellow-400"}`}),j.webhookActive?"Webhook Active":"Webhook Inactive"]})]})]})]}),e.jsx("a",{href:j.repository?.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),j.syncSettings&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[j.syncSettings.syncIssues&&e.jsx("span",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Issues"}),j.syncSettings.syncPullRequests&&e.jsx("span",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Pull Requests"}),j.syncSettings.syncCommits&&e.jsx("span",{className:"px-2 py-1 bg-white/10 rounded text-xs",children:"Commits"}),j.syncSettings.autoCreateTasks&&e.jsx("span",{className:"px-2 py-1 bg-teal-500/20 text-teal-300 rounded text-xs",children:"Auto-Create Tasks"}),j.syncSettings.autoUpdateStatus&&e.jsx("span",{className:"px-2 py-1 bg-teal-500/20 text-teal-300 rounded text-xs",children:"Auto-Update Status"})]})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>w("overview"),className:`px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors ${c==="overview"?"border-teal-500 text-teal-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Pe,{className:"w-4 h-4"}),"Overview"]}),e.jsxs("button",{onClick:()=>w("activity"),className:`px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors ${c==="activity"?"border-teal-500 text-teal-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(et,{className:"w-4 h-4"}),"Activity"]}),d&&e.jsxs("button",{onClick:()=>w("settings"),className:`px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors ${c==="settings"?"border-teal-500 text-teal-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(Me,{className:"w-4 h-4"}),"Settings"]})]}),c==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:p,disabled:P||v,className:"flex items-center gap-2 px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-teal-600 dark:hover:text-teal-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:[e.jsx(ue,{className:`w-4 h-4 ${P||v?"animate-spin":""}`}),"Refresh"]})}),v&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(oe,{className:"w-5 h-5 text-teal-500 animate-spin"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading repository data..."})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>B(!N),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Recent Commits"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",A.length,")"]})]}),N?e.jsx(Le,{className:"w-4 h-4"}):e.jsx(Te,{className:"w-4 h-4"})]}),N&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 divide-y divide-gray-100 dark:divide-gray-700",children:A.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No commits found"}):A.map((r,l)=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[r.author?.avatarUrl&&e.jsx("img",{src:r.author.avatarUrl,alt:r.author.login,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-900 dark:text-white font-medium truncate",children:r.message.split(`
`)[0]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsx("code",{className:"text-xs font-mono",children:r.sha.slice(0,7)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:r.author?.login||r.author.name}),e.jsx("span",{children:"•"}),e.jsx("span",{children:D(r.author.date)})]})]}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors",children:e.jsx(Ce,{className:"w-4 h-4 text-gray-400"})})]})},r.sha?.toString()||`commit-${l}`))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>H(!M),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Pull Requests"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",b.length,")"]})]}),M?e.jsx(Le,{className:"w-4 h-4"}):e.jsx(Te,{className:"w-4 h-4"})]}),M&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 divide-y divide-gray-100 dark:divide-gray-700",children:b.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No open pull requests"}):b.map(r=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[r.merged?e.jsx(ot,{className:"w-5 h-5 text-purple-500 mt-0.5"}):r.state==="open"?e.jsx(ve,{className:"w-5 h-5 text-green-500 mt-0.5"}):e.jsx(ve,{className:"w-5 h-5 text-red-500 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-gray-900 dark:text-white font-medium",children:["#",r.number," ",r.title]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[e.jsx("img",{src:r.user.avatarUrl,alt:r.user.login,className:"w-4 h-4 rounded-full"}),e.jsx("span",{children:r.user.login}),e.jsx("span",{children:"•"}),e.jsx("span",{children:D(r.updatedAt)})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r.merged?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300":r.state==="open"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"}`,children:r.merged?"Merged":r.state})]})},`pr-${r.number}`))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>J(!Y),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-teal-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"Branches"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",a.length,")"]})]}),Y?e.jsx(Le,{className:"w-4 h-4"}):e.jsx(Te,{className:"w-4 h-4"})]}),Y&&e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 divide-y divide-gray-100 dark:divide-gray-700",children:a.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No branches found"}):a.map(r=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-mono text-sm text-gray-900 dark:text-white",children:r.name}),r.protected&&e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300 rounded text-xs",children:"Protected"})]})})},`branch-${r.name}`))})]})]}),c==="activity"&&e.jsx(js,{projectId:t,limit:50}),c==="settings"&&d&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Qe,{}),e.jsx(Ze,{projectId:t,onConnectionChange:m})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-800/50 rounded-xl",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Connect GitHub Repository"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Link your GitHub repository to automatically sync issues, pull requests, and commits with your project tasks."})]}),e.jsx(Qe,{compact:!0}),e.jsx(Ze,{projectId:t})]})}function Ns({task:t,labels:d,onClick:c,onDragStart:w,onDragEnd:j,isDragging:F}){const P={low:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",medium:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",high:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",critical:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"},L={low:e.jsx(Te,{className:"w-3 h-3"}),medium:e.jsx(Ie,{className:"w-3 h-3"}),high:e.jsx(ce,{className:"w-3 h-3"}),critical:e.jsx(ce,{className:"w-3 h-3"})},T=s.useMemo(()=>{if(t.subtasks.length===0)return null;const i=t.subtasks.filter(a=>a.completed).length;return{completed:i,total:t.subtasks.length,percentage:Math.round(i/t.subtasks.length*100)}},[t.subtasks]),_=s.useMemo(()=>Array.isArray(t.labels)?t.labels.map(i=>{if(typeof i=="object"&&i!==null&&"id"in i)return i;if(typeof i=="string")return d.find(a=>a.id===i)}).filter(i=>i!=null&&typeof i.id=="string"):[],[t.labels,d]),A=s.useMemo(()=>!t.dueDate||t.completedAt?!1:new Date(t.dueDate)<new Date,[t.dueDate,t.completedAt]),y=s.useMemo(()=>{if(!t.dueDate)return null;const i=new Date(t.dueDate),a=new Date,o=Math.ceil((i.getTime()-a.getTime())/(1e3*60*60*24));return o===0?"Today":o===1?"Tomorrow":o===-1?"Yesterday":o<0?`${Math.abs(o)} days ago`:o<7?`${o} days`:i.toLocaleDateString("en-US",{month:"short",day:"numeric"})},[t.dueDate]),b=s.useMemo(()=>{if(!t.totalTimeSpent)return null;const i=Math.floor(t.totalTimeSpent/60),a=t.totalTimeSpent%60;return i===0?`${a}m`:`${i}h ${a}m`},[t.totalTimeSpent]);return e.jsxs("div",{draggable:!0,onDragStart:w,onDragEnd:j,onClick:c,className:`
        bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700
        p-3 cursor-pointer transition-all duration-200
        hover:shadow-md hover:border-purple-300 dark:hover:border-purple-600
        ${F?"opacity-50 rotate-3 scale-105":""}
      `,children:[_.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:_.map(i=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full text-white",style:{backgroundColor:i.color},children:i.name},i.id))}),e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white text-sm mb-2 line-clamp-2",children:t.title}),t.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2 line-clamp-2",children:t.description}),T&&e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3"}),T.completed,"/",T.total]}),e.jsxs("span",{children:[T.percentage,"%"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 rounded-full transition-all duration-300",style:{width:`${T.percentage}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`flex items-center gap-0.5 px-1.5 py-0.5 rounded ${P[t.priority]}`,children:[L[t.priority],e.jsx("span",{className:"capitalize",children:t.priority})]}),t.storyPoints&&e.jsxs("span",{className:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 px-1.5 py-0.5 rounded",children:[t.storyPoints," pts"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[t.comments.length>0&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(ke,{className:"w-3 h-3"}),t.comments.length]}),t.attachments.length>0&&e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(ze,{className:"w-3 h-3"}),t.attachments.length]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[y&&e.jsxs("span",{className:`flex items-center gap-1 ${A?"text-red-500":"text-gray-500 dark:text-gray-400"}`,children:[e.jsx($e,{className:"w-3 h-3"}),y]}),b&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-500 dark:text-gray-400",children:[e.jsx(ye,{className:"w-3 h-3"}),b]})]}),e.jsxs("div",{className:"flex -space-x-2",children:[t.assignees.slice(0,3).map((i,a)=>e.jsx("div",{className:"w-6 h-6 rounded-full bg-purple-500 flex items-center justify-center text-white text-xs font-medium border-2 border-white dark:border-gray-800",title:i.name||"Unknown",children:i.avatar?e.jsx("img",{src:i.avatar,alt:i.name||"User",className:"w-full h-full rounded-full"}):(i.name||"U").charAt(0).toUpperCase()},typeof i._id=="string"?i._id:String(i._id)||`assignee-${a}`)),t.assignees.length>3&&e.jsxs("div",{className:"w-6 h-6 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-800",children:["+",t.assignees.length-3]}),t.assignees.length===0&&e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:e.jsx(it,{className:"w-3 h-3 text-gray-400"})})]})]})]})}function vs({column:t,tasks:d,labels:c,onAddTask:w,onTaskClick:j,onDragStart:F,onDragEnd:P,onDragOver:L,onDrop:T,onColumnSettings:_,onToggleCollapse:A,dragOverColumnId:y}){const[b,i]=s.useState(!1),a=s.useRef(null),o=d.length,v=t.taskLimit&&o>t.taskLimit,f=y===t.id;return t.isCollapsed?e.jsx("div",{className:"flex-shrink-0 w-12 bg-white dark:bg-gray-800 rounded-xl p-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-lg border border-gray-200 dark:border-gray-700",onClick:()=>A?.(t.id),children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-[#00ADB5]"}),e.jsx("span",{className:"writing-mode-vertical text-xs font-medium text-gray-700 dark:text-gray-300",style:{writingMode:"vertical-rl",textOrientation:"mixed"},children:t.title}),e.jsx("span",{className:"bg-[#00ADB5]/10 text-[#00ADB5] px-1.5 py-0.5 rounded-full text-xs font-medium",children:o})]})}):e.jsxs("div",{ref:a,className:`
        flex-shrink-0 w-72 bg-white dark:bg-gray-800 rounded-xl flex flex-col shadow-lg border border-gray-200 dark:border-gray-700
        transition-all duration-200
        ${f?"ring-2 ring-[#00ADB5] bg-[#00ADB5]/5 dark:bg-[#00ADB5]/10":""}
      `,onDragOver:L,onDrop:N=>T(N,t.id),children:[e.jsxs("div",{className:"p-3 flex items-center justify-between border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:t.title}),e.jsxs("span",{className:`
              px-2 py-0.5 rounded-full text-xs font-medium
              ${v?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}
            `,children:[o,t.taskLimit&&` / ${t.taskLimit}`]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>A?.(t.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors",title:"Collapse column",children:e.jsx(tt,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:()=>w(t.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors",title:"Add task",children:e.jsx(de,{className:"w-4 h-4 text-gray-500"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(!b),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors",children:e.jsx(Mt,{className:"w-4 h-4 text-gray-500"})}),b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20 py-1",children:e.jsxs("button",{onClick:()=>{_?.(t),i(!1)},className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4"}),"Column Settings"]})})]})]})]})]}),v&&e.jsx("div",{className:"mx-3 mt-2 p-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400",children:["⚠️ WIP limit exceeded (",o,"/",t.taskLimit,")"]})}),e.jsx("div",{className:"flex-1 p-2 space-y-2 overflow-y-auto max-h-[calc(100vh-300px)] min-h-[100px]",children:d.length===0?e.jsx("div",{className:"flex items-center justify-center h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-400",children:"Drop tasks here"})}):d.map((N,B)=>e.jsx(Ns,{task:N,labels:c,onClick:()=>j(N),onDragStart:M=>F(M,N._id,t.id),onDragEnd:P},typeof N._id=="string"?N._id:String(N._id)||`task-${B}`))}),e.jsx("div",{className:"p-2 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("button",{onClick:()=>w(t.id),className:"w-full flex items-center justify-center gap-1 py-2.5 text-sm text-[#00ADB5] font-medium hover:bg-[#00ADB5]/10 rounded-lg transition-all",children:[e.jsx(de,{className:"w-4 h-4"}),"Add Task"]})})]})}function ks({columnId:t,columns:d,labels:c,members:w,onClose:j,onCreate:F}){const[P,L]=s.useState(""),[T,_]=s.useState(""),[A,y]=s.useState("medium"),[b,i]=s.useState([]),[a,o]=s.useState([]),[v,f]=s.useState(""),[N,B]=s.useState(""),[M,H]=s.useState(""),[Y,J]=s.useState(!1),x=async r=>{if(r.preventDefault(),!!P.trim()){J(!0);try{await F({title:P.trim(),description:T.trim()||void 0,priority:A,labels:b,assignees:a,dueDate:v||void 0,estimatedHours:N?parseFloat(N):void 0,storyPoints:M?parseInt(M):void 0})}finally{J(!1)}}},m=r=>{i(l=>l.includes(r)?l.filter(u=>u!==r):[...l,r])},k=r=>{o(l=>l.includes(r)?l.filter(u=>u!==r):[...l,r])},p={low:"bg-green-100 text-green-700 border-green-300",medium:"bg-yellow-100 text-yellow-700 border-yellow-300",high:"bg-orange-100 text-orange-700 border-orange-300",critical:"bg-red-100 text-red-700 border-red-300"},D=d.find(r=>r.id===t);return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-lg mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:D?.color}}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["New Task in ",D?.title]})]}),e.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(he,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:x,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title *"}),e.jsx("input",{type:"text",value:P,onChange:r=>L(r.target.value),placeholder:"Enter task title...",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-[#00ADB5] focus:border-[#00ADB5]",required:!0,autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("textarea",{value:T,onChange:r=>_(r.target.value),placeholder:"Add a description...",rows:3,className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg resize-none focus:ring-2 focus:ring-[#00ADB5] focus:border-[#00ADB5]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Priority"}),e.jsx("div",{className:"flex gap-2",children:["low","medium","high","critical"].map(r=>e.jsx("button",{type:"button",onClick:()=>y(r),className:`px-3 py-1.5 rounded-lg border text-sm capitalize transition-all ${A===r?p[r]+" ring-2 ring-offset-1":"bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-700 text-gray-600 dark:text-gray-400"}`,children:r},r))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(st,{className:"w-4 h-4 inline mr-1"}),"Labels"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(r=>e.jsx("button",{type:"button",onClick:()=>m(r.id),className:`px-2 py-1 rounded-full text-xs transition-all ${b.includes(r.id)?"text-white ring-2 ring-offset-1":"opacity-60 hover:opacity-100"}`,style:{backgroundColor:r.color},children:r.name},r.id))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[e.jsx(it,{className:"w-4 h-4 inline mr-1"}),"Assignees"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(r=>e.jsxs("button",{type:"button",onClick:()=>k(r.userId),className:`flex items-center gap-2 px-2 py-1 rounded-lg text-sm transition-all ${a.includes(r.userId)?"bg-[#00ADB5]/10 dark:bg-[#00ADB5]/20 text-[#00ADB5] ring-2 ring-[#00ADB5] ring-offset-1":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-gradient-to-r from-[#00ADB5] to-cyan-500 flex items-center justify-center text-white text-xs",children:r.name.charAt(0).toUpperCase()}),r.name]},r.userId))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[e.jsx($e,{className:"w-4 h-4 inline mr-1"}),"Due Date"]}),e.jsx("input",{type:"date",value:v,onChange:r=>f(r.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Est. Hours"}),e.jsx("input",{type:"number",value:N,onChange:r=>B(r.target.value),placeholder:"0",min:"0",step:"0.5",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Story Points"}),e.jsx("input",{type:"number",value:M,onChange:r=>H(r.target.value),placeholder:"0",min:"0",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg text-sm"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:j,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!P.trim()||Y,className:"px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white font-medium rounded-lg hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:Y?"Creating...":"Create Task"})]})]})]})})}function Cs({task:t,labels:d,columns:c,members:w,currentUserId:j,isProjectOwner:F,onClose:P,onUpdate:L,onDelete:T,onAddComment:_,onAddSubtask:A,onToggleSubtask:y,onStartTimer:b,onStopTimer:i,onSubmitForReview:a,onApprove:o,onRequestChanges:v}){const[f,N]=s.useState(!1),[B,M]=s.useState(t.title),[H,Y]=s.useState(t.description||""),[J,x]=s.useState(!1),[m,k]=s.useState(""),[p,D]=s.useState(""),[r,l]=s.useState(!1),[u,S]=s.useState(!1),[g,z]=s.useState(!1),[W,O]=s.useState(!1),[$,Z]=s.useState(!1),[ee,xe]=s.useState(""),[re,I]=s.useState("approve"),le=s.useMemo(()=>t.timeEntries.find(n=>n.userId===j&&!n.endTime),[t.timeEntries,j]),te=s.useMemo(()=>{if(t.subtasks.length===0)return null;const n=t.subtasks.filter(V=>V.completed).length;return{completed:n,total:t.subtasks.length,percentage:Math.round(n/t.subtasks.length*100)}},[t.subtasks]),je=n=>{const V=Math.floor(n/60),ie=n%60;return V===0?`${ie}m`:`${V}h ${ie}m`},K=()=>{B.trim()&&B!==t.title&&L(t._id,{title:B.trim()}),N(!1)},Fe=()=>{H!==t.description&&L(t._id,{description:H}),x(!1)},Re=n=>{const V=t.labels.includes(n)?t.labels.filter(ie=>ie!==n):[...t.labels,n];L(t._id,{labels:V})},h=n=>{const ie=t.assignees.map(we=>we._id).includes(n)?t.assignees.filter(we=>we._id!==n):[...t.assignees,w.find(we=>we.userId===n)].filter(Boolean);L(t._id,{assignees:ie})},C=n=>{n!==t.columnId&&L(t._id,{columnId:n}),z(!1)},E=n=>{L(t._id,{priority:n})},R=n=>{L(t._id,{dueDate:n.target.value||void 0})},q=n=>{if(n.preventDefault(),!m.trim())return;const V=m.match(/@(\w+)/g)?.map(ie=>ie.slice(1))||[];_(t._id,m.trim(),V),k("")},U=n=>{n.preventDefault(),p.trim()&&(A(t._id,p.trim()),D(""))},G={low:"bg-green-100 text-green-700 border-green-300",medium:"bg-yellow-100 text-yellow-700 border-yellow-300",high:"bg-orange-100 text-orange-700 border-orange-300",critical:"bg-red-100 text-red-700 border-red-300"};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-start justify-center z-50 overflow-y-auto py-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-3xl mx-4 relative",children:[e.jsx("button",{onClick:P,className:"absolute top-4 right-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(he,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[t.labels.map(n=>{const V=d.find(ie=>ie.id===n);return V?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full text-white",style:{backgroundColor:V.color},children:V.name},V.id):null}),e.jsxs("button",{onClick:()=>l(!r),className:"px-2 py-1 text-xs rounded-full bg-gray-100 dark:bg-gray-800 text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700",children:[e.jsx(de,{className:"w-3 h-3 inline"})," Label"]})]}),r&&e.jsx("div",{className:"absolute left-6 mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-10 py-1",children:d.map(n=>e.jsxs("button",{onClick:()=>Re(n.id),className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:n.color}}),e.jsx("span",{children:n.name}),t.labels.includes(n.id)&&e.jsx(se,{className:"w-4 h-4 ml-auto text-green-500"})]},n.id))}),f?e.jsx("input",{type:"text",value:B,onChange:n=>M(n.target.value),onBlur:K,onKeyDown:n=>n.key==="Enter"&&K(),className:"w-full text-xl font-bold bg-transparent border-b-2 border-[#00ADB5] outline-none dark:text-white",autoFocus:!0}):e.jsx("h2",{onClick:()=>N(!0),className:"text-xl font-bold text-gray-900 dark:text-white cursor-pointer hover:text-[#00ADB5] pr-8",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3 text-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>z(!g),className:"flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:c.find(n=>n.id===t.columnId)?.color}}),c.find(n=>n.id===t.columnId)?.title]}),g&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-40 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-10 py-1",children:c.map(n=>e.jsxs("button",{onClick:()=>C(n.id),className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:n.color}}),n.title,n.id===t.columnId&&e.jsx(se,{className:"w-4 h-4 ml-auto text-green-500"})]},n.id))})]}),e.jsxs("select",{value:t.priority,onChange:n=>E(n.target.value),className:`px-2 py-1 rounded-lg border text-sm ${G[t.priority]}`,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($e,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",value:t.dueDate?t.dueDate.split("T")[0]:"",onChange:R,className:"bg-transparent border-none text-sm text-gray-600 dark:text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"Points:"}),e.jsx("input",{type:"number",value:t.storyPoints||"",onChange:n=>L(t._id,{storyPoints:parseInt(n.target.value)||void 0}),className:"w-12 bg-gray-100 dark:bg-gray-800 rounded px-2 py-1 text-sm",placeholder:"0",min:"0"})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-3",children:[t.reviewStatus&&t.reviewStatus!=="not_submitted"&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ${t.reviewStatus==="approved"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.reviewStatus==="pending"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:[t.reviewStatus==="approved"&&e.jsx(Je,{className:"w-4 h-4"}),t.reviewStatus==="pending"&&e.jsx(ye,{className:"w-4 h-4"}),t.reviewStatus==="changes_requested"&&e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:t.reviewStatus.replace("_"," ")})]}),t.reviewedBy&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Reviewed by ",t.reviewedBy.name," on ",new Date(t.reviewedAt).toLocaleDateString()]})]}),t.reviewComment&&t.reviewStatus==="changes_requested"&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-400",children:[e.jsx("strong",{children:"Changes Requested:"})," ",t.reviewComment]})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[!F&&t.reviewStatus==="not_submitted"&&a&&e.jsxs("button",{onClick:()=>a(t._id),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg transition-all",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Submit for Review"]}),!F&&t.reviewStatus==="changes_requested"&&a&&e.jsxs("button",{onClick:()=>a(t._id),className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg transition-all",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Re-submit for Review"]}),F&&t.reviewStatus==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{I("approve"),Z(!0)},className:"flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600",children:[e.jsx(Je,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>{I("changes"),Z(!0)},className:"flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600",children:[e.jsx(vt,{className:"w-4 h-4"}),"Request Changes"]})]})]})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md mx-4 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:re==="approve"?"✅ Approve Task":"❌ Request Changes"}),e.jsx("textarea",{value:ee,onChange:n=>xe(n.target.value),placeholder:re==="approve"?"Add approval comment (optional)...":"Describe the changes needed (required)...",className:"w-full h-32 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 resize-none mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{re==="approve"?o?.(t._id,ee):ee.trim()&&v?.(t._id,ee),Z(!1),xe("")},disabled:re==="changes"&&!ee.trim(),className:`flex-1 py-2 rounded-lg text-white text-sm ${re==="approve"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed"}`,children:re==="approve"?"Approve":"Request Changes"}),e.jsx("button",{onClick:()=>{Z(!1),xe("")},className:"flex-1 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 p-6",children:[e.jsxs("div",{className:"col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Description"]}),J?e.jsxs("div",{children:[e.jsx("textarea",{value:H,onChange:n=>Y(n.target.value),className:"w-full h-32 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 resize-none",placeholder:"Add a description..."}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:Fe,className:"px-3 py-1 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg transition-all",children:"Save"}),e.jsx("button",{onClick:()=>{Y(t.description||""),x(!1)},className:"px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]}):e.jsx("div",{onClick:()=>x(!0),className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 min-h-[80px]",children:t.description||e.jsx("span",{className:"text-gray-400",children:"Click to add description..."})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),"Subtasks",te&&e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",te.completed,"/",te.total,")"]})]}),te&&e.jsx("div",{className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-3",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full transition-all duration-300",style:{width:`${te.percentage}%`}})}),e.jsx("div",{className:"space-y-2",children:t.subtasks.map(n=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("button",{onClick:()=>y(t._id,n.id,!n.completed),className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${n.completed?"bg-green-500 border-green-500 text-white":"border-gray-300 dark:border-gray-600 hover:border-green-400"}`,children:n.completed&&e.jsx(se,{className:"w-3 h-3"})}),e.jsx("span",{className:n.completed?"line-through text-gray-400":"text-gray-700 dark:text-gray-300",children:n.text})]},n.id))}),e.jsxs("form",{onSubmit:U,className:"mt-2 flex gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:n=>D(n.target.value),placeholder:"Add a subtask...",className:"flex-1 px-3 py-2 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 text-sm"}),e.jsx("button",{type:"submit",disabled:!p.trim(),className:"px-3 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg disabled:opacity-50 transition-all",children:e.jsx(de,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Comments (",t.comments.length,")"]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:t.comments.map(n=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-[#00ADB5] to-cyan-500 flex items-center justify-center text-white text-sm",children:n.authorName.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900 dark:text-white",children:n.authorName}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(n.createdAt).toLocaleString()})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:n.content})]})]},n.id))}),e.jsxs("form",{onSubmit:q,className:"mt-3",children:[e.jsx("textarea",{value:m,onChange:n=>k(n.target.value),placeholder:"Write a comment... Use @username to mention someone",className:"w-full p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 resize-none text-sm",rows:2}),e.jsx("button",{type:"submit",disabled:!m.trim(),className:"mt-2 px-4 py-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg text-sm hover:shadow-lg disabled:opacity-50 transition-all",children:"Post Comment"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),"Assignees"]}),e.jsxs("div",{className:"space-y-2",children:[t.assignees.map((n,V)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r from-[#00ADB5] to-cyan-500 flex items-center justify-center text-white text-xs",children:(n.name||"U").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:n.name||"Unknown"})]},typeof n._id=="string"?n._id:String(n._id)||`assignee-${V}`)),e.jsxs("button",{onClick:()=>S(!u),className:"flex items-center gap-1 text-sm text-[#00ADB5] hover:text-cyan-600",children:[e.jsx(de,{className:"w-4 h-4"}),"Add assignee"]}),u&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:w.map(n=>e.jsxs("button",{onClick:()=>h(n.userId),className:"w-full flex items-center gap-2 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-sm",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-300 flex items-center justify-center text-xs",children:n.name.charAt(0).toUpperCase()}),e.jsx("span",{children:n.name}),t.assignees.some(V=>V._id===n.userId)&&e.jsx(se,{className:"w-4 h-4 ml-auto text-green-500"})]},n.userId))})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"Time Tracking"]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:je(t.totalTimeSpent)}),t.estimatedHours&&e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:["Estimated: ",t.estimatedHours,"h"]}),le?e.jsxs("button",{onClick:()=>i(t._id,le.id),className:"w-full flex items-center justify-center gap-2 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:[e.jsx(ss,{className:"w-4 h-4"}),"Stop Timer"]}):e.jsxs("button",{onClick:()=>b(t._id),className:"w-full flex items-center justify-center gap-2 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Start Timer"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2 flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),"Attachments (",t.attachments.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.attachments.map(n=>e.jsxs("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-sm",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"truncate",children:n.name})]},n.id))})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:W?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-red-600",children:"Are you sure you want to delete this task?"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(t._id),className:"flex-1 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600",children:"Delete"}),e.jsx("button",{onClick:()=>O(!1),className:"flex-1 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"})]})]}):e.jsxs("button",{onClick:()=>O(!0),className:"w-full flex items-center justify-center gap-2 py-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-sm",children:[e.jsx(be,{className:"w-4 h-4"}),"Delete Task"]})})]})]})]})})}const X="http://localhost:5000/api";function Ss({projectId:t,boardId:d,members:c,currentUserId:w,currentUserName:j,isProjectOwner:F,onViewChange:P}){const[L,T]=s.useState(!0),[_,A]=s.useState(null),[y,b]=s.useState([]),[i,a]=s.useState(null),[o,v]=s.useState(null),[f,N]=s.useState(""),[B,M]=s.useState("all"),[H,Y]=s.useState("all"),[J,x]=s.useState(null),[m,k]=s.useState(null),[p,D]=s.useState(null),r=()=>localStorage.getItem("authToken"),l=s.useCallback(async()=>{try{T(!0),D(null);const C={"Content-Type":"application/json",Authorization:`Bearer ${r()}`},E=await fetch(`${X}/boards/project/${t}`,{headers:C});if(!E.ok)throw new Error("Failed to fetch boards");const R=await E.json();if(R.length===0){const q=await fetch(`${X}/boards/project/${t}`,{method:"POST",headers:C,body:JSON.stringify({title:"Main Board"})});if(!q.ok)throw new Error("Failed to create board");const U=await q.json();A(U),b([])}else{const q=d&&R.find(n=>n._id===d)||R[0],U=await fetch(`${X}/boards/${q._id}`,{headers:C});if(!U.ok)throw new Error("Failed to fetch board");const G=await U.json();A(G.board||G),b(G.tasks||[])}}catch(h){console.error("Error fetching board:",h),D(h.message)}finally{T(!1)}},[t,d]);s.useEffect(()=>{l()},[l]);const u=s.useMemo(()=>y.filter(h=>{if(f){const C=f.toLowerCase(),E=h.title.toLowerCase().includes(C),R=h.description?.toLowerCase().includes(C);if(!E&&!R)return!1}return!(B!=="all"&&h.priority!==B||H!=="all"&&(H==="unassigned"&&h.assignees.length>0||H!=="unassigned"&&!h.assignees.some(C=>C._id===H)))}),[y,f,B,H]),S=s.useMemo(()=>{const h={};return _&&_.columns.forEach(C=>{h[C.id]=u.filter(E=>E.columnId===C.id).sort((E,R)=>E.position-R.position)}),h},[_,u]),g=(h,C,E)=>{h.dataTransfer.setData("text/plain",C),k({taskId:C,columnId:E})},z=()=>{k(null),x(null)},W=h=>{h.preventDefault()},O=async(h,C)=>{h.preventDefault();const E=h.dataTransfer.getData("text/plain");if(x(null),!m||m.columnId===C){k(null);return}try{const R=r(),U=(S[C]||[]).length;if(!(await fetch(`${X}/boards/tasks/${E}/move`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify({columnId:C,position:U})})).ok)throw new Error("Failed to move task");b(n=>n.map(V=>V._id===E?{...V,columnId:C,position:U}:V))}catch(R){console.error("Error moving task:",R)}k(null)},$=async h=>{if(!(!_||!o))try{const C=r(),E=await fetch(`${X}/boards/${_._id}/tasks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify({...h,columnId:o.columnId,labels:Array.isArray(h.labels)?h.labels.map(q=>typeof q=="string"?q:q?.id).filter(Boolean):[],assignees:Array.isArray(h.assignees)?h.assignees.map(q=>typeof q=="string"?q:q?._id||q?.userId).filter(Boolean):[]})});if(!E.ok){const q=await E.json().catch(()=>({}));throw new Error(q.message||"Failed to create task")}const R=await E.json();b(q=>[...q,R]),v(null)}catch(C){throw console.error("Error creating task:",C),C}},Z=async(h,C)=>{try{const E=r(),R=await fetch(`${X}/boards/tasks/${h}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify(C)});if(!R.ok)throw new Error("Failed to update task");const q=await R.json();b(U=>U.map(G=>G._id===h?q:G)),i?._id===h&&a(q)}catch(E){console.error("Error updating task:",E)}},ee=async h=>{try{const C=r();if(!(await fetch(`${X}/boards/tasks/${h}`,{method:"DELETE",headers:{Authorization:`Bearer ${C}`}})).ok)throw new Error("Failed to delete task");b(R=>R.filter(q=>q._id!==h)),a(null)}catch(C){console.error("Error deleting task:",C)}},xe=async(h,C,E)=>{try{const R=r();if(!(await fetch(`${X}/boards/tasks/${h}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify({content:C,mentions:E})})).ok)throw new Error("Failed to add comment");const U=await fetch(`${X}/boards/tasks/${h}`,{headers:{Authorization:`Bearer ${R}`}});if(U.ok){const G=await U.json();b(n=>n.map(V=>V._id===h?G:V)),i?._id===h&&a(G)}}catch(R){console.error("Error adding comment:",R)}},re=async(h,C)=>{try{const E=r(),R=await fetch(`${X}/boards/tasks/${h}/subtasks`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({text:C})});if(!R.ok)throw new Error("Failed to add subtask");const q=await R.json();b(U=>U.map(G=>G._id===h?{...G,subtasks:[...G.subtasks,q]}:G)),i?._id===h&&a(U=>U?{...U,subtasks:[...U.subtasks,q]}:null)}catch(E){console.error("Error adding subtask:",E)}},I=async(h,C,E)=>{try{const R=r(),q=await fetch(`${X}/boards/tasks/${h}/subtasks/${C}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify({completed:E})});if(!q.ok)throw new Error("Failed to toggle subtask");const U=await q.json();b(G=>G.map(n=>n._id===h?{...n,subtasks:n.subtasks.map(V=>V.id===C?U:V)}:n)),i?._id===h&&a(G=>G?{...G,subtasks:G.subtasks.map(n=>n.id===C?U:n)}:null)}catch(R){console.error("Error toggling subtask:",R)}},le=async(h,C)=>{try{const E=r(),R=await fetch(`${X}/boards/tasks/${h}/time/start`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({description:C})});if(!R.ok)throw new Error("Failed to start timer");const q=await R.json();b(U=>U.map(G=>G._id===h?{...G,timeEntries:[...G.timeEntries,q]}:G)),i?._id===h&&a(U=>U?{...U,timeEntries:[...U.timeEntries,q]}:null)}catch(E){console.error("Error starting timer:",E)}},te=async(h,C)=>{try{const E=r(),R=await fetch(`${X}/boards/tasks/${h}/time/${C}/stop`,{method:"PATCH",headers:{Authorization:`Bearer ${E}`}});if(!R.ok)throw new Error("Failed to stop timer");const{timeEntry:q,totalTimeSpent:U}=await R.json();b(G=>G.map(n=>n._id===h?{...n,timeEntries:n.timeEntries.map(V=>V.id===C?q:V),totalTimeSpent:U}:n)),i?._id===h&&a(G=>G?{...G,timeEntries:G.timeEntries.map(n=>n.id===C?q:n),totalTimeSpent:U}:null)}catch(E){console.error("Error stopping timer:",E)}},je=async h=>{try{const C=r(),E=await fetch(`${X}/boards/tasks/${h}/submit-review`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`}});if(!E.ok)throw new Error("Failed to submit task for review");const R=await E.json();b(q=>q.map(U=>U._id===h?R:U)),i?._id===h&&a(R)}catch(C){console.error("Error submitting task for review:",C)}},K=async(h,C)=>{try{const E=r(),R=await fetch(`${X}/boards/tasks/${h}/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({comment:C})});if(!R.ok){const U=await R.json();throw new Error(U.message||"Failed to approve task")}const q=await R.json();b(U=>U.map(G=>G._id===h?q:G)),i?._id===h&&a(q)}catch(E){console.error("Error approving task:",E),alert(E instanceof Error?E.message:"Failed to approve task")}},Fe=async(h,C)=>{try{const E=r(),R=await fetch(`${X}/boards/tasks/${h}/request-changes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({comment:C})});if(!R.ok){const U=await R.json();throw new Error(U.message||"Failed to request changes")}const q=await R.json();b(U=>U.map(G=>G._id===h?q:G)),i?._id===h&&a(q)}catch(E){console.error("Error requesting changes:",E),alert(E instanceof Error?E.message:"Failed to request changes")}},Re=h=>{_&&A({..._,columns:_.columns.map(C=>C.id===h?{...C,isCollapsed:!C.isCollapsed}:C)})};return L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"inline-block w-12 h-12 border-4 border-[#00ADB5] border-t-transparent rounded-full animate-spin"})}):p?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 gap-4 bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8",children:[e.jsx("p",{className:"text-red-500 font-medium",children:p}),e.jsx("button",{onClick:l,className:"px-6 py-3 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white font-bold rounded-xl hover:shadow-lg transition-all",children:"Retry"})]}):_?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-4 p-4 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-700 rounded-xl p-1",children:[e.jsx("button",{className:"p-2 bg-gradient-to-r from-[#00ADB5] to-cyan-600 text-white rounded-lg shadow-sm",title:"Kanban View",children:e.jsx(qe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>P?.("list"),className:"p-2 hover:bg-white dark:hover:bg-gray-600 rounded-lg text-gray-500 dark:text-gray-400 transition-all",title:"List View",children:e.jsx(rt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>P?.("calendar"),className:"p-2 hover:bg-white dark:hover:bg-gray-600 rounded-lg text-gray-500 dark:text-gray-400 transition-all",title:"Calendar View",children:e.jsx($e,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>P?.("timeline"),className:"p-2 hover:bg-white dark:hover:bg-gray-600 rounded-lg text-gray-500 dark:text-gray-400 transition-all",title:"Timeline View",children:e.jsx(Ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:f,onChange:h=>N(h.target.value),placeholder:"Search tasks...",className:"w-full pl-10 pr-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00ADB5] focus:bg-white dark:focus:bg-gray-600 transition-all text-sm"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:B,onChange:h=>M(h.target.value),className:"px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]}),e.jsxs("select",{value:H,onChange:h=>Y(h.target.value),className:"px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:outline-none focus:ring-2 focus:ring-[#00ADB5]",children:[e.jsx("option",{value:"all",children:"All Assignees"}),e.jsx("option",{value:"unassigned",children:"Unassigned"}),c.map((h,C)=>e.jsx("option",{value:h.userId?.toString()||"",children:h.name},h.userId?.toString()||`member-${C}`))]}),e.jsx("button",{onClick:l,className:"p-2.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-[#00ADB5] border border-gray-300 dark:border-gray-600 transition-all",title:"Refresh",children:e.jsx(ue,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"flex-1 overflow-x-auto",children:e.jsxs("div",{className:"flex gap-4 p-4 min-h-full",children:[_.columns.sort((h,C)=>h.position-C.position).map(h=>e.jsx(vs,{column:h,tasks:S[h.id]||[],labels:_.labels,onAddTask:C=>v({columnId:C}),onTaskClick:a,onDragStart:g,onDragEnd:z,onDragOver:C=>{W(C),x(h.id)},onDrop:O,onToggleCollapse:Re,dragOverColumnId:J},h.id)),e.jsx("div",{className:"flex-shrink-0 w-72",children:e.jsxs("button",{className:"w-full h-12 flex items-center justify-center gap-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(de,{className:"w-5 h-5"}),"Add Column"]})})]})}),i&&e.jsx(Cs,{task:i,labels:_.labels,columns:_.columns,members:c,currentUserId:w,currentUserName:j,isProjectOwner:F,onClose:()=>a(null),onUpdate:Z,onDelete:ee,onAddComment:xe,onAddSubtask:re,onToggleSubtask:I,onStartTimer:le,onStopTimer:te,onSubmitForReview:je,onApprove:K,onRequestChanges:Fe}),o&&e.jsx(ks,{columnId:o.columnId,columns:_.columns,labels:_.labels,members:c,onClose:()=>v(null),onCreate:$})]}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center",children:[e.jsx(qe,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"No board found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create a new board to get started"})]})}const $s="http://localhost:5000/api";function Ds({projectId:t}){const[d,c]=s.useState(null),[w,j]=s.useState(!0),[F,P]=s.useState(null);s.useEffect(()=>{(async()=>{try{j(!0);const y=localStorage.getItem("authToken"),b=await fetch(`${$s}/boards/project/${t}/analytics`,{headers:{Authorization:`Bearer ${y}`}});if(!b.ok)throw new Error("Failed to fetch analytics");const i=await b.json();c(i)}catch(y){console.error("Error fetching analytics:",y),P(y.message)}finally{j(!1)}})()},[t]);const L=A=>{const y=Math.floor(A/60),b=A%60;return y===0?`${b}m`:b===0?`${y}h`:`${y}h ${b}m`},T={low:"#10B981",medium:"#F59E0B",high:"#F97316",critical:"#EF4444"};if(w)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-6 h-6 animate-spin text-teal-500"})});if(F||!d)return e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:e.jsx("p",{className:"text-red-500",children:"Failed to load analytics"})});const _=Math.max(...Object.values(d.tasks.byColumn),1);return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-teal-100 dark:bg-teal-900/30 rounded-xl",children:e.jsx(Ae,{className:"w-6 h-6 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d.tasks.total})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Completed"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[d.tasks.completed,"/",d.tasks.total]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-teal-500 rounded-full transition-all duration-500",style:{width:`${d.tasks.completionRate}%`}})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-xl",children:e.jsx(Se,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Completion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[d.tasks.completionRate,"%"]})]})]}),d.tasks.overdue>0&&e.jsxs("p",{className:"mt-4 text-sm text-red-500",children:["⚠️ ",d.tasks.overdue," overdue tasks"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:e.jsx(ye,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Time Spent"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:L(d.time.totalSpent)})]})]}),d.time.totalEstimated>0&&e.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["Est: ",L(d.time.totalEstimated)," (",d.time.efficiency,"% efficiency)"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-orange-100 dark:bg-orange-900/30 rounded-xl",children:e.jsx(fe,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Team Members"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d.team.memberCount})]})]}),e.jsxs("p",{className:"mt-4 text-sm text-gray-500",children:["~",d.team.tasksPerMember," tasks per member"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-teal-500"}),"Tasks by Column"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(d.tasks.byColumn).map(([A,y])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:A}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:y})]}),e.jsx("div",{className:"h-6 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-teal-500 to-indigo-500 rounded-full transition-all duration-500 flex items-center justify-end px-2",style:{width:`${y/_*100}%`},children:y>0&&e.jsx("span",{className:"text-xs text-white font-medium",children:y})})})]},A))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-teal-500"}),"Tasks by Priority"]}),e.jsx("div",{className:"flex items-center justify-center gap-4 h-48",children:Object.entries(d.tasks.byPriority).map(([A,y])=>{const b=Math.max(...Object.values(d.tasks.byPriority),1),i=y/b*100;return e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"relative h-36 w-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-end",children:[e.jsx("div",{className:"w-full rounded-lg transition-all duration-500",style:{backgroundColor:T[A],height:`${i}%`,minHeight:y>0?"8px":"0"}}),e.jsx("span",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-sm font-medium text-gray-900 dark:text-white",children:y})]}),e.jsx("span",{className:"text-xs capitalize text-gray-500",children:A})]},A)})})]})]}),d.sprints.total>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(kt,{className:"w-5 h-5 text-teal-500"}),"Sprint Performance"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:d.sprints.total}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total Sprints"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:d.sprints.completed}),e.jsx("p",{className:"text-sm text-gray-500",children:"Completed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-teal-600",children:d.sprints.averageVelocity}),e.jsx("p",{className:"text-sm text-gray-500",children:"Avg Velocity (pts)"})]})]})]})]})}const Xe="http://localhost:5000/api";function Ts({projectId:t,currentUserId:d,currentUserName:c,members:w=[],projectTitle:j="Project Chat"}){const[F,P]=s.useState([]),[L,T]=s.useState(""),[_,A]=s.useState(!0),[y,b]=s.useState(!1),[i,a]=s.useState(null),[o,v]=s.useState(!1),f=s.useRef(null),N=s.useRef(null),B=()=>localStorage.getItem("authToken"),M=s.useCallback(()=>{f.current?.scrollIntoView({behavior:"smooth"})},[]),H=s.useCallback(async(p=!0)=>{if(t)try{p&&(A(!0),a(null));const D=B(),r=await fetch(`${Xe}/projects/${t}/messages`,{headers:{Authorization:`Bearer ${D}`,"Content-Type":"application/json"}});if(r.ok){const u=(await r.json()).messages||[];P(S=>{const g=S.filter(O=>O.id.startsWith("temp-")),z=S.filter(O=>!O.id.startsWith("temp-"));if(z.length===u.length&&z.length>0&&z[z.length-1]?.id===u[u.length-1]?.id)return S;const W=g.filter(O=>!u.some($=>$.text===O.text&&$.senderId===O.senderId));return[...u,...W]}),p&&a(null)}else if(p){let l="Failed to fetch messages";try{l=(await r.json()).error||l}catch{}r.status===401?a("Please log in to view messages."):r.status===403?a("You do not have permission to view these messages."):a(l)}}catch(D){p&&(console.error("📨 Network error fetching messages:",D),a("Failed to connect to server"))}finally{p&&A(!1)}},[t]);s.useEffect(()=>{if(!t)return;at(),nt(t),H(!0);const p=r=>{console.log("📨 Real-time message received:",r.id),P(l=>{if(l.some(S=>S.id===r.id))return l;const u=l.map(S=>S.id.startsWith("temp-")&&S.text===r.text&&S.senderId===r.senderId?r:S);return l.some(S=>S.id.startsWith("temp-")&&S.text===r.text&&S.senderId===r.senderId)?u:[...u,r]}),a(null)};jt(p);const D=setInterval(()=>{H(!1)},15e3);return()=>{clearInterval(D),lt(t),wt(p)}},[t,H]),s.useEffect(()=>{M()},[F,M]);const Y=async p=>{p?.preventDefault();const D=L.trim();if(!(!D||y))try{b(!0),a(null);const r=B(),l={id:`temp-${Date.now()}`,text:D,senderId:d,senderName:c,timestamp:new Date().toISOString()};P(S=>[...S,l]),T(""),console.log("📨 Sending message:",D);const u=await fetch(`${Xe}/projects/${t}/messages`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({text:D})});if(console.log("📨 Send response status:",u.status),u.ok){const S=await u.json();console.log("📨 Message sent successfully:",S.message?.id),P(g=>g.map(z=>z.id===l.id?S.message:z)),a(null)}else{P(g=>g.filter(z=>z.id!==l.id)),T(D);let S="Failed to send message";try{S=(await u.json()).error||S}catch{}console.error("📨 Send error:",u.status,S),a(S)}}catch(r){console.error("📨 Network error sending message:",r),a("Failed to send message. Check your connection.")}finally{b(!1),N.current?.focus()}},J=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),Y())},x=p=>{const D=new Date(p),r=new Date;return D.toDateString()===r.toDateString()?D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):D.toLocaleDateString([],{month:"short",day:"numeric"})+" "+D.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},m=p=>{const D=["bg-teal-500","bg-blue-500","bg-purple-500","bg-pink-500","bg-orange-500","bg-green-500"],r=p.charCodeAt(0)%D.length;return D[r]},k=p=>w.find(D=>D.userId===p||String(D.userId)===String(p));return _?e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-180px)] min-h-[500px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Loading messages..."})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-180px)] min-h-[500px] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:j}),e.jsxs("p",{className:"text-sm text-gray-500",children:[w.length," members • ",F.length," messages"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>v(!o),className:`p-2 rounded-lg transition-colors ${o?"bg-teal-100 dark:bg-teal-900/30 text-teal-600":"hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500"}`,title:"Show members",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx("button",{className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500",children:e.jsx(Et,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[i&&!_&&e.jsxs("div",{className:"bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-4 py-2 rounded-lg text-sm text-center",children:[i,e.jsx("button",{onClick:()=>{a(null),H()},className:"ml-2 underline",children:"Retry"})]}),F.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ee,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:"No messages yet"}),e.jsx("p",{className:"text-gray-500",children:"Be the first to send a message to your team!"})]})}):F.map((p,D)=>{const r=p.senderId===d||String(p.senderId)===String(d),l=k(p.senderId),u=D===0||F[D-1].senderId!==p.senderId;return e.jsxs("div",{className:`flex items-end gap-2 ${r?"justify-end":"justify-start"}`,children:[!r&&u&&e.jsx("div",{className:`w-8 h-8 rounded-full ${m(p.senderId)} flex items-center justify-center text-white text-sm font-medium flex-shrink-0`,children:l?.avatar?e.jsx("img",{src:l.avatar,alt:"",className:"w-full h-full rounded-full"}):p.senderName?.charAt(0).toUpperCase()||"?"}),!r&&!u&&e.jsx("div",{className:"w-8"}),e.jsxs("div",{className:`max-w-[70%] ${r?"order-1":""}`,children:[!r&&u&&e.jsx("p",{className:"text-xs text-gray-500 mb-1 ml-1",children:p.senderName}),e.jsx("div",{className:`px-4 py-2 rounded-2xl ${r?"bg-teal-500 text-white rounded-br-md":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white rounded-bl-md"}`,children:e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:p.text})}),e.jsx("p",{className:`text-xs text-gray-400 mt-1 ${r?"text-right mr-1":"ml-1"}`,children:x(p.timestamp)})]})]},p.id)}),e.jsx("div",{ref:f})]}),e.jsx("form",{onSubmit:Y,className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:N,type:"text",value:L,onChange:p=>T(p.target.value),onKeyPress:J,placeholder:"Type a message...",className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-full text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500",disabled:y}),e.jsx("button",{type:"submit",disabled:!L.trim()||y,className:`p-3 rounded-full transition-colors ${L.trim()&&!y?"bg-teal-500 text-white hover:bg-teal-600":"bg-gray-200 dark:bg-gray-700 text-gray-400 cursor-not-allowed"}`,children:e.jsx(Ee,{className:"w-5 h-5"})})]})})]}),o&&e.jsx("div",{className:"w-64 border-l border-gray-200 dark:border-gray-700 overflow-y-auto",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Team Members"}),e.jsx("div",{className:"space-y-2",children:w.map((p,D)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${m(p.userId)} flex items-center justify-center text-white text-sm font-medium`,children:p.avatar?e.jsx("img",{src:p.avatar,alt:"",className:"w-full h-full rounded-full"}):p.name?.charAt(0).toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:[p.name,p.userId===d&&e.jsx("span",{className:"text-xs text-teal-500 ml-1",children:"(you)"})]}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:p.role})]}),e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full",title:"Online"})]},p.userId||D))})]})})]})]})}const Be="http://localhost:5000/api";function As({projectId:t}){const[d,c]=s.useState([]),[w,j]=s.useState(!0),[F,P]=s.useState(!1),[L,T]=s.useState(null),[_,A]=s.useState("grid"),[y,b]=s.useState(""),[i,a]=s.useState(null),[o,v]=s.useState(!1),[f,N]=s.useState({name:"",url:"",type:"document"}),[B,M]=s.useState(null),H=()=>localStorage.getItem("authToken"),Y=s.useCallback(async()=>{if(t)try{j(!0);const l=H(),u=await fetch(`${Be}/projects/${t}/files`,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(u.ok){const S=await u.json();c(S.files||[]),T(null)}else{const S=await u.json();T(S.error||"Failed to fetch files")}}catch(l){console.error("Error fetching files:",l),T("Failed to connect to server")}finally{j(!1)}},[t]);s.useEffect(()=>{if(!t)return;at(),nt(t),Y();const l=Nt();return l&&(l.on("file-uploaded",u=>{console.log("📁 New file uploaded:",u),c(S=>S.some(g=>g.id===u.id)?S:[...S,u])}),l.on("file-deleted",u=>{console.log("🗑️ File deleted:",u.fileId),c(S=>S.filter(g=>g.id!==u.fileId))})),()=>{lt(t),l&&(l.off("file-uploaded"),l.off("file-deleted"))}},[t,Y]);const J=async l=>{if(l.preventDefault(),!(!f.name||!f.url))try{P(!0);const u=H(),S=await fetch(`${Be}/projects/${t}/files`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({name:f.name,url:f.url,type:f.type,size:0})});if(S.ok){const g=await S.json();c(z=>[...z,g.file]),v(!1),N({name:"",url:"",type:"document"}),T(null)}else{const g=await S.json();T(g.error||"Failed to upload file")}}catch(u){console.error("Error uploading file:",u),T("Failed to upload file")}finally{P(!1)}},x=async l=>{try{const u=H(),S=await fetch(`${Be}/projects/${t}/files/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});if(S.ok)c(g=>g.filter(z=>z.id!==l)),M(null),a(null);else{const g=await S.json();T(g.error||"Failed to delete file")}}catch(u){console.error("Error deleting file:",u),T("Failed to delete file")}},m=(l,u="w-8 h-8")=>{const S=`${u} text-gray-500`;switch(l.toLowerCase()){case"image":case"png":case"jpg":case"jpeg":case"gif":case"svg":return e.jsx(Ut,{className:`${u} text-purple-500`});case"video":case"mp4":case"mov":case"avi":return e.jsx(Ot,{className:`${u} text-red-500`});case"audio":case"mp3":case"wav":return e.jsx(Bt,{className:`${u} text-orange-500`});case"code":case"js":case"ts":case"py":case"java":case"html":case"css":return e.jsx(qt,{className:`${u} text-green-500`});case"archive":case"zip":case"rar":case"tar":return e.jsx(Rt,{className:`${u} text-yellow-500`});case"document":case"pdf":case"doc":case"docx":case"txt":return e.jsx(Ge,{className:`${u} text-blue-500`});default:return e.jsx(Ke,{className:S})}},k=l=>{if(!l||l===0)return"Unknown size";const u=["B","KB","MB","GB"];let S=l,g=0;for(;S>=1024&&g<u.length-1;)S/=1024,g++;return`${S.toFixed(1)} ${u[g]}`},p=l=>new Date(l).toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"}),D=d.filter(l=>l.name.toLowerCase().includes(y.toLowerCase())),r=[{value:"document",label:"Document"},{value:"image",label:"Image"},{value:"video",label:"Video"},{value:"audio",label:"Audio"},{value:"code",label:"Code"},{value:"archive",label:"Archive"},{value:"other",label:"Other"}];return w?e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-280px)] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Loading files..."})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg h-[calc(100vh-280px)] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{className:"w-5 h-5 text-teal-500"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Project Files"}),e.jsxs("span",{className:"px-2 py-0.5 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-600 dark:text-gray-400",children:[d.length," files"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:y,onChange:l=>b(l.target.value),placeholder:"Search files...",className:"pl-9 pr-4 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 w-48"})]}),e.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>A("grid"),className:`p-1.5 rounded-md transition-colors ${_==="grid"?"bg-white dark:bg-gray-700 shadow-sm":""}`,children:e.jsx(Kt,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>A("list"),className:`p-1.5 rounded-md transition-colors ${_==="list"?"bg-white dark:bg-gray-700 shadow-sm":""}`,children:e.jsx(rt,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})})]}),e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-3 py-1.5 bg-teal-500 text-white rounded-lg hover:bg-teal-600 text-sm",children:[e.jsx(ft,{className:"w-4 h-4"}),"Upload"]})]})]}),L&&e.jsxs("div",{className:"mx-4 mt-4 px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg text-sm",children:[L,e.jsx("button",{onClick:()=>T(null),className:"ml-2 underline",children:"Dismiss"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:D.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(We,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:y?"No files found":"No files yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:y?"Try a different search term":"Upload files to share with your team"}),!y&&e.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600",children:"Upload First File"})]})}):_==="grid"?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:D.map(l=>e.jsxs("div",{onClick:()=>a(l),className:"group relative bg-gray-50 dark:bg-gray-800 rounded-lg p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center text-center",children:[m(l.type,"w-12 h-12"),e.jsx("p",{className:"mt-3 text-sm font-medium text-gray-900 dark:text-white truncate w-full",children:l.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:k(l.size)})]}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("button",{onClick:u=>{u.stopPropagation(),M(l.id)},className:"p-1.5 bg-red-100 dark:bg-red-900/30 rounded-md hover:bg-red-200 dark:hover:bg-red-900/50",children:e.jsx(be,{className:"w-4 h-4 text-red-500"})})})]},l.id))}):e.jsx("div",{className:"space-y-2",children:D.map(l=>e.jsxs("div",{onClick:()=>a(l),className:"flex items-center gap-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[m(l.type,"w-10 h-10"),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:l.name}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),p(l.uploadedAt)]}),e.jsx("span",{children:k(l.size)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",onClick:u=>u.stopPropagation(),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg",children:e.jsx(At,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:u=>{u.stopPropagation(),M(l.id)},className:"p-2 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-lg",children:e.jsx(be,{className:"w-4 h-4 text-red-500"})})]})]},l.id))})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>v(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-full max-w-md mx-4",onClick:l=>l.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add File"}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Name"}),e.jsx("input",{type:"text",value:f.name,onChange:l=>N(u=>({...u,name:l.target.value})),placeholder:"e.g., Project Proposal.pdf",className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File URL"}),e.jsx("input",{type:"url",value:f.url,onChange:l=>N(u=>({...u,url:l.target.value})),placeholder:"https://drive.google.com/file/...",className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Link to Google Drive, Dropbox, GitHub, or any other file hosting service"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"File Type"}),e.jsx("select",{value:f.type,onChange:l=>N(u=>({...u,type:l.target.value})),className:"w-full px-3 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",children:r.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:F||!f.name||!f.url,className:"px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 disabled:opacity-50 disabled:cursor-not-allowed",children:F?"Adding...":"Add File"})]})]})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>a(null),children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-full max-w-lg mx-4",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start gap-4",children:[m(i.type,"w-16 h-16"),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i.name}),e.jsxs("div",{className:"mt-2 space-y-1 text-sm text-gray-500",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Uploaded ",p(i.uploadedAt)]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"}),k(i.size)," • ",i.type]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsxs("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Open"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(i.url),alert("Link copied!")},className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:[e.jsx(_e,{className:"w-4 h-4"}),"Copy Link"]}),e.jsx("button",{onClick:()=>M(i.id),className:"flex items-center justify-center gap-2 px-4 py-2 bg-red-100 dark:bg-red-900/30 text-red-600 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50",children:e.jsx(be,{className:"w-4 h-4"})})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>M(null),children:e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 w-full max-w-sm mx-4",onClick:l=>l.stopPropagation(),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(be,{className:"w-6 h-6 text-red-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Delete File?"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>M(null),className:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:()=>x(B),className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:"Delete"})]})]})})})]})}const De="http://localhost:5000/api";function _s({projectId:t,boardId:d,tasks:c,onTaskClick:w,onTaskMoveToSprint:j}){const[F,P]=s.useState([]),[L,T]=s.useState(!0),[_,A]=s.useState(null),[y,b]=s.useState(!1),[i,a]=s.useState(null);s.useEffect(()=>{(async()=>{try{T(!0);const m=localStorage.getItem("authToken"),k=await fetch(`${De}/boards/project/${t}/sprints`,{headers:{Authorization:`Bearer ${m}`}});if(!k.ok)throw new Error("Failed to fetch sprints");const p=await k.json();P(p)}catch(m){console.error("Error fetching sprints:",m),A(m.message)}finally{T(!1)}})()},[t]);const o=s.useMemo(()=>F.find(x=>x.status==="active"),[F]),v=s.useMemo(()=>c.filter(x=>!x.sprintId),[c]),f=s.useMemo(()=>{const x={};return F.forEach(m=>{x[m._id]=c.filter(k=>k.sprintId===m._id)}),x},[F,c]),N=x=>{const m=f[x]||[],k=m.filter(r=>r.completedAt).length,p=m.reduce((r,l)=>r+(l.storyPoints||0),0),D=m.filter(r=>r.completedAt).reduce((r,l)=>r+(l.storyPoints||0),0);return{taskCount:m.length,completed:k,progress:m.length>0?Math.round(k/m.length*100):0,totalPoints:p,completedPoints:D}},B=x=>{const m=new Date(x),k=new Date,p=Math.ceil((m.getTime()-k.getTime())/(1e3*60*60*24));return Math.max(0,p)},M=async x=>{try{const m=localStorage.getItem("authToken"),k=await fetch(`${De}/boards/project/${t}/sprints`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({...x,boardId:d})});if(!k.ok)throw new Error("Failed to create sprint");const p=await k.json();P(D=>[...D,p]),b(!1)}catch(m){console.error("Error creating sprint:",m)}},H=async x=>{try{const m=localStorage.getItem("authToken"),k=await fetch(`${De}/boards/sprints/${x}/start`,{method:"PATCH",headers:{Authorization:`Bearer ${m}`}});if(!k.ok)throw new Error("Failed to start sprint");const p=await k.json();P(D=>D.map(r=>r._id===x?p:r))}catch(m){console.error("Error starting sprint:",m)}},Y=async x=>{try{const m=localStorage.getItem("authToken"),k=await fetch(`${De}/boards/sprints/${x}/complete`,{method:"PATCH",headers:{Authorization:`Bearer ${m}`}});if(!k.ok)throw new Error("Failed to complete sprint");const p=await k.json();P(D=>D.map(r=>r._id===x?p:r))}catch(m){console.error("Error completing sprint:",m)}},J={low:"border-l-green-500",medium:"border-l-yellow-500",high:"border-l-orange-500",critical:"border-l-red-500"};return L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ue,{className:"w-6 h-6 animate-spin text-teal-500"})}):e.jsxs("div",{className:"h-full flex gap-4 overflow-hidden",children:[e.jsxs("div",{className:"w-80 flex-shrink-0 bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-gray-500"}),"Backlog",e.jsxs("span",{className:"ml-auto text-sm font-normal text-gray-500",children:[v.length," tasks"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[v.reduce((x,m)=>x+(m.storyPoints||0),0)," points"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[v.map(x=>e.jsxs("div",{draggable:!0,onDragStart:m=>m.dataTransfer.setData("taskId",x._id),onClick:()=>w(x),className:`
                p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer
                border-l-4 ${J[x.priority]}
                hover:shadow-md transition-all
              `,children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:x.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[x.storyPoints&&e.jsxs("span",{className:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400 px-1.5 py-0.5 rounded",children:[x.storyPoints," pts"]}),x.assignees.length>0&&e.jsx("div",{className:"flex -space-x-1",children:x.assignees.slice(0,2).map(m=>e.jsx("div",{className:"w-5 h-5 rounded-full bg-teal-500 flex items-center justify-center text-white text-xs",title:m.name,children:m.name.charAt(0)},m._id))})]})]},x._id)),v.length===0&&e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx(Ae,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Backlog is empty"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[o&&e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-teal-50 dark:bg-teal-900/20 border-b border-teal-200 dark:border-teal-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-teal-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:o.name}),e.jsx("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full",children:"Active"})]}),o.goal&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:o.goal})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[B(o.endDate)," days remaining"]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Ends ",new Date(o.endDate).toLocaleDateString()]})]})]}),(()=>{const x=N(o._id);return e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Tasks"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[x.completed,"/",x.taskCount]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Progress"}),e.jsxs("p",{className:"text-xl font-bold text-teal-600",children:[x.progress,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Points"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[x.completedPoints,"/",x.totalPoints]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3",children:e.jsxs("button",{onClick:()=>Y(o._id),className:"w-full h-full flex items-center justify-center gap-2 text-teal-600 hover:bg-teal-50 dark:hover:bg-teal-900/30 rounded-lg",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Complete"]})})]})})()]}),e.jsxs("div",{className:"p-4 min-h-[100px]",onDragOver:x=>x.preventDefault(),onDrop:x=>{const m=x.dataTransfer.getData("taskId");m&&j(m,o._id)},children:[e.jsx("div",{className:"grid grid-cols-2 gap-2",children:(f[o._id]||[]).map(x=>e.jsxs("div",{onClick:()=>w(x),className:`
                      p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer
                      border-l-4 ${J[x.priority]}
                      ${x.completedAt?"opacity-60":""}
                      hover:shadow-md transition-all
                    `,children:[e.jsx("p",{className:`text-sm font-medium text-gray-900 dark:text-white ${x.completedAt?"line-through":""}`,children:x.title}),e.jsx("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:x.storyPoints&&e.jsxs("span",{className:"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400 px-1.5 py-0.5 rounded",children:[x.storyPoints," pts"]})})]},x._id))}),(f[o._id]||[]).length===0&&e.jsx("div",{className:"text-center text-gray-400 py-8 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsx("p",{children:"Drag tasks here to add to sprint"})})]})]}),F.filter(x=>x.status==="planning").map(x=>{const m=N(x._id);return e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:x.name}),e.jsx("span",{className:"px-2 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs rounded-full",children:"Planning"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[m.taskCount," tasks • ",m.totalPoints," points"]})]}),e.jsxs("button",{onClick:()=>H(x._id),disabled:!!o,className:"flex items-center gap-1 px-3 py-1.5 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Start Sprint"]})]})}),e.jsxs("div",{className:"p-4 min-h-[80px]",onDragOver:k=>k.preventDefault(),onDrop:k=>{const p=k.dataTransfer.getData("taskId");p&&j(p,x._id)},children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(f[x._id]||[]).map(k=>e.jsxs("div",{onClick:()=>w(k),className:`
                        p-2 bg-gray-50 dark:bg-gray-800 rounded cursor-pointer
                        border-l-4 ${J[k.priority]}
                        hover:shadow transition-all text-sm
                      `,children:[k.title,k.storyPoints&&e.jsxs("span",{className:"ml-2 text-xs text-teal-600",children:[k.storyPoints,"pts"]})]},k._id))}),(f[x._id]||[]).length===0&&e.jsx("div",{className:"text-center text-gray-400 py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsx("p",{className:"text-sm",children:"Drag tasks from backlog"})})]})]},x._id)}),F.filter(x=>x.status==="completed").length>0&&e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-sm",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-yellow-500"}),"Completed Sprints"]}),e.jsx("div",{className:"mt-3 space-y-2",children:F.filter(x=>x.status==="completed").map(x=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:x.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Velocity: ",x.velocity||0," points"]})]},x._id))})]})}),e.jsxs("button",{onClick:()=>b(!0),className:"w-full p-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg text-gray-500 hover:border-teal-500 hover:text-teal-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Create New Sprint"]})]}),y&&e.jsx(Es,{onClose:()=>b(!1),onCreate:M})]})}function Es({onClose:t,onCreate:d}){const[c,w]=s.useState(""),[j,F]=s.useState(""),[P,L]=s.useState(""),[T,_]=s.useState("");s.useEffect(()=>{const y=new Date,b=new Date(y);b.setDate(b.getDate()+14),L(y.toISOString().split("T")[0]),_(b.toISOString().split("T")[0])},[]);const A=y=>{y.preventDefault(),!(!c.trim()||!P||!T)&&d({name:c.trim(),goal:j.trim()||void 0,startDate:P,endDate:T})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Create Sprint"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(he,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("form",{onSubmit:A,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sprint Name *"}),e.jsx("input",{type:"text",value:c,onChange:y=>w(y.target.value),placeholder:"Sprint 1",className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Sprint Goal"}),e.jsx("textarea",{value:j,onChange:y=>F(y.target.value),placeholder:"What should be achieved in this sprint?",rows:2,className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg resize-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:P,onChange:y=>L(y.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:T,onChange:y=>_(y.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600",children:"Create Sprint"})]})]})]})})}const ge="http://localhost:5000/api";function Xs(){const{projectId:t}=yt(),{user:d}=pt(),c=bt(),[w,j]=s.useState("board"),[F,P]=s.useState("kanban"),[L,T]=s.useState(!0),[_,A]=s.useState(null),[y,b]=s.useState(null),[i,a]=s.useState(null),[o,v]=s.useState([]),[f,N]=s.useState([]),[B,M]=s.useState(null),[H,Y]=s.useState([]),[J,x]=s.useState(!1),m=()=>localStorage.getItem("authToken"),k=s.useCallback(async()=>{if(t)try{T(!0),A(null);const g=m();if(!g){A("Please log in to view this project"),c("/login");return}const z={"Content-Type":"application/json",Authorization:`Bearer ${g}`},W=await fetch(`${ge}/projects/${t}`,{headers:z});if(W.status===404){A("Project not found. It may have been deleted or the link is incorrect.");return}if(W.status===401){A("Please log in to view this project"),c("/login");return}if(W.status===403){A("You do not have permission to view this project");return}if(!W.ok){const I=await W.json().catch(()=>({}));throw new Error(I.error||"Failed to fetch project")}const O=await W.json();b(O.project);const $=O.project.members.map(I=>({_id:I._id,userId:I.userId?._id||I.userId,name:I.name||I.userId?.name,email:I.email||I.userId?.email,role:I.role,avatar:I.avatar}));N($);const Z=O.project.owner===d?.id||O.project.createdBy===d?.id||O.project.userId===d?.id,ee=$.some(I=>(I.userId===d?.id||String(I.userId)===String(d?.id))&&(I.role==="owner"||I.role==="admin")),xe=Z||ee;x(xe),console.log("🔍 Creator Check Debug:",{projectOwner:O.project.owner,projectCreatedBy:O.project.createdBy,projectUserId:O.project.userId,currentUserId:d?.id,isOwnerByField:Z,isOwnerByMemberRole:ee,members:$,isCreator:xe}),console.log("🔍 Fetching join requests, isCreator:",xe);try{console.log("📋 Fetching join requests from:",`${ge}/join-requests/project/${t}`);const I=await fetch(`${ge}/join-requests/project/${t}`,{headers:z});if(console.log("📋 Join requests response status:",I.status),I.ok){const le=await I.json();console.log("📋 Join requests raw data:",le);const te=(le.requests||[]).map(K=>({id:K._id||K.id,_id:K._id,userId:K.userId?._id||K.userId,userName:K.userId?.name||K.userName,userEmail:K.userId?.email||K.userEmail,requestedAt:K.createdAt||K.requestedAt,skills:K.skills,experience:K.experience,motivation:K.motivation||K.message,message:K.message,status:K.status}));console.log("📋 Mapped requests:",te);const je=te.filter(K=>!K.status||K.status==="pending");console.log("📋 Pending requests:",je),Y(je)}else console.log("❌ Join requests fetch failed:",await I.text())}catch(I){console.error("Error fetching join requests:",I)}const re=await fetch(`${ge}/boards/project/${t}`,{headers:z});if(re.ok){const I=await re.json();if(I.length>0){const le=await fetch(`${ge}/boards/${I[0]._id}`,{headers:z});if(le.ok){const te=await le.json();a(te.board||te),v(te.tasks||[])}}}}catch(g){console.error("Error fetching project data:",g),A(g instanceof Error?g.message:"Failed to load project")}finally{T(!1)}},[t,c,d?.id]);s.useEffect(()=>{if(!d){c("/login");return}k()},[d,k,c]);const p=g=>{M(g)},D=async(g,z)=>{try{const W=m();await fetch(`${ge}/boards/tasks/${g}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${W}`},body:JSON.stringify({sprintId:z})}),v(O=>O.map($=>$._id===g?{...$,sprintId:z||void 0}:$))}catch(W){console.error("Error moving task to sprint:",W)}},r=g=>{P(g),g==="calendar"&&j("calendar")},l=async g=>{try{const z=m(),W=await fetch(`${ge}/join-requests/${g}/respond`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${z}`},body:JSON.stringify({status:"approved"})});if(W.ok)Y(O=>O.filter($=>$.id!==g&&$._id!==g)),k(),alert("Request approved! User has been added to the project.");else{const O=await W.json();alert(O.error||"Failed to approve request")}}catch(z){console.error("Error approving request:",z),alert("Failed to approve request")}},u=async g=>{try{const z=m(),W=await fetch(`${ge}/join-requests/${g}/respond`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${z}`},body:JSON.stringify({status:"rejected"})});if(W.ok)Y(O=>O.filter($=>$.id!==g&&$._id!==g)),alert("Request rejected.");else{const O=await W.json();alert(O.error||"Failed to reject request")}}catch(z){console.error("Error rejecting request:",z),alert("Failed to reject request")}};if(L)return e.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Loading project..."})]})});if(_||!y)return e.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"Unable to Load Project"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:_||"Project not found. It may have been deleted or the link is incorrect."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx("button",{onClick:()=>c("/dashboard/projects"),className:"px-4 py-2 bg-teal-500 hover:bg-teal-600 text-white rounded-lg transition-colors",children:"Browse Projects"}),e.jsx("button",{onClick:()=>k(),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg transition-colors",children:"Try Again"})]})]})});const S=[{id:"board",label:"Board",icon:e.jsx(qe,{className:"w-4 h-4"})},{id:"calendar",label:"Calendar",icon:e.jsx($e,{className:"w-4 h-4"})},{id:"sprints",label:"Sprints",icon:e.jsx(Ae,{className:"w-4 h-4"})},{id:"github",label:"GitHub",icon:e.jsx(pe,{className:"w-4 h-4"})},{id:"members",label:"Members",icon:e.jsx(fe,{className:"w-4 h-4"}),badge:J?H.length:0},{id:"activity",label:"Activity",icon:e.jsx(et,{className:"w-4 h-4"})},{id:"analytics",label:"Analytics",icon:e.jsx(Ve,{className:"w-4 h-4"})},{id:"files",label:"Files",icon:e.jsx(Ge,{className:"w-4 h-4"})},{id:"chat",label:"Chat",icon:e.jsx(ke,{className:"w-4 h-4"})}];return e.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950",children:[e.jsx("header",{className:"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:y.title}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[y.description?.substring(0,100),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex -space-x-2",children:[f.slice(0,4).map((g,z)=>e.jsx("div",{className:"w-8 h-8 rounded-full bg-teal-500 flex items-center justify-center text-white text-sm font-medium border-2 border-white dark:border-gray-900",title:g.name,children:g.avatar?e.jsx("img",{src:g.avatar,alt:g.name,className:"w-full h-full rounded-full"}):g.name?.charAt(0).toUpperCase()},g.userId?.toString()||`member-${z}`)),f.length>4&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-gray-300 dark:bg-gray-700 flex items-center justify-center text-xs font-medium border-2 border-white dark:border-gray-900",children:["+",f.length-4]})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 text-sm",children:[e.jsx(fe,{className:"w-4 h-4"}),"Invite"]})]})]}),e.jsx("nav",{className:"flex gap-1 mt-4 overflow-x-auto",children:S.map(g=>e.jsxs("button",{onClick:()=>j(g.id),className:`
                  flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors whitespace-nowrap relative
                  ${w===g.id?"bg-teal-100 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"}
                `,children:[g.icon,g.label,g.badge&&g.badge>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full animate-pulse",children:g.badge})]},g.id))})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-6",children:[w==="board"&&e.jsx(Ss,{projectId:t,boardId:i?._id,members:f,currentUserId:d?.id||"",currentUserName:d?.name||d?.email?.split("@")[0]||"User",isProjectOwner:J,onViewChange:r}),w==="calendar"&&i&&e.jsx("div",{className:"h-[calc(100vh-250px)]",children:e.jsx(xs,{tasks:o,labels:i.labels,members:f,onTaskClick:g=>p(g)})}),w==="sprints"&&e.jsx("div",{className:"h-[calc(100vh-250px)]",children:e.jsx(_s,{projectId:t,boardId:i?._id,tasks:o,onTaskClick:p,onTaskMoveToSprint:D})}),w==="activity"&&e.jsx("div",{className:"h-[calc(100vh-250px)]",children:e.jsx(cs,{projectId:t})}),w==="analytics"&&e.jsx(Ds,{projectId:t}),w==="github"&&e.jsx(ws,{projectId:t,isOwner:J}),w==="files"&&e.jsx(As,{projectId:t}),w==="chat"&&e.jsx(Ts,{projectId:t,currentUserId:d?.id||"",currentUserName:d?.name||d?.email?.split("@")[0]||"User",members:f,projectTitle:y?.title||"Team Chat"}),w==="members"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-4 rounded-lg text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Debug:"})," isCreator = ",String(J)]}),e.jsxs("p",{children:["joinRequests.length = ",H.length]}),e.jsxs("p",{children:["User ID: ",d?.id]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),"Pending Join Requests",H.length>0&&e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-sm font-bold rounded-full",children:H.length}),!J&&e.jsx("span",{className:"text-xs text-gray-500",children:"(Only visible to project owner)"})]}),H.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(He,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No pending join requests"}),e.jsx("p",{className:"text-sm mt-1",children:"When someone requests to join, they'll appear here"})]}):e.jsx("div",{className:"space-y-4",children:H.map(g=>e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:g.userName}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:g.userEmail}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Applied ",g.requestedAt?new Date(g.requestedAt).toLocaleDateString():"recently"]}),g.message&&e.jsxs("p",{className:"mt-2 text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 p-2 rounded",children:['"',g.message,'"']})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs("button",{onClick:()=>l(g.id),className:"px-3 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors flex items-center gap-1",children:[e.jsx(ls,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>u(g.id),className:"px-3 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors flex items-center gap-1",children:[e.jsx(os,{className:"w-4 h-4"}),"Reject"]})]})]})},g.id))})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Team Members (",f.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f.map((g,z)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center text-white font-medium",children:g.avatar?e.jsx("img",{src:g.avatar,alt:g.name,className:"w-full h-full rounded-full"}):g.name?.charAt(0).toUpperCase()||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:g.name}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:g.role})]})]},g.userId?.toString()||`member-${z}`))})]})]})]})]})}export{Xs as default};
