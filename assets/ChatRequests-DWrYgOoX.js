import{i as v,r as o,j as e,N as g,W as k,M as C,O as R,X as q,K as c}from"./index-Da8xhCKZ.js";import{d as D,s as A,a as B,r as M}from"./ChatWindow-COey3eEW.js";import{B as f}from"./bell-DyuKXSAZ.js";import{P}from"./shopping-cart-Dd3GUyMH.js";function O({onChatAccepted:h}){const{user:a}=v(),[r,y]=o.useState([]),[x,u]=o.useState(!1),[m,i]=o.useState(null);o.useEffect(()=>{if(!a?.id){console.log("ChatRequests: No user logged in");return}console.log("ChatRequests: User ID is:",a.id),console.log("ChatRequests: Subscribing to pending requests for seller:",a.id),D(a.id).then(t=>{console.log("ChatRequests: Debug result:",t)}).catch(t=>{console.error("ChatRequests: Debug error:",t)});const s=A(a.id,t=>{console.log("ChatRequests: Received pending requests:",t.length,t),y(t)});return()=>s()},[a?.id]);const b=async s=>{i(s.id);try{await B(s.id),c.success("Chat request accepted!"),h&&h({...s,status:"accepted"})}catch(t){console.error("Error accepting chat request:",t),c.error("Failed to accept request")}finally{i(null)}},j=async s=>{i(s);try{await M(s),c.success("Chat request declined")}catch(t){console.error("Error rejecting chat request:",t),c.error("Failed to decline request")}finally{i(null)}},N=s=>{const t=new Date,l=s instanceof Date?s:new Date(s),n=t.getTime()-l.getTime(),d=Math.floor(n/6e4),p=Math.floor(n/36e5),w=Math.floor(n/864e5);return isNaN(n)?"":d<1?"Just now":d<60?`${d}m ago`:p<24?`${p}h ago`:`${w}d ago`};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>u(!x),className:"relative p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(f,{className:"w-6 h-6 text-gray-600 dark:text-white"}),r.length>0&&e.jsx(g.span,{initial:{scale:0},animate:{scale:1},className:"absolute -top-1 -right-1 w-5 h-5 rounded-full text-white text-xs font-bold flex items-center justify-center",style:{backgroundColor:"#00ADB5"},children:r.length})]}),e.jsx(k,{children:x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),e.jsxs(g.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",style:{background:"linear-gradient(135deg, #00ADB5 0%, #00d4ff 100%)"},children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Chat Requests"]}),e.jsxs("p",{className:"text-white/80 text-sm",children:[r.length," pending request",r.length!==1?"s":""]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:r.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(f,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No pending requests"})]}):r.map(s=>{const t=s.participantNames[s.requesterId]||"User",l=s.participantAvatars[s.requesterId]||"";return e.jsxs(g.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden flex-shrink-0",style:{border:"2px solid #00ADB5"},children:l?e.jsx("img",{src:l,alt:t,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-white font-bold",style:{backgroundColor:"#00ADB5"},children:t.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white truncate",children:t}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:s.projectTitle})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:N(s.lastMessageTime)})]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>b(s),disabled:m===s.id,className:"flex-1 py-2 px-3 rounded-lg text-white font-medium flex items-center justify-center gap-1 hover:opacity-90 transition-opacity disabled:opacity-50",style:{backgroundColor:"#00ADB5"},children:[e.jsx(R,{className:"w-4 h-4"}),"Accept"]}),e.jsxs("button",{onClick:()=>j(s.id),disabled:m===s.id,className:"flex-1 py-2 px-3 bg-red-500 text-white rounded-lg font-medium flex items-center justify-center gap-1 hover:bg-red-600 transition-colors disabled:opacity-50",children:[e.jsx(q,{className:"w-4 h-4"}),"Decline"]})]})]},s.id)})})]})]})})]})}export{O as C};
