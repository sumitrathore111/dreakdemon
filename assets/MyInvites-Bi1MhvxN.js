import{k as E,u as I,r as s,v as N,j as r,g as k,x as T,X as _}from"./index-BzRIhZ-q.js";import{U as C}from"./user-DlwF8kIO.js";import{C as $}from"./clock-BxjCu1kd.js";function R(){const{user:c}=E(),d=I(),[m,g]=s.useState([]),[w,x]=s.useState(!0),[h,p]=s.useState(null),[i,u]=s.useState(null),f=()=>localStorage.getItem("authToken"),y=s.useCallback(async()=>{try{x(!0),p(null);const e=f();if(!e){d("/login");return}const a=await fetch(`${N}/project-invites/my-invites`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("Failed to fetch invites");const t=await a.json();g(t.invites||[])}catch(e){console.error("Error fetching invites:",e),p(e instanceof Error?e.message:"Failed to load invites")}finally{x(!1)}},[d]);s.useEffect(()=>{if(!c){d("/login");return}y()},[c,y,d]);const b=async(e,a)=>{try{u(e);const t=f(),n=await fetch(`${N}/project-invites/${e}/respond`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({response:a})}),o=await n.json();if(!n.ok)throw new Error(o.error||"Failed to respond");if(a==="accepted"&&o.invite?.projectId){const l=typeof o.invite.projectId=="object"?o.invite.projectId._id:o.invite.projectId;d(`/dashboard/projects/workspace/${l}`)}else g(l=>l.filter(j=>j.id!==e&&j._id!==e))}catch(t){console.error("Error responding:",t),alert(t instanceof Error?t.message:"Failed to respond")}finally{u(null)}},v=e=>{const a=new Date(e).getTime()-Date.now();if(a<=0)return"Expired";const t=Math.floor(a/(1e3*60*60*24)),n=Math.floor(a%(1e3*60*60*24)/(1e3*60*60));return t>0?`${t}d remaining`:`${n}h remaining`};return w?r.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950 flex items-center justify-center",children:r.jsx("div",{className:"w-10 h-10 border-4 border-teal-500 border-t-transparent rounded-full animate-spin"})}):r.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950 p-6",children:r.jsxs("div",{className:"max-w-3xl mx-auto",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx(k,{className:"w-8 h-8 text-teal-500"}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Project Invites"})]}),h&&r.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-400",children:h}),m.length===0?r.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-12 text-center",children:[r.jsx(k,{className:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:"No pending invites"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"When someone invites you to a project, it will appear here."})]}):r.jsx("div",{className:"space-y-4",children:m.map(e=>r.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-800",children:[r.jsxs("div",{className:"flex items-start gap-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-teal-500 flex items-center justify-center text-white font-medium flex-shrink-0",children:e.invitedBy?.avatar?r.jsx("img",{src:e.invitedBy.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):e.invitedBy?.name?.charAt(0).toUpperCase()||r.jsx(C,{className:"w-6 h-6"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg",children:e.projectTitle||e.projectId?.title}),r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Invited by ",r.jsx("span",{className:"font-medium",children:e.invitedBy?.name||e.invitedByName})]}),e.message&&r.jsxs("p",{className:"mt-2 text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg italic",children:['"',e.message,'"']}),r.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-gray-500",children:[r.jsx($,{className:"w-3 h-3"}),v(e.expiresAt)]})]})]}),r.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-100 dark:border-gray-800",children:[r.jsxs("button",{onClick:()=>b(e.id||e._id,"accepted"),disabled:i===(e.id||e._id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-teal-500 hover:bg-teal-600 disabled:bg-gray-300 text-white rounded-lg font-medium",children:[i===(e.id||e._id)?r.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):r.jsx(T,{className:"w-4 h-4"}),"Accept & Join"]}),r.jsx("button",{onClick:()=>b(e.id||e._id,"declined"),disabled:i===(e.id||e._id),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg font-medium",children:r.jsx(_,{className:"w-4 h-4"})})]})]},e.id||e._id))})]})})}export{R as default};
